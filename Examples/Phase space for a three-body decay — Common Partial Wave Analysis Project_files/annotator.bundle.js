!function(){"use strict";var e,t,n,o,i,r,s,a,l,c,h,d,u={},f=[],m=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,p=Array.isArray;function g(e,t){for(var n in t)e[n]=t[n];return e}function _(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function b(e,o,i,r,s){var a={type:e,props:o,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==s?++n:s,__i:-1,__u:0};return null==s&&null!=t.vnode&&t.vnode(a),a}function w(e){return e.children}function v(e,t){this.props=e,this.context=t}function y(e,t){if(null==t)return e.__?y(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?y(e):null}function x(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return x(e)}}function N(e){(!e.__d&&(e.__d=!0)&&o.push(e)&&!C.__r++||i!=t.debounceRendering)&&((i=t.debounceRendering)||r)(C)}function C(){
for(var e,n,i,r,a,l,c,h=1;o.length;)o.length>h&&o.sort(s),e=o.shift(),h=o.length,e.__d&&(i=void 0,a=(r=(n=e).__v).__e,l=[],c=[],n.__P&&((i=g({},r)).__v=r.__v+1,t.vnode&&t.vnode(i),T(n.__P,i,r,n.__n,n.__P.namespaceURI,32&r.__u?[a]:null,l,null==a?y(r):a,!!(32&r.__u),c),i.__v=r.__v,i.__.__k[i.__i]=i,M(l,i,c),i.__e!=a&&x(i)));C.__r=0}function S(e,t,n,o,i,r,s,a,l,c,h){var d,m,g,_,v,x,N=o&&o.__k||f,C=t.length;for(l=function(e,t,n,o,i){var r,s,a,l,c,h=n.length,d=h,u=0;for(e.__k=new Array(i),r=0;r<i;r++)null!=(s=t[r])&&"boolean"!=typeof s&&"function"!=typeof s?(l=r+u,(s=e.__k[r]="string"==typeof s||"number"==typeof s||"bigint"==typeof s||s.constructor==String?b(null,s,null,null,null):p(s)?b(w,{children:s},null,null,null):null==s.constructor&&s.__b>0?b(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=e,s.__b=e.__b+1,a=null,-1!=(c=s.__i=k(s,n,l,d))&&(d--,(a=n[c])&&(a.__u|=2)),null==a||null==a.__v?(-1==c&&(i>h?u--:i<h&&u++),"function"!=typeof s.type&&(s.__u|=4)):c!=l&&(c==l-1?u--:c==l+1?u++:(c>l?u--:u++,
s.__u|=4))):e.__k[r]=null;if(d)for(r=0;r<h;r++)null!=(a=n[r])&&0==(2&a.__u)&&(a.__e==o&&(o=y(a)),B(a,a));return o}(n,t,N,l,C),d=0;d<C;d++)null!=(g=n.__k[d])&&(m=-1==g.__i?u:N[g.__i]||u,g.__i=d,x=T(e,g,m,i,r,s,a,l,c,h),_=g.__e,g.ref&&m.ref!=g.ref&&(m.ref&&L(m.ref,null,g),h.push(g.ref,g.__c||_,g)),null==v&&null!=_&&(v=_),4&g.__u||m.__k===g.__k?l=A(g,l,e):"function"==typeof g.type&&void 0!==x?l=x:_&&(l=_.nextSibling),g.__u&=-7);return n.__e=v,l}function A(e,t,n){var o,i;if("function"==typeof e.type){for(o=e.__k,i=0;o&&i<o.length;i++)o[i]&&(o[i].__=e,t=A(o[i],t,n));return t}e.__e!=t&&(t&&e.type&&!n.contains(t)&&(t=y(e)),n.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function k(e,t,n,o){var i,r,s=e.key,a=e.type,l=t[n];if(null===l&&null==e.key||l&&s==l.key&&a==l.type&&0==(2&l.__u))return n;if(o>(null!=l&&0==(2&l.__u)?1:0))for(i=n-1,r=n+1;i>=0||r<t.length;){if(i>=0){if((l=t[i])&&0==(2&l.__u)&&s==l.key&&a==l.type)return i;i--}if(r<t.length){
if((l=t[r])&&0==(2&l.__u)&&s==l.key&&a==l.type)return r;r++}}return-1}function R(e,t,n){"-"==t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||m.test(t)?n:n+"px"}function E(e,t,n,o,i){var r,s;e:if("style"==t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof o&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||R(e.style,t,"");if(n)for(t in n)o&&n[t]==o[t]||R(e.style,t,n[t])}else if("o"==t[0]&&"n"==t[1])r=t!=(t=t.replace(a,"$1")),s=t.toLowerCase(),t=s in e||"onFocusOut"==t||"onFocusIn"==t?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?o?n.u=o.u:(n.u=l,e.addEventListener(t,r?h:c,r)):e.removeEventListener(t,r?h:c,r);else{if("http://www.w3.org/2000/svg"==i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}
"function"==typeof n||(null==n||!1===n&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==n?"":n))}}function P(e){return function(n){if(this.l){var o=this.l[n.type+e];if(null==n.t)n.t=l++;else if(n.t<o.u)return;return o(t.event?t.event(n):n)}}}function T(e,n,o,i,r,s,a,l,c,h){var d,u,f,m,b,y,x,N,C,A,k,R,E,P,T,M,L,B=n.type;if(null!=n.constructor)return null;128&o.__u&&(c=!!(32&o.__u),s=[l=n.__e=o.__e]),(d=t.__b)&&d(n);e:if("function"==typeof B)try{if(N=n.props,C="prototype"in B&&B.prototype.render,A=(d=B.contextType)&&i[d.__c],k=d?A?A.props.value:d.__:i,o.__c?x=(u=n.__c=o.__c).__=u.__E:(C?n.__c=u=new B(N,k):(n.__c=u=new v(N,k),u.constructor=B,u.render=H),A&&A.sub(u),u.props=N,u.state||(u.state={}),u.context=k,u.__n=i,f=u.__d=!0,u.__h=[],u._sb=[]),C&&null==u.__s&&(u.__s=u.state),C&&null!=B.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=g({},u.__s)),g(u.__s,B.getDerivedStateFromProps(N,u.__s))),m=u.props,b=u.state,u.__v=n,
f)C&&null==B.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),C&&null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(C&&null==B.getDerivedStateFromProps&&N!==m&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(N,k),!u.__e&&null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(N,u.__s,k)||n.__v==o.__v){for(n.__v!=o.__v&&(u.props=N,u.state=u.__s,u.__d=!1),n.__e=o.__e,n.__k=o.__k,n.__k.some((function(e){e&&(e.__=n)})),R=0;R<u._sb.length;R++)u.__h.push(u._sb[R]);u._sb=[],u.__h.length&&a.push(u);break e}null!=u.componentWillUpdate&&u.componentWillUpdate(N,u.__s,k),C&&null!=u.componentDidUpdate&&u.__h.push((function(){u.componentDidUpdate(m,b,y)}))}if(u.context=k,u.props=N,u.__P=e,u.__e=!1,E=t.__r,P=0,C){for(u.state=u.__s,u.__d=!1,E&&E(n),d=u.render(u.props,u.state,u.context),T=0;T<u._sb.length;T++)u.__h.push(u._sb[T]);u._sb=[]}else do{u.__d=!1,E&&E(n),d=u.render(u.props,u.state,u.context),u.state=u.__s}while(u.__d&&++P<25);u.state=u.__s,
null!=u.getChildContext&&(i=g(g({},i),u.getChildContext())),C&&!f&&null!=u.getSnapshotBeforeUpdate&&(y=u.getSnapshotBeforeUpdate(m,b)),M=d,null!=d&&d.type===w&&null==d.key&&(M=O(d.props.children)),l=S(e,p(M)?M:[M],n,o,i,r,s,a,l,c,h),u.base=n.__e,n.__u&=-161,u.__h.length&&a.push(u),x&&(u.__E=u.__=null)}catch(e){if(n.__v=null,c||null!=s)if(e.then){for(n.__u|=c?160:128;l&&8==l.nodeType&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,n.__e=l}else for(L=s.length;L--;)_(s[L]);else n.__e=o.__e,n.__k=o.__k;t.__e(e,n,o)}else null==s&&n.__v==o.__v?(n.__k=o.__k,n.__e=o.__e):l=n.__e=I(o.__e,n,o,i,r,s,a,c,h);return(d=t.diffed)&&d(n),128&n.__u?void 0:l}function M(e,n,o){for(var i=0;i<o.length;i++)L(o[i],o[++i],o[++i]);t.__c&&t.__c(n,e),e.some((function(n){try{e=n.__h,n.__h=[],e.some((function(e){e.call(n)}))}catch(e){t.__e(e,n.__v)}}))}function O(e){return"object"!=typeof e||null==e||e.__b&&e.__b>0?e:p(e)?e.map(O):g({},e)}function I(n,o,i,r,s,a,l,c,h){var d,f,m,g,b,w,v,x=i.props,N=o.props,C=o.type
;if("svg"==C?s="http://www.w3.org/2000/svg":"math"==C?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),null!=a)for(d=0;d<a.length;d++)if((b=a[d])&&"setAttribute"in b==!!C&&(C?b.localName==C:3==b.nodeType)){n=b,a[d]=null;break}if(null==n){if(null==C)return document.createTextNode(N);n=document.createElementNS(s,C,N.is&&N),c&&(t.__m&&t.__m(o,a),c=!1),a=null}if(null==C)x===N||c&&n.data==N||(n.data=N);else{if(a=a&&e.call(n.childNodes),x=i.props||u,!c&&null!=a)for(x={},d=0;d<n.attributes.length;d++)x[(b=n.attributes[d]).name]=b.value;for(d in x)if(b=x[d],"children"==d);else if("dangerouslySetInnerHTML"==d)m=b;else if(!(d in N)){if("value"==d&&"defaultValue"in N||"checked"==d&&"defaultChecked"in N)continue;E(n,d,null,b,s)}for(d in N)b=N[d],"children"==d?g=b:"dangerouslySetInnerHTML"==d?f=b:"value"==d?w=b:"checked"==d?v=b:c&&"function"!=typeof b||x[d]===b||E(n,d,b,x[d],s);if(f)c||m&&(f.__html==m.__html||f.__html==n.innerHTML)||(n.innerHTML=f.__html),o.__k=[];else if(m&&(n.innerHTML=""),
S("template"==o.type?n.content:n,p(g)?g:[g],o,i,r,"foreignObject"==C?"http://www.w3.org/1999/xhtml":s,a,l,a?a[0]:i.__k&&y(i,0),c,h),null!=a)for(d=a.length;d--;)_(a[d]);c||(d="value","progress"==C&&null==w?n.removeAttribute("value"):null!=w&&(w!==n[d]||"progress"==C&&!w||"option"==C&&w!=x[d])&&E(n,d,w,x[d],s),d="checked",null!=v&&v!=n[d]&&E(n,d,v,x[d],s))}return n}function L(e,n,o){try{if("function"==typeof e){var i="function"==typeof e.__u;i&&e.__u(),i&&null==n||(e.__u=e(n))}else e.current=n}catch(e){t.__e(e,o)}}function B(e,n,o){var i,r;if(t.unmount&&t.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||L(i,null,n)),null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){t.__e(e,n)}i.base=i.__P=null}if(i=e.__k)for(r=0;r<i.length;r++)i[r]&&B(i[r],n,o||"function"!=typeof e.type);o||_(e.__e),e.__c=e.__=e.__e=void 0}function H(e,t,n){return this.constructor(e,n)}function F(n,o,i){var r,s,a;o==document&&(o=document.documentElement),t.__&&t.__(n,o),r=!1?null:o.__k,s=[],a=[],
T(o,n=o.__k=function(t,n,o){var i,r,s,a={};for(s in n)"key"==s?i=n[s]:"ref"==s?r=n[s]:a[s]=n[s];if(arguments.length>2&&(a.children=arguments.length>3?e.call(arguments,2):o),"function"==typeof t&&null!=t.defaultProps)for(s in t.defaultProps)null==a[s]&&(a[s]=t.defaultProps[s]);return b(t,a,i,r,null)}(w,null,[n]),r||u,u,o.namespaceURI,r?null:o.firstChild?e.call(o.childNodes):null,s,r?r.__e:o.firstChild,false,a),M(s,n,a)}function D(e){function t(e){var n,o;return this.getChildContext||(n=new Set,(o={})[t.__c]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(e){this.props.value!=e.value&&n.forEach((function(e){e.__e=!0,N(e)}))},this.sub=function(e){n.add(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n&&n.delete(e),t&&t.call(e)}}),e.children}return t.__c="__cC"+d++,t.__=e,t.Provider=t.__l=(t.Consumer=function(e,t){return e.children(t)}).contextType=t,t}e=f.slice,t={__e:function(e,t,n,o){
for(var i,r,s;t=t.__;)if((i=t.__c)&&!i.__)try{if((r=i.constructor)&&null!=r.getDerivedStateFromError&&(i.setState(r.getDerivedStateFromError(e)),s=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(e,o||{}),s=i.__d),s)return i.__E=i}catch(t){e=t}throw e}},n=0,v.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=g({},this.state),"function"==typeof e&&(e=e(g({},n),this.props)),e&&g(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),N(this))},v.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),N(this))},v.prototype.render=w,o=[],r="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,s=function(e,t){return e.__v.__b-t.__v.__b},C.__r=0,a=/(PointerCapture)$|Capture$/i,l=0,c=P(!1),h=P(!0),d=0;var V,U,q,$,z=0,W=[],j=t,X=j.__b,Y=j.__r,K=j.diffed,G=j.__c,Q=j.unmount,J=j.__;function Z(e,t){j.__h&&j.__h(U,e,z||t),z=0;var n=U.__H||(U.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function ee(e){
return z=1,function(e,t,n){var o=Z(V++,2);if(o.t=e,!o.__c&&(o.__=[me(void 0,t),function(e){var t=o.__N?o.__N[0]:o.__[0],n=o.t(t,e);t!==n&&(o.__N=[n,o.__[1]],o.__c.setState({}))}],o.__c=U,!U.__f)){var i=function(e,t,n){if(!o.__c.__H)return!0;var i=o.__c.__H.__.filter((function(e){return!!e.__c}));if(i.every((function(e){return!e.__N})))return!r||r.call(this,e,t,n);var s=o.__c.props!==e;return i.forEach((function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(s=!0)}})),r&&r.call(this,e,t,n)||s};U.__f=!0;var r=U.shouldComponentUpdate,s=U.componentWillUpdate;U.componentWillUpdate=function(e,t,n){if(this.__e){var o=r;r=void 0,i(e,t,n),r=o}s&&s.call(this,e,t,n)},U.shouldComponentUpdate=i}return o.__N||o.__}(me,e)}function te(e,t){var n=Z(V++,3);!j.__s&&fe(n.__H,t)&&(n.__=e,n.u=t,U.__H.__h.push(n))}function ne(e,t){var n=Z(V++,4);!j.__s&&fe(n.__H,t)&&(n.__=e,n.u=t,U.__h.push(n))}function oe(e){return z=5,ie((function(){return{current:e}}),[])}function ie(e,t){var n=Z(V++,7)
;return fe(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function re(e,t){return z=8,ie((function(){return e}),t)}function se(e){var t=U.context[e.__c],n=Z(V++,9);return n.c=e,t?(null==n.__&&(n.__=!0,t.sub(U)),t.props.value):e.__}function ae(){var e=Z(V++,11);if(!e.__){for(var t=U.__v;null!==t&&!t.__m&&null!==t.__;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__}function le(){for(var e;e=W.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(de),e.__H.__h.forEach(ue),e.__H.__h=[]}catch(t){e.__H.__h=[],j.__e(t,e.__v)}}j.__b=function(e){U=null,X&&X(e)},j.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),J&&J(e,t)},j.__r=function(e){Y&&Y(e),V=0;var t=(U=e.__c).__H;t&&(q===U?(t.__h=[],U.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0}))):(t.__h.forEach(de),t.__h.forEach(ue),t.__h=[],V=0)),q=U},j.diffed=function(e){K&&K(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==W.push(t)&&$===j.requestAnimationFrame||(($=j.requestAnimationFrame)||he)(le)),
t.__H.__.forEach((function(e){e.u&&(e.__H=e.u),e.u=void 0}))),q=U=null},j.__c=function(e,t){t.some((function(e){try{e.__h.forEach(de),e.__h=e.__h.filter((function(e){return!e.__||ue(e)}))}catch(n){t.some((function(e){e.__h&&(e.__h=[])})),t=[],j.__e(n,e.__v)}})),G&&G(e,t)},j.unmount=function(e){Q&&Q(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach((function(e){try{de(e)}catch(e){t=e}})),n.__H=void 0,t&&j.__e(t,n.__v))};var ce="function"==typeof requestAnimationFrame;function he(e){var t,n=function(){clearTimeout(o),ce&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,35);ce&&(t=requestAnimationFrame(n))}function de(e){var t=U,n=e.__c;"function"==typeof n&&(e.__c=void 0,n()),U=t}function ue(e){var t=U;e.__c=e.__(),U=t}function fe(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function me(e,t){return"function"==typeof t?t(e):t}function pe(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t)
;if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ge{constructor(){pe(this,"_listeners",void 0),this._listeners=new Map}add(e,t,n,o){e.addEventListener(t,n,o);const i=Symbol();return this._listeners.set(i,{eventTarget:e,eventType:t,listener:n,options:o}),i}remove(e){const t=this._listeners.get(e);if(t){const{eventTarget:n,eventType:o,listener:i,options:r}=t;n.removeEventListener(o,i,r),this._listeners.delete(e)}}removeAll(){this._listeners.forEach((({eventTarget:e,eventType:t,listener:n,options:o})=>{e.removeEventListener(t,n,o)})),this._listeners.clear()}}function _e(e){e.focus()}function be(e,{autofocus:t=!1,loop:n=!0,horizontal:o=!0,vertical:i=!0,selector:r="a,button",containerVisible:s=!0,focusElement:a=_e}={}){const l=oe(null),c=function(e){const t=oe({callback:e,
call:(...e)=>t.current.callback(...e)});return t.current.callback=e,t.current.call}(a);te((()=>{if(!s)return()=>{};if(!e.current)throw new Error("Container ref not set");const a=e.current,h=()=>{const e=Array.from(a.querySelectorAll(r)).filter((e=>null!==e.offsetParent&&!function(e){return"boolean"==typeof e.disabled&&e.disabled}(e)));return document.activeElement===a&&e.unshift(a),e},d=(e=h(),t=-1,n=!1,o)=>{t<0&&(t=e.findIndex((e=>0===e.tabIndex)))<0&&(t=0);for(const[i,r]of e.entries())r.tabIndex=i===t?0:-1,i===t&&n&&(l.current=r,c(r,o))},u=h(),f=l.current?u.indexOf(l.current):0;d(u,f,t);const m=new ge;m.add(a,"focusin",(e=>{if(e.target===a&&l.current)return void c(l.current);const n=h(),o=n.indexOf(e.target);o>=0&&d(n,o,t)})),m.add(a,"keydown",(e=>{const t=h();let r=t.findIndex((e=>0===e.tabIndex)),s=!1;o&&"ArrowLeft"===e.key||i&&"ArrowUp"===e.key?(0===r?r=n?t.length-1:r:--r,s=!0):o&&"ArrowRight"===e.key||i&&"ArrowDown"===e.key?(r===t.length-1?r=n?0:r:++r,s=!0):"Home"===e.key?(r=0,
s=!0):"End"===e.key&&(r=t.length-1,s=!0),s&&(d(t,r,!0,e),e.preventDefault(),e.stopPropagation())}));const p=new MutationObserver((()=>{d()}));return p.observe(a,{subtree:!0,attributes:!0,attributeFilter:["disabled"],childList:!0}),()=>{m.removeAll(),p.disconnect()}}),[t,e,c,o,n,r,i,s])}function we(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t);if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ve{constructor(e){we(this,"_target",void 0),we(this,"_value",void 0),this._target=e,this._value=null}get current(){return this._value}set current(e){this._value=e,this._updateTarget()}get target(){return this._target}set target(e){e!==this._target&&(this._target=e,this._updateTarget())}
_updateTarget(){const e=this._value;"function"==typeof this._target?this._target(e):this._target&&(this._target.current=e)}}function ye(e){const t=oe(new ve(e));return t.current.target=e,t.current}var xe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ce,Se={exports:{}};var Ae,ke=(Ce||(Ce=1,Ae=Se,function(){var e={}.hasOwnProperty;function t(){for(var e="",t=0;t<arguments.length;t++){var i=arguments[t];i&&(e=o(e,n(i)))}return e}function n(n){if("string"==typeof n||"number"==typeof n)return n;if("object"!=typeof n)return"";if(Array.isArray(n))return t.apply(null,n);if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]"))return n.toString();var i="";for(var r in n)e.call(n,r)&&n[r]&&(i=o(i,r));return i}function o(e,t){return t?e?e+" "+t:e+t:e}Ae.exports?(t.default=t,
Ae.exports=t):window.classNames=t}()),Se.exports),Re=Ne(ke);var Ee=0;function Pe(e,n,o,i,r,s){n||(n={});var a,l,c=n;if("ref"in c)for(l in c={},n)"ref"==l?a=n[l]:c[l]=n[l];var h={type:e,props:c,key:o,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ee,__i:-1,__u:0,__source:r,__self:s};if("function"==typeof e&&(a=e.defaultProps))for(l in a)void 0===c[l]&&(c[l]=a[l]);return t.vnode&&t.vnode(h),h}D({}),D({});var Te="/home/runner/work/frontend-shared/frontend-shared/src/components/layout/Card.tsx";function Me({children:e,classes:t,elementRef:n,active:o=!1,variant:i="raised",width:r="full",...s}){return Pe("div",{"data-component":"Card",...s,ref:n,className:Re("rounded-lg border bg-white",{"shadow hover:shadow-md":"raised"===i,"shadow-md":o&&"raised"===i},{"w-full":"full"===r,"w-auto":"auto"===r},t),children:e},void 0,0,{fileName:Te,lineNumber:40,columnNumber:5},this)}var Oe="/home/runner/work/frontend-shared/frontend-shared/src/components/layout/CardContent.tsx"
;function Ie({children:e,classes:t,elementRef:n,size:o="md",...i}){return Pe("div",{"data-component":"CardContent",...i,ref:n,className:Re({"p-3 space-y-4":"md"===o,"p-2 space-y-3":"sm"===o,"p-4 space-y-6":"lg"===o},t),children:e},void 0,0,{fileName:Oe,lineNumber:29,columnNumber:5},this)}var Le="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Annotate.tsx";function Be(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"AnnotateIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:Le,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",
d:"M14 0a2 2 0 0 1 2 2v13a1 1 0 0 1-1.555.832l-4.262-1.757A1 1 0 0 0 9.802 14H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm-2.109 3.5h-.484l-.14.006-.122.018a.7.7 0 0 0-.2.071l-.076.054-.108.1-.097.1-1.632 1.999-.091.12-.084.129a2.6 2.6 0 0 0-.291.722l-.03.142-.027.218-.009.223v2.646l.01.086.027.08a.54.54 0 0 0 .236.236l.067.028.07.017.074.005h2.907l.074-.005.094-.025a.5.5 0 0 0 .169-.108.5.5 0 0 0 .082-.096l.029-.051.027-.081.01-.086V7.336l-.006-.073-.018-.068a.44.44 0 0 0-.124-.178.6.6 0 0 0-.103-.074l-.055-.026-.087-.024-.092-.009h-.579l-.057-.006-.054-.017a.3.3 0 0 1-.096-.07.2.2 0 0 1-.045-.078l-.004-.04.01-.043.022-.043 1.311-2.227.047-.09.037-.106a.5.5 0 0 0-.06-.394.53.53 0 0 0-.255-.22l-.084-.028-.092-.016zm-5.924 0h-.424l-.121.006-.108.018a.6.6 0 0 0-.174.071l-.067.054-.095.1-.084.1-1.429 1.999-.08.12-.096.174a2.8 2.8 0 0 0-.232.677l-.025.142-.024.218L3 7.402v2.646l.008.086.024.08a.5.5 0 0 0 .097.148q.052.055.11.088l.058.028.062.017.065.005h2.543l.065-.005.082-.025a.515.515 0 0 0 .22-.204l.025-.051.024-.081.008-.086V7.336l-.005-.073-.023-.09a.487.487 0 0 0-.191-.23l-.048-.026-.076-.024-.08-.009H5.46l-.05-.006-.047-.017a.3.3 0 0 1-.084-.07.2.2 0 0 1-.04-.078l-.003-.04.008-.043.02-.043L6.411 4.36l.04-.09.033-.106a.55.55 0 0 0-.053-.394.5.5 0 0 0-.222-.22l-.074-.028-.08-.016z"
},void 0,0,{fileName:Le,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Le,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Le,lineNumber:11,columnNumber:5},this)}var He="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Cancel.tsx";function Fe(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CancelIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:He,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"m12.322 5.085-.08.087-2.828 2.827 2.829 2.83a1 1 0 0 1-1.32 1.497l-.095-.083L8 9.414l-2.828 2.829c-.915.914-2.272-.388-1.494-1.328l.08-.087L6.584 8 3.757 5.172a1 1 0 0 1 1.32-1.498l.095.083L8 6.585l2.828-2.828c.886-.885 2.188.309 1.56 1.239z"},void 0,0,{fileName:He,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:He,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:He,lineNumber:11,
columnNumber:5},this)}var De="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretDown.tsx";function Ve(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretDownIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:De,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M3.293 5.293a1 1 0 0 1 1.32-.083l.094.083L8 8.585l3.293-3.292a1 1 0 0 1 1.32-.083l.094.083a1 1 0 0 1 .083 1.32l-.083.094-4 4a1 1 0 0 1-1.32.083l-.094-.083-4-4a1 1 0 0 1 0-1.414"},void 0,0,{fileName:De,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:De,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:De,lineNumber:11,columnNumber:5},this)}var Ue="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretLeft.tsx";function qe(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",
"aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretLeftIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:Ue,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M9.293 3.293a1 1 0 0 1 1.497 1.32l-.083.094L7.415 8l3.292 3.293a1 1 0 0 1 .083 1.32l-.083.094a1 1 0 0 1-1.32.083l-.094-.083-4-4a1 1 0 0 1-.083-1.32l.083-.094z"},void 0,0,{fileName:Ue,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Ue,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Ue,lineNumber:11,columnNumber:5},this)}var $e="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretRight.tsx";function ze(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretRightIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:$e,lineNumber:21,columnNumber:9
},this),Pe("path",{fill:"currentColor",d:"M5.293 3.293a1 1 0 0 1 1.32-.083l.094.083 4 4a1 1 0 0 1 .083 1.32l-.083.094-4 4a1 1 0 0 1-1.497-1.32l.083-.094L8.585 8 5.293 4.707a1 1 0 0 1-.083-1.32z"},void 0,0,{fileName:$e,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:$e,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:$e,lineNumber:11,columnNumber:5},this)}var We="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Caution.tsx";function je(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CautionIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:We,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",
d:"M8 0c.767 0 1.432.455 1.794 1.148l5.917 11.326c.386.738.36 1.573.071 2.23-.286.651-.926 1.296-1.864 1.296H2.082c-.938 0-1.578-.645-1.864-1.295a2.6 2.6 0 0 1 .07-2.23L6.207 1.147C6.568.455 7.233 0 8 0m0 2.038-.021.036L2.06 13.4a.6.6 0 0 0-.012.5.3.3 0 0 0 .062.1H13.89a.3.3 0 0 0 .061-.1.6.6 0 0 0-.012-.5L8.02 2.074zm5.874 11.972q0 0 .01-.006-.01.007-.01.006m-11.748 0q0 .002-.01-.006z"},void 0,0,{fileName:We,lineNumber:22,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M8 5a1 1 0 0 1 1 1v3a1 1 0 0 1-2 0V6a1 1 0 0 1 1-1M9 12a1 1 0 1 1-2 0 1 1 0 0 1 2 0"},void 0,0,{fileName:We,lineNumber:26,columnNumber:9},this)]},void 0,0,{fileName:We,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:We,lineNumber:11,columnNumber:5},this)}var Xe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Check.tsx";function Ye(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CheckIcon",...e,children:Pe("g",{
"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:Xe,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M12.18 2.427a1 1 0 0 1 1.705 1.04l-.066.106-7 10a1 1 0 0 1-1.606.045l-.07-.104-3-5A1 1 0 0 1 3.792 7.39l.065.097 2.207 3.677z"},void 0,0,{fileName:Xe,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Xe,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Xe,lineNumber:11,columnNumber:5},this)}var Ke="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Checkbox.tsx";function Ge(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CheckboxIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:Ke,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",
d:"M0 2.5A2.5 2.5 0 0 1 2.5 0h11A2.5 2.5 0 0 1 16 2.5v11a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 13.5zM2.5 1A1.5 1.5 0 0 0 1 2.5v11A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-11A1.5 1.5 0 0 0 13.5 1z","clip-rule":"evenodd"},void 0,0,{fileName:Ke,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Ke,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Ke,lineNumber:11,columnNumber:5},this)}var Qe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CheckboxCheckedFilled.tsx";function Je(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CheckboxCheckedFilledIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:Qe,lineNumber:23,columnNumber:9},this),Pe("path",{fill:"currentColor",
d:"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm10.18 3.636a.75.75 0 0 0-1.044.184l-4.588 6.552-1.655-2.758-.05-.072a.75.75 0 0 0-1.236.844l2.25 3.75.053.078a.75.75 0 0 0 1.204-.034l5.25-7.5.05-.08a.75.75 0 0 0-.234-.964","clip-rule":"evenodd"},void 0,0,{fileName:Qe,lineNumber:24,columnNumber:9},this)]},void 0,0,{fileName:Qe,lineNumber:22,columnNumber:7},this)},void 0,0,{fileName:Qe,lineNumber:13,columnNumber:5},this)}var Ze="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Hide.tsx";function et(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"HideIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:Ze,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",
d:"m1.613.21.094.083 14 14a1 1 0 0 1-1.32 1.497l-.094-.083-14-14A1 1 0 0 1 1.613.21m.583 4.845a1 1 0 0 1 .292 1.384C2.165 6.935 2 7.46 2 8c0 2.123 2.628 4 6 4q.33 0 .657-.024a1 1 0 0 1 .147 1.994Q8.405 14 8 14c-4.36 0-8-2.6-8-6 0-.937.283-1.84.812-2.653a1 1 0 0 1 1.384-.292M16 8c0-3.4-3.64-6-8-6q-.405 0-.804.03a1 1 0 1 0 .147 1.994Q7.668 4 8 4c3.372 0 6 1.877 6 4 0 .539-.165 1.065-.488 1.561a1 1 0 1 0 1.676 1.092C15.718 9.84 16 8.937 16 8"},void 0,0,{fileName:Ze,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Ze,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Ze,lineNumber:11,columnNumber:5},this)}var tt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Highlight.tsx";function nt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"HighlightIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:tt,lineNumber:21,
columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M13 1a1 1 0 0 0-1-1h-2l-.117.007a1 1 0 0 0-.75 1.493A1 1 0 0 0 9 2v6l.009.134a1 1 0 0 0 .125.365.996.996 0 0 0 .374 1.37A1 1 0 0 0 9.5 10v2l.006.114c.087.814 1.098 1.196 1.701.593l1-1 .087-.099A1 1 0 0 0 12.5 11l.001-1.134a1 1 0 0 0 .365-1.366A1 1 0 0 0 13 8V2l-.009-.134a1 1 0 0 0-.125-.365A1 1 0 0 0 13 1m0 14a1 1 0 0 0-1-1H1l-.117.007A1 1 0 0 0 1 16h11l.117-.007A1 1 0 0 0 13 15"},void 0,0,{fileName:tt,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:tt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:tt,lineNumber:11,columnNumber:5},this)}var ot="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/MenuCollapse.tsx";function it(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","data-component":"MenuCollapseIcon",...e,children:Pe("path",{fill:"currentColor",
d:"m8.54 4.205 6.23 5.87a.69.69 0 0 1 0 1.03l-.72.68a.8.8 0 0 1-1.09 0L8 7.135l-4.96 4.65a.8.8 0 0 1-1.09 0l-.73-.69a.69.69 0 0 1 0-1.02l6.24-5.87a.8.8 0 0 1 1.08 0"},void 0,0,{fileName:ot,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:ot,lineNumber:11,columnNumber:5},this)}var rt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/MenuExpand.tsx";function st(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"MenuExpandIcon",...e,children:Pe("path",{fill:"currentColor",d:"M7.456 11.788 1.226 5.92a.695.695 0 0 1 0-1.025l.726-.684a.804.804 0 0 1 1.087-.001L8 8.861l4.961-4.65a.804.804 0 0 1 1.087.001l.727.684c.3.283.3.742 0 1.025l-6.23 5.867a.804.804 0 0 1-1.09 0z"},void 0,0,{fileName:rt,lineNumber:19,columnNumber:7},this)},void 0,0,{fileName:rt,lineNumber:11,columnNumber:5},this)}var at="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Note.tsx";function lt(e){return Pe("svg",{
xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"NoteIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:at,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M14 0a2 2 0 0 1 1.995 1.85L16 2v7a1 1 0 0 1-.31.724l-.09.076-8 6a1 1 0 0 1-.471.192L7 16H2a2 2 0 0 1-1.995-1.85L0 14V2A2 2 0 0 1 1.85.005L2 0zm0 2H2v12h4V9a1 1 0 0 1 .883-.993L7 8h7zm-6 8h4l-4 3z"},void 0,0,{fileName:at,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:at,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:at,lineNumber:11,columnNumber:5},this)}var ct="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Pin.tsx";function ht(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"PinIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",
d:"M0 0h16v16H0z"},void 0,0,{fileName:ct,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M3 1a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2 .5.5 0 0 0-.5.5v.146a.5.5 0 0 0 .053.224l1.341 2.683c.07.139.106.292.106.447v3a1 1 0 0 1-1 1H9.024l.093 4.977a1 1 0 0 1-2 .046L7.024 10H4a1 1 0 0 1-1-1V6a1 1 0 0 1 .106-.447L4.447 2.87a.5.5 0 0 0 .053-.224V2.5A.5.5 0 0 0 4 2a1 1 0 0 1-1-1m4 1a.5.5 0 0 0-.5.5V3a1 1 0 0 1-.106.447L5.053 6.13A.5.5 0 0 0 5 6.355V7.5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 .5-.5V6.354a.5.5 0 0 0-.053-.224L9.606 3.448A1 1 0 0 1 9.5 3v-.5A.5.5 0 0 0 9 2z","clip-rule":"evenodd"},void 0,0,{fileName:ct,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:ct,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:ct,lineNumber:11,columnNumber:5},this)}var dt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/PointerDown.tsx";function ut(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"9","data-component":"PointerDownIcon",...e,children:Pe("path",{
stroke:"currentColor",d:"m15.5 0-7 8-8-8"},void 0,0,{fileName:dt,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:dt,lineNumber:11,columnNumber:5},this)}var ft="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/PointerUp.tsx";function mt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"9","data-component":"PointerUpIcon",...e,children:Pe("path",{stroke:"currentColor",d:"m.5 9 7-8 8 8"},void 0,0,{fileName:ft,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:ft,lineNumber:11,columnNumber:5},this)}var pt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Radio.tsx";function gt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"RadioIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:pt,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",
d:"M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8","clip-rule":"evenodd"},void 0,0,{fileName:pt,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:pt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:pt,lineNumber:11,columnNumber:5},this)}var _t="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/RadioChecked.tsx";function bt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"RadioCheckedIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:_t,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8","clip-rule":"evenodd"},void 0,0,{fileName:_t,lineNumber:22,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M14 8A6 6 0 1 1 2 8a6 6 0 0 1 12 0"},void 0,0,{fileName:_t,lineNumber:27,columnNumber:9},this)]},void 0,0,{
fileName:_t,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:_t,lineNumber:11,columnNumber:5},this)}var wt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Selection.tsx";function vt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"SelectionIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:wt,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",
d:"M2.5 0h-1A1.5 1.5 0 0 0 0 1.5v1a1.5 1.5 0 0 0 1 1.415v8.17A1.5 1.5 0 0 0 0 13.5v1A1.5 1.5 0 0 0 1.5 16h1a1.5 1.5 0 0 0 1.415-1h8.17a1.5 1.5 0 0 0 1.415 1h1a1.5 1.5 0 0 0 1.5-1.5v-1a1.5 1.5 0 0 0-1-1.415v-8.17A1.5 1.5 0 0 0 16 2.5v-1A1.5 1.5 0 0 0 14.5 0h-1a1.5 1.5 0 0 0-1.415 1h-8.17A1.5 1.5 0 0 0 2.5 0m9.585 13c.151-.426.489-.764.915-.915v-8.17A1.5 1.5 0 0 1 12.085 3h-8.17c-.151.426-.489.764-.915.915v8.17c.426.151.764.489.915.915zM1 1.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM1.5 13a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zM13 1.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm.5 11.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z","clip-rule":"evenodd"},void 0,0,{fileName:wt,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:wt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:wt,lineNumber:11,columnNumber:5},this)}
var yt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Show.tsx";function xt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"ShowIcon",...e,children:Pe("g",{"fill-rule":"evenodd",children:[Pe("path",{fill:"none",d:"M0 0h16v16H0z"},void 0,0,{fileName:yt,lineNumber:21,columnNumber:9},this),Pe("path",{fill:"currentColor",d:"M8 2c4.36 0 8 2.6 8 6s-3.64 6-8 6-8-2.6-8-6 3.64-6 8-6m0 2C4.628 4 2 5.877 2 8s2.628 4 6 4 6-1.877 6-4-2.628-4-6-4m2 4a2 2 0 1 0-4 0 2 2 0 0 0 4 0"},void 0,0,{fileName:yt,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:yt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:yt,lineNumber:11,columnNumber:5},this)}var Nt="/home/runner/work/frontend-shared/frontend-shared/src/components/input/Button.tsx";function Ct({children:e,classes:t,elementRef:n,expanded:o,pressed:i,title:r,icon:s,size:a="md",variant:l="secondary",unstyled:c=!1,role:h,...d}){
const u=!c,f=u&&"custom"!==l,m=u&&"custom"!==a,p={"aria-label":r};return"tab"===h?p["aria-selected"]=i:(p["aria-pressed"]=i,p["aria-expanded"]=o),Pe("button",{role:null!=h?h:"button","data-component":"Button",type:"button",...p,...d,className:Re({"focus-visible-ring transition-colors whitespace-nowrap flex items-center":u},f&&{"font-semibold rounded":!0,"text-grey-7 bg-grey-1 enabled:hover:text-grey-9 enabled:hover:bg-grey-2 aria-pressed:text-grey-9 aria-expanded:text-grey-9":"secondary"===l,"text-grey-1 bg-grey-7 enabled:hover:bg-grey-8 disabled:text-grey-4":"primary"===l},m&&{"p-2 gap-x-2":"md"===a,"p-1 gap-x-1":"xs"===a,"p-1.5 gap-x-1.5":"sm"===a,"p-2.5 gap-x-1.5":"lg"===a},t),ref:n,title:r,children:[s&&Pe(s,{className:"w-em h-em"},void 0,0,{fileName:Nt,lineNumber:120,columnNumber:16},this),e]},void 0,0,{fileName:Nt,lineNumber:89,columnNumber:5},this)}
const St=Re("input-group:border input-group:rounded-none","input-group:first:rounded-l input-group:last:rounded-r","input-group:ml-[-1px] input-group:first:ml-0","focus:z-1");var At="/home/runner/work/frontend-shared/frontend-shared/src/components/input/IconButton.tsx";function kt({children:e,classes:t,elementRef:n,pressed:o,expanded:i,icon:r,size:s="md",title:a,variant:l="secondary",unstyled:c=!1,...h}){const d=!c;return Pe(Ct,{"data-component":"IconButton",...h,classes:Re({"focus-visible-ring transition-colors rounded whitespace-nowrap":d,"flex items-center justify-center":d},d&&St,d&&"custom"!==l&&{"text-grey-7 bg-transparent enabled:hover:text-grey-9 aria-pressed:text-brand aria-expanded:text-brand":"secondary"===l,"text-brand bg-transparent enabled:hover:text-grey-9 disabled:text-grey-7":"primary"===l,"text-grey-7 bg-grey-2 enabled:hover:text-grey-9 enabled:hover:bg-grey-3 disabled:text-grey-5 aria-pressed:bg-grey-3 aria-expanded:bg-grey-3":"dark"===l},d&&"custom"!==s&&{
"gap-x-2 touch:min-w-touch-minimum touch:min-h-touch-minimum":!0,"p-2":"md"===s,"p-1":"xs"===s,"p-1.5":"sm"===s,"p-2.5":"lg"===s},t),elementRef:n,title:a,pressed:o,expanded:i,unstyled:!0,children:[r&&Pe(r,{className:"w-em h-em"},void 0,0,{fileName:At,lineNumber:84,columnNumber:16},this),e]},void 0,0,{fileName:At,lineNumber:49,columnNumber:5},this)}var Rt="/home/runner/work/frontend-shared/frontend-shared/src/components/input/ToggleInput.tsx";function Et({children:e,elementRef:t,containerRef:n,checked:o,icon:i,checkedIcon:r,disabled:s,onChange:a,id:l,type:c,containerClasses:h,...d}){const u=o?r:i;return Pe("label",{className:Re("relative flex items-center gap-x-1.5",{"cursor-pointer":!s,"opacity-70":s},h),htmlFor:l,"data-composite-component":"checkbox"===c?"Checkbox":"RadioButton",ref:n,children:[Pe("input",{...d,type:c,ref:t,className:Re("peer","absolute w-em h-em","opacity-[.00001]",{"cursor-pointer":!s}),checked:o,disabled:s,id:l,onChange:a},void 0,0,{fileName:Rt,lineNumber:66,columnNumber:7},this),Pe(u,{
className:Re("peer-focus-visible:ring","w-em h-em")},void 0,0,{fileName:Rt,lineNumber:88,columnNumber:7},this),e]},void 0,0,{fileName:Rt,lineNumber:51,columnNumber:5},this)}var Pt="/home/runner/work/frontend-shared/frontend-shared/src/components/input/Checkbox.tsx";function Tt({checked:e,defaultChecked:t=!1,icon:n=Ge,checkedIcon:o=Je,onChange:i,...r}){const s="boolean"==typeof e,[a,l]=ee(t);return Pe(Et,{icon:n,checkedIcon:o,type:"checkbox",checked:s?e:a,onChange:function(e){null==i||i.call(this,e),s||l(e.target.checked)},...r},void 0,0,{fileName:Pt,lineNumber:65,columnNumber:5},this)}const Mt=D(null);var Ot="/home/runner/work/frontend-shared/frontend-shared/src/components/input/RadioGroup.tsx";function It({value:e,children:t,subtitle:n,disabled:o}){const i=se(Mt);if(!i)throw new Error("RadioGroup.Radio can only be used as RadioGroup child");const{selected:r,disabled:s=o,onChange:a}=i,l=!s&&r===e;return Pe("div",{role:"radio","aria-checked":l,"aria-disabled":s,
className:Re("focus-visible-ring rounded-lg px-3 py-2 flex-1 group",{"bg-grey-3/50":l,"hover:bg-grey-3/25":!l&&!s,"opacity-70":s,"cursor-pointer":!s}),"data-value":e,onClick:s?void 0:()=>a(e),onKeyDown:s?void 0:t=>{["Enter"," "].includes(t.key)&&(t.preventDefault(),a(e))},tabIndex:-1,children:[Pe("div",{className:"flex items-center gap-x-1.5",children:[l?Pe(bt,{},void 0,0,{fileName:Ot,lineNumber:68,columnNumber:23},this):Pe(gt,{},void 0,0,{fileName:Ot,lineNumber:68,columnNumber:46},this),t]},void 0,0,{fileName:Ot,lineNumber:67,columnNumber:7},this),n&&Pe("div",{className:Re("pl-4 ml-1.5 mt-1 text-sm",{"text-grey-7":l,"text-grey-6 group-hover:text-grey-7":!l&&!s}),children:n},void 0,0,{fileName:Ot,lineNumber:72,columnNumber:9},this)]},void 0,0,{fileName:Ot,lineNumber:40,columnNumber:5},this)}It.displayName="RadioGroup.Radio",Object.assign((function({direction:e="horizontal",children:t,selected:n,onChange:o,disabled:i,"aria-label":r,"aria-labelledby":s,name:a}){const l=oe(null);return be(l,{loop:!1,
selector:'[role="radio"]:not([aria-disabled="true"])',focusElement:e=>{o(e.dataset.value),e.focus()}}),Pe(Mt.Provider,{value:{selected:n,disabled:i,onChange:o},children:[Pe("div",{"aria-label":r,"aria-labelledby":s,ref:l,role:"radiogroup",className:Re("w-full flex gap-1.5",{"flex-col":"vertical"===e}),children:t},void 0,0,{fileName:Ot,lineNumber:134,columnNumber:7},this),a&&Pe("input",{type:"hidden","data-testid":"hidden-input",name:a,value:n,disabled:i},void 0,0,{fileName:Ot,lineNumber:146,columnNumber:9},this)]},void 0,0,{fileName:Ot,lineNumber:131,columnNumber:5},this)}),{Radio:It,displayName:"RadioGroup"});var Lt="/home/runner/work/frontend-shared/frontend-shared/src/components/feedback/Popover.tsx";const Bt=".15rem",Ht=8;function Ft(e,t,n,o,i){te((()=>{if(!i)return()=>{};const t=e.current,o=e=>{"open"===e.oldState&&"closed"===e.newState&&n()};return t.addEventListener("toggle",o),()=>t.removeEventListener("toggle",o)}),[i,n,e]);const r=o&&!i;!function(e,t,{enabled:n=!0}={}){te((()=>{if(!n)return()=>{}
;const o=document.body,i=new ge,r=n=>{e.current&&!n.composedPath().includes(e.current)&&t(n)};return i.add(o,"mousedown",r),i.add(o,"click",r),()=>{i.removeAll()}}),[e,n,t])}(e,(e=>{e.composedPath().includes(t.current)||n()}),{enabled:r}),function(e,t,{enabled:n=!0}={}){te((()=>{if(!n)return()=>{};const o=document.body,i=new ge;return i.add(o,"keydown",(n=>{e.includes(n.key)&&t(n)})),()=>{i.removeAll()}}),[n,t,e])}(["Escape"],n,{enabled:r})}function Dt({anchorElementRef:e,children:t,open:n,onClose:o,align:i="left",classes:r,variant:s="panel",onScroll:a,elementRef:l,asNativePopover:c=HTMLElement.prototype.hasOwnProperty("popover")}){const h=ye(l);return function(e,t,n,o,i){const r=re((()=>{const n=t.current,r=e.current,s=e=>{Object.assign(n.style,e);const t=Object.keys(e);return()=>t.map((e=>n.style[e]=""))},a=window.innerHeight,{top:l,bottom:c,left:h,height:d,width:u}=r.getBoundingClientRect(),f=a-c,{height:m,width:p}=n.getBoundingClientRect(),g=f<m&&l>f;if(!o)return s(g?{bottom:"100%",marginBottom:Bt}:{
top:"100%",marginTop:Bt});const{top:_,width:b}=document.body.getBoundingClientRect(),w=Math.abs(_),v=(i?h+u:b-h)-Ht;let y=h;return p>v?y=i?Ht:y-(p-v):i&&p>u&&(y-=p-u),s({minWidth:`${u}px`,top:g?`calc(${w+l-m}px - ${Bt})`:`calc(${w+l+d}px + ${Bt})`,left:`${Math.max(Ht,y)}px`})}),[o,e,t,i]);ne((()=>{if(!n)return()=>{};const e=t.current;o&&e.togglePopover(!0);const i=r();if(!o)return i;const s=new ge;s.add(document.body,"scroll",r,{capture:!0});const a=new ResizeObserver(r);return a.observe(e),()=>{o&&(null==e||e.togglePopover(!1)),i(),s.removeAll(),a.disconnect()}}),[r,o,n,t])}(e,h,n,c,"right"===i),Ft(h,e,o,n,c),function({popoverRef:e,open:t}){ne((()=>{const n=e.current,o=t?document.activeElement:null;return n&&o?()=>{const e=document.activeElement;e&&!n.contains(e)&&e!==document.body||o.focus()}:()=>{}}),[e,t])}({open:n,popoverRef:h}),Pe("div",{
className:Re("absolute z-5","panel"===s&&["max-h-80 overflow-y-auto overflow-x-hidden","rounded border bg-white shadow hover:shadow-md focus-within:shadow-md"],c&&["max-w-[calc(100%-16px)]","p-0 m-0"],!c&&{hidden:!n,"right-0":"right"===i,"min-w-full":!0},r),ref:h,popover:c&&"auto",onScroll:a,"data-testid":"popover","data-component":"Popover",children:n&&t},void 0,0,{fileName:Lt,lineNumber:356,columnNumber:5},this)}const Vt=D(null);var Ut="/home/runner/work/frontend-shared/frontend-shared/src/components/input/Select.tsx";function qt(e,t){return"function"==typeof e?e(t):e}function $t({value:e,children:t,disabled:n=!1,classes:o,elementRef:i,title:r}){const s=oe(null),a=oe(null),l=ye(i),c=e=>e.target===s.current||e.target===a.current,h=se(Vt);if(!h)throw new Error("Select.Option can only be used as Select or MultiSelect child");const{selectValue:d,value:u,multiple:f}=h,m=ie((()=>!n&&(f?u.includes(e)||0===u.length&&void 0===e:u===e)),[u,n,f,e]),p=re((()=>{const t={closeListbox:!0};d(f?void 0!==e?[e]:[]:e,t)
}),[f,d,e]),g=re((()=>{if(!f)return;const t={closeListbox:void 0===e};if(void 0===e)return void d([],t);const n=u.indexOf(e);if(-1===n)d([...u,e],t);else{const e=[...u];e.splice(n,1),d(e,t)}}),[u,f,d,e]);return Pe("li",{className:Re("w-full ring-inset outline-none rounded-none select-none","px-1 mb-1 first:mt-1 whitespace-nowrap group",{"text-grey-4":n,"cursor-pointer":!n},o),onClick:e=>{n||c(e)||p()},onKeyDown:e=>{n||(["Enter"," "].includes(e.key)&&!c(e)?(e.preventDefault(),p()):s.current&&"ArrowRight"===e.key&&(e.preventDefault(),s.current.focus()))},role:"option","aria-disabled":n,"aria-selected":m,tabIndex:m?0:-1,ref:l,title:r,children:Pe("div",{className:Re("flex justify-between items-center","w-full rounded",{"hover:bg-grey-1 group-focus-visible:ring":!n,"bg-grey-1 hover:bg-grey-2":m}),children:[Pe("div",{className:Re("py-2 pl-3",{truncate:"truncate"===h.listboxOverflow,"whitespace-normal":"wrap"===h.listboxOverflow}),children:qt(t,{selected:m,disabled:n})},void 0,0,{fileName:Ut,lineNumber:203,
columnNumber:9},this),!f&&Pe("div",{className:"px-3",children:Pe(Ye,{className:Re("text-grey-6 scale-125",{"opacity-0":!m})},void 0,0,{fileName:Ut,lineNumber:213,columnNumber:13},this)},void 0,0,{fileName:Ut,lineNumber:212,columnNumber:11},this),f&&Pe(Tt,{containerClasses:Re("self-stretch px-3","text-lg",{"text-grey-6":m,"text-grey-3 hover:text-grey-6":!m}),checked:m,checkedIcon:Je,elementRef:s,containerRef:a,onChange:g,onKeyDown:e=>{var t;"ArrowLeft"===e.key&&(e.preventDefault(),null===(t=l.current)||void 0===t||t.focus())}},void 0,0,{fileName:Ut,lineNumber:224,columnNumber:11},this)]},void 0,0,{fileName:Ut,lineNumber:193,columnNumber:7},this)},void 0,0,{fileName:Ut,lineNumber:146,columnNumber:5},this)}function zt({buttonContent:e,value:t,onChange:n,children:o,disabled:i,elementRef:r,buttonId:s,buttonClasses:a,popoverClasses:l,containerClasses:c,onPopoverScroll:h,alignListbox:d="left",multiple:u,listboxOverflow:f="truncate","aria-label":m,"aria-labelledby":p,listboxAsPopover:g}){
const _=oe(null),b=oe(null),[w,v]=ee(!1),y=re((()=>v(!1)),[v]),x=ae(),N=ye(r),C=ae(),S=re(((e,t)=>{n(e),t.closeListbox&&y()}),[n,y]);return function(e,t,{enabled:n=!0}={}){te((()=>{if(!n||!e.current)return()=>{};const o=new ge;return o.add(e.current,"focusout",(n=>{const o=n;e.current&&!e.current.contains(o.relatedTarget)&&t(o)})),()=>{o.removeAll()}}),[e,n,t])}(_,y),be(b,{horizontal:!1,loop:!1,autofocus:!0,containerVisible:w,selector:'[role="option"]:not([aria-disabled="true"])'}),Pe("div",{className:Re("relative w-full border rounded",{"border-grey-5":w},St,c),ref:_,children:[Pe("button",{id:null!=s?s:C,className:Re("focus-visible-ring transition-colors whitespace-nowrap","w-full flex items-center justify-between gap-x-2","bg-grey-0 disabled:bg-grey-1 disabled:text-grey-6","text-left","rounded-[inherit]",a),type:"button",role:"combobox",disabled:i,"aria-expanded":w,"aria-haspopup":"listbox","aria-controls":x,"aria-label":m,"aria-labelledby":p,ref:N,onClick:()=>v((e=>!e)),onKeyDown:e=>{
"ArrowDown"!==e.key||w||(e.preventDefault(),v(!0))},"data-testid":"select-toggle-button",children:[Pe("div",{className:"pl-2 py-2 truncate grow",children:e},void 0,0,{fileName:Ut,lineNumber:429,columnNumber:9},this),Pe("div",{className:"pr-2 py-2 text-grey-6",children:w?Pe(it,{},void 0,0,{fileName:Ut,lineNumber:431,columnNumber:26},this):Pe(st,{},void 0,0,{fileName:Ut,lineNumber:431,columnNumber:49},this)},void 0,0,{fileName:Ut,lineNumber:430,columnNumber:9},this)]},void 0,0,{fileName:Ut,lineNumber:396,columnNumber:7},this),Pe(Vt.Provider,{value:{value:t,selectValue:S,multiple:u,listboxOverflow:f},children:Pe(Dt,{anchorElementRef:_,open:w,onClose:y,asNativePopover:g,align:d,classes:l,onScroll:h,children:Pe("ul",{role:"listbox",id:x,ref:b,"aria-multiselectable":u,"aria-labelledby":null!=s?s:C,"aria-orientation":"vertical",children:o},void 0,0,{fileName:Ut,lineNumber:453,columnNumber:11},this)},void 0,0,{fileName:Ut,lineNumber:444,columnNumber:9},this)},void 0,0,{fileName:Ut,lineNumber:435,columnNumber:7
},this)]},void 0,0,{fileName:Ut,lineNumber:387,columnNumber:5},this)}$t.displayName="Select.Option",Object.assign((function(e){return zt({...e,multiple:!1})}),{Option:$t,displayName:"Select"}),Object.assign((function(e){return zt({...e,multiple:!0})}),{Option:$t,displayName:"MultiSelect"}),D({}),D(null);var Wt="/home/runner/work/frontend-shared/frontend-shared/src/components/feedback/Callout.tsx";function jt({children:e,classes:t,elementRef:n,icon:o,status:i="notice",size:r="md",variant:s="outlined",unstyled:a=!1,...l}){const c=!a,h=c&&"custom"!==s,d=c&&"custom"!==r;let u=o;if(!u)switch(i){case"success":u=Ye;break;case"error":u=Fe;break;default:u=je}const f=h&&d;return Pe("div",{"data-component":"Callout",...l,ref:n,className:Re(c&&"flex items-center border",h&&{"rounded border":!0,"shadow hover:shadow-md cursor-pointer":"raised"===s,"border-yellow-notice":"notice"===i,"border-green-success":"success"===i,"border-red-error":"error"===i},h&&{"bg-yellow-notice":"notice"===i&&f,
"bg-green-success":"success"===i&&f,"bg-red-error":"error"===i&&f,"bg-white":!f},t),children:[f&&Pe("div",{className:Re({"p-2":"md"===r,"p-1.5":"sm"===r,"p-3":"lg"===r}),children:Pe(u,{"data-testid":"callout-icon",className:Re("text-white",{"w-[1.25em] h-[1.25em]":"md"===r,"w-[0.85em] h-[0.85em]":"sm"===r,"w-[1.5em] h-[1.5em]":"lg"===r})},void 0,0,{fileName:Wt,lineNumber:95,columnNumber:11},this)},void 0,0,{fileName:Wt,lineNumber:88,columnNumber:9},this),Pe("div",{className:Re(d&&{"p-2":"md"===r,"py-1.5 px-2":"sm"===r,"p-3":"lg"===r},c&&"grow",h&&"bg-white rounded-r"),children:e},void 0,0,{fileName:Wt,lineNumber:105,columnNumber:7},this)]},void 0,0,{fileName:Wt,lineNumber:64,columnNumber:5},this)}var Xt="/home/runner/work/frontend-shared/frontend-shared/src/components/feedback/ToastMessages.tsx";function Yt({message:e,onDismiss:t}){return Pe(jt,{classes:Re({"sr-only":e.visuallyHidden}),status:e.type,onClick:()=>t(e.id),variant:"raised",children:e.message},void 0,0,{fileName:Xt,lineNumber:55,columnNumber:5
},this)}const Kt=({direction:e,onTransitionEnd:t,children:n,transitionClasses:o={}})=>{const i="out"===e,r=oe(null),s=ie((()=>{const{transitionIn:e="animate-fade-in",transitionOut:t="animate-fade-out"}=o;return{[e]:!i,[t]:i}}),[i,o]);return Pe("div",{"data-testid":"animation-container",onAnimationEnd:n=>{n.target===r.current&&(null==t||t(null!=e?e:"in"))},ref:r,className:Re("relative w-full container",s),children:n},void 0,0,{fileName:Xt,lineNumber:103,columnNumber:5},void 0)};function Gt({messages:e,onMessageDismiss:t,transitionClasses:n,setTimeout_:o=setTimeout}){const[i,r]=ee([]),s=oe(new Map),a=re((e=>r((t=>[...t,e]))),[]),l=re((e=>{const t=o((()=>{a(e),s.current.delete(e)}),5e3);s.current.set(e,t)}),[a,o]),c=re(((e,n)=>{var o;const i=null===(o=n.autoDismiss)||void 0===o||o;"in"===e&&i&&l(n.id),"out"===e&&(t(n.id),r((e=>e.filter((e=>e!==n.id)))))}),[l,t]);return ne((()=>{const e=s.current;return()=>{e.forEach((e=>clearTimeout(e)))}}),[]),Pe("ul",{"aria-live":"polite","aria-relevant":"additions",
className:"w-full space-y-2","data-component":"ToastMessages",children:e.map((e=>{const t=i.includes(e.id);return Pe("li",{className:Re({"mb-2":!e.visuallyHidden}),children:Pe(Kt,{direction:t?"out":"in",onTransitionEnd:t=>c(t,e),transitionClasses:n,children:Pe(Yt,{message:e,onDismiss:a},void 0,0,{fileName:Xt,lineNumber:206,columnNumber:15},this)},void 0,0,{fileName:Xt,lineNumber:201,columnNumber:13},this)},e.id,0,{fileName:Xt,lineNumber:189,columnNumber:11},this)}))},void 0,0,{fileName:Xt,lineNumber:180,columnNumber:5},this)}var Qt="/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/Link.tsx";function Jt({children:e,classes:t,elementRef:n,underline:o="none",unstyled:i=!1,variant:r="brand",...s}){const a=!i;return Pe("a",{"data-component":"Link",rel:"noopener noreferrer",...s,className:Re(a&&{"focus-visible-ring rounded":!0,"no-underline hover:no-underline":"none"===o,"underline hover:underline":"always"===o,"no-underline hover:underline":"hover"===o},a&&"custom"!==r&&{
"text-brand hover:text-brand-dark":"brand"===r,"text-color-text-light hover:text-brand":"text-light"===r,"text-color-text hover:text-brand-dark":"text"===r},t),ref:n,children:e},void 0,0,{fileName:Qt,lineNumber:37,columnNumber:5},this)}var Zt="/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/PointerButton.tsx";function en({children:e,classes:t,elementRef:n,expanded:o,pressed:i,title:r,direction:s,...a}){return Pe(Ct,{"data-component":"PointerButton",...a,elementRef:n,classes:Re("relative w-[26px] h-[16px]","flex items-center justify-center","bg-white rounded-[4px] border","before:absolute before:border-transparent","after:absolute after:border-transparent","text-[10px] text-color-text-light leading-none font-semibold",{"shadow-[1px_1px_1px_rgba(0,0,0,0.1)]":"down"!==s,"shadow-[1px_0px_1px_rgba(0,0,0,0.1)]":"down"===s},{"rounded-r-[4px] rounded-l-[2px]":"left"===s,"before:right-full before:top-1/2 after:right-full after:top-1/2":"left"===s,
"before:mt-[-8px] before:border-8 before:border-r-[5px] before:border-r-grey-3":"left"===s,"after:mt-[-7px] after:border-[7px] after:border-r-[4px] after:border-r-white":"left"===s},{"z-1 rounded-t-px-sm rounded-b-px":"up"===s,"before:top-auto before:left-1/2 before:bottom-full after:top-auto after:left-1/2 after:bottom-full":"up"===s,"before:ml-[-13px] before:border-[13px] before:border-b-[6px] before:border-b-grey-3":"up"===s,"after:ml-[-12px] after:border-[12px] after:border-b-[5px] after:border-b-white":"up"===s},{"z-1 rounded-t-px rounded-b-px-sm":"down"===s,"before:top-full before:left-1/2 after:top-full after:left-1/2":"down"===s,"before:ml-[-13px] before:border-[13px] before:border-t-[6px] before:border-t-grey-3":"down"===s,"after:ml-[-12px] after:border-[12px] after:border-t-[5px] after:border-t-white":"down"===s},t),expanded:o,pressed:i,title:r,variant:"custom",size:"custom",children:e},void 0,0,{fileName:Zt,lineNumber:48,columnNumber:5},this)}function tn(e){const t=e.toString(16)
;return 1===t.length?"0"+t:t}function nn(e){const t=new Uint8Array(e/2);return window.crypto.getRandomValues(t),Array.from(t).map(tn).join("")}function on(e){if(null===e||"object"!=typeof e)return!1;for(const t of["frame1","frame2","type","requestId"])if("string"!=typeof e[t])return!1;return!0}class rn extends Error{constructor(e){super(e)}}class sn{constructor({hostFrame:e,source:t,sourceId:n}){this._hostFrame=e,this._source=t,this._sourceId=n,this._listeners=new ge}destroy(){this._listeners.removeAll()}async discover(e){const t=nn(6);return new Promise(((n,o)=>{const i=()=>{this._hostFrame.postMessage({frame1:this._source,frame2:e,type:"request",requestId:t,sourceId:this._sourceId},"*")},r=setInterval(i,250),s=setTimeout((()=>{clearInterval(r),o(new rn(`Unable to establish ${this._source}-${e} communication channel`))}),2e4),a=this._listeners.add(window,"message",(i=>{const{data:l,ports:c}=i;on(l)&&l.requestId===t&&"request"!==l.type&&(clearInterval(r),clearTimeout(s),this._listeners.remove(a),
"string"==typeof l.error?o(new rn(l.error)):c.length>0?n(c[0]):o(new rn(`${this._source}-${e} port request failed`)))}));i()}))}}class an{#e=[];destroy(){this.#e=[]}on(e,t){this.#e.push({name:e,callback:t})}off(e,t){this.#e=this.#e.filter((n=>!(n.name===e&&n.callback===t)))}emit(e,...t){for(const n of this.#e){if(n.name!==e)continue;(0,n.callback)(...t)}}}let ln=null;function cn(e){return e instanceof Error?{message:e.message,stack:e.stack}:{message:String(e),stack:void 0}}function hn(e,t){if(!ln)return;const n={type:"hypothesis-error",error:e instanceof Error?e:cn(e),context:t};try{try{ln.postMessage(n,"*")}catch(e){if(!(e instanceof DOMException&&"DataCloneError"===e.name))throw e;n.error=cn(n.error),ln.postMessage(n,"*")}}catch(e){console.warn("Unable to report Hypothesis error",e)}}function dn(e){ln=e}class un{constructor(e){this._hypothesisAppsOrigin=e,this._emitter=new an,this._handledRequests=new Set,this._sidebarHostChannel=new MessageChannel,this._sidebarConnected=!1,this._listeners=new ge,
this._allowedMessages=[{allowedOrigin:"*",frame1:"guest",frame2:"host",type:"request"},{allowedOrigin:"*",frame1:"guest",frame2:"sidebar",type:"request"},{allowedOrigin:this._hypothesisAppsOrigin,frame1:"sidebar",frame2:"host",type:"request"},{allowedOrigin:this._hypothesisAppsOrigin,frame1:"notebook",frame2:"sidebar",type:"request"}],this._listen()}_listen(){const e="Handling port request",t=new Set,n=n=>{t.has(n)||(t.add(n),hn(new Error(n),e))};var o,i;this._listeners.add(window,"message",(o=e=>{const{data:t,origin:o,source:i}=e;if(!i)return;if(!on(t)||"request"!==t.type)return;const{frame1:r,frame2:s,requestId:a,sourceId:l}=t,c=`${r}-${s}`;if(!function(e){return!(null===e||e instanceof MessagePort||window.ServiceWorker&&e instanceof ServiceWorker)}(i))return void n(`Ignored port request for channel ${c} from non-Window source`);if(void 0===this._allowedMessages.find((({allowedOrigin:e,...n})=>this._messageMatches({allowedMessage:n,allowedOrigin:e,data:t,origin:o
}))))return void n(`Ignored invalid port request for channel ${c} from ${o}`);if(this._handledRequests.has(a))return;this._handledRequests.add(a);const h="null"===o?"*":o,d="sidebar-host"===c?this._sidebarHostChannel:new MessageChannel,u={frame1:r,frame2:s,type:"offer",requestId:a,sourceId:l};if(d===this._sidebarHostChannel){if(this._sidebarConnected)return console.warn("Ignoring second request from Hypothesis sidebar to connect to host frame"),u.error="Received duplicate port request",void i.postMessage(u,h);this._sidebarConnected=!0}i.postMessage(u,h,[d.port1]),"sidebar"===s?this._sidebarHostChannel.port2.postMessage(u,[d.port2]):"host"===s&&this._emitter.emit("frameConnected",r,d.port2)},i=e,(...e)=>{try{return o(...e)}catch(e){throw hn(e,i),e}}))}_messageMatches({allowedMessage:e,allowedOrigin:t,data:n,origin:o}){return("*"===t||o===t)&&function(e,t){return!!on(e)&&JSON.stringify(e,Object.keys(t).sort())===JSON.stringify(t,Object.keys(t).sort())}(n,e)}on(e,t){this._emitter.on(e,t)}destroy(){
this._listeners.removeAll()}}const fn="1.0.0",mn="frame-rpc";function pn(e,t=[],n=-1){return{protocol:mn,version:fn,arguments:t,method:e,sequence:n}}function gn(e,t,n=[],o=-1){e.postMessage(pn(t,n,o))}class _n{constructor({currentWindow:e=window,forceUnloadListener:t=!1}={}){this._port=null,this._methods=new Map,this._sequence=1,this._callbacks=new Map,this._listeners=new ge,"onclose"in MessagePort.prototype&&!t||this._listeners.add(e,"unload",(e=>{e instanceof CustomEvent||this._port&&gn(this._port,"close")})),this._pendingCalls=[],this._destroyed=!1,this._receivedCloseEvent=!1}on(e,t){if(this._port)throw new Error("Cannot add a method handler after a port is connected");this._methods.set(e,t)}connect(e){this._port=e,this._listeners.add(e,"message",(e=>this._handle(e))),this._listeners.add(e,"close",(()=>{e.dispatchEvent(new MessageEvent("message",{data:pn("close")}))})),e.start(),gn(e,"connect");for(const[e,t]of this._pendingCalls)this.call(e,...t);this._pendingCalls=[]}destroy(){
this._port&&(gn(this._port,"close"),this._port.close()),this._destroyed=!0,this._listeners.removeAll()}call(e,...t){if(this._port||this._pendingCalls.push([e,t]),!this._port||this._destroyed)return;const n=this._sequence++,o=t[t.length-1];"function"==typeof o&&(this._callbacks.set(n,o),t=t.slice(0,-1)),gn(this._port,e,t,n)}_parseMessage({data:e}){return e&&"object"==typeof e?e.protocol!==mn||e.version!==fn?null:Array.isArray(e.arguments)?e:null:null}_handle(e){const t=this._parseMessage(e),n=this._port;if(t&&n)if("method"in t){if("close"===t.method){if(this._receivedCloseEvent)return;this._receivedCloseEvent=!0}const e=this._methods.get(t.method);if(!e)return;const o=(...e)=>{const o={arguments:e,protocol:mn,response:t.sequence,version:fn};n.postMessage(o)};e(...t.arguments,o)}else if("response"in t){const e=this._callbacks.get(t.response);this._callbacks.delete(t.response),e&&e(...t.arguments)}}}function bn(e){if("string"==typeof e&&"false"===e.trim().toLocaleLowerCase())return!1;const t=Number(e)
;return isNaN(t)?"string"==typeof e:Boolean(t)}function wn(e){for(var t={},n=e.querySelectorAll("script.js-hypothesis-config"),o=0;o<n.length;o++){var i=void 0;try{i=JSON.parse(n[o].textContent||"")}catch(e){console.warn("Could not parse settings from js-hypothesis-config tags",e),i={}}Object.assign(t,i)}return t}function vn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function yn(e){return e.width<=0||e.height<=0}function xn(e,t,n,o){return Math.max(e,n)<Math.min(t,o)}function Nn(e,t){return!yn(e)&&!yn(t)&&(xn(e.left,e.right,t.left,t.right)&&xn(e.top,e.bottom,t.top,t.bottom))}function Cn(e,t){return xn(e.top,e.bottom,t.top,t.bottom)}function Sn(e,t){return xn(e.left,e.right,t.left,t.right)}function An(e,t){if(yn(e))return t;if(yn(t))return e;const n=Math.min(e.left,t.left),o=Math.min(e.top,t.top),i=Math.max(e.right,t.right),r=Math.max(e.bottom,t.bottom);return new DOMRect(n,o,i-n,r-o)}function kn(e){return new DOMPoint((e.left+e.right)/2,(e.top+e.bottom)/2)}function Rn(e){
return e.nodeType===Node.ELEMENT_NODE}function En(e){return e.nodeType===Node.TEXT_NODE}const Pn=["p",".para"];let Tn;function Mn(e,t=0,n=e.data.length){return Tn||(Tn=document.createRange()),Tn.setStart(e,t),Tn.setEnd(e,n),Tn.getBoundingClientRect()}function On(e){const t=e.getBoundingClientRect();return t.x-=e.scrollLeft,t.y-=e.scrollTop,t.height=Math.max(t.height,e.scrollHeight),t.width=Math.max(t.width,e.scrollWidth),t}function*In(e,t,n){let o=e.firstChild;for(;o;){if(Rn(o)){const e=Nn(On(o),t);n(o)&&e&&(yield*In(o,t,n))}else En(o)&&Nn(Mn(o),t)&&(yield o);o=o.nextSibling}}function Ln(e,t){let n=null;const o=e=>!function(e){switch(getComputedStyle(e).position){case"fixed":case"sticky":return!0;default:return!1}}(e);e:for(const s of In(e,t,o)){let e=0;for(const o of s.data.split(/\b/)){if(/\S/.test(o)){const a=e,l=e+o.length,c=Mn(s,a,l);if(r=c,!yn(i=t)&&!yn(r)&&r.left>=i.left&&r.right<=i.right&&r.top>=i.top&&r.bottom<=i.bottom){n=document.createRange(),n.setStart(s,a),n.setEnd(s,l);break e}}e+=o.length}}
var i,r;return n}function Bn(e,t=document.documentElement,n=new DOMRect(0,0,window.innerWidth,window.innerHeight)){const o=Ln(t,n);if(!o)return e(),0;const i=o.getBoundingClientRect().top;e();const r=o.getBoundingClientRect().top-i;return t.scrollTop+=r,r}function Hn(e,t,n){const o=e.document.querySelector(`link[type="application/annotator+${n}"][rel="${t}"]`);if(!o)throw new Error(`No application/annotator+${n} (rel="${t}") link in the document`);if(!o.href)throw new Error(`application/annotator+${n} (rel="${t}") link has no href`);return o.href}function Fn(e){return"string"==typeof e?e:null}function Dn(e){const t=function(e){if(!vn(e,"hypothesisConfig"))return{};if("function"!=typeof e.hypothesisConfig){const e="https://h.readthedocs.io/projects/client/en/latest/publishers/config/#window.hypothesisConfig";return console.warn("hypothesisConfig must be a function, see: "+e),{}}return e.hypothesisConfig()}(e),n=bn(t.ignoreOtherConfiguration)?{}:wn(e.document);function o(e){
return vn(t,e)?t[e]:vn(n,e)?n[e]:void 0}return{get annotations(){return Fn(n.annotations)||function(){const t=e.location.href.match(/#annotations:([A-Za-z0-9_-]+)$/);return t?t[1]:null}()},get clientUrl(){return Hn(e,"hypothesis-client","javascript")},get group(){return Fn(n.group)||function(){const t=e.location.href.match(/#annotations:group:([A-Za-z0-9_-]+)$/);return t?t[1]:null}()},get notebookAppUrl(){return Hn(e,"notebook","html")},get profileAppUrl(){return Hn(e,"profile","html")},get showHighlights(){return function(){const e=o("showHighlights");switch(e){case"always":case"never":case"whenSidebarOpen":return e;case!0:return"always";case!1:return"never";default:return"always"}}()},get sidebarAppUrl(){return Hn(e,"sidebar","html")},get query(){return Fn(n.query)||function(){const t=e.location.href.match(/#annotations:(query|q):(.+)$/i);if(t)try{return decodeURIComponent(t[2])}catch{}return null}()},get sideBySide(){return function(){const e=o("sideBySide");if(!function(e){
return null!==e&&"object"==typeof e}(e))return{mode:"auto"};const t="mode"in e&&function(e){return"string"==typeof e&&["auto","manual"].includes(e)}(e.mode)?e.mode:"auto";return"auto"===t?{mode:t}:{mode:t,isActive:"isActive"in e&&"function"==typeof e.isActive?e.isActive:void 0}}()},hostPageSetting:o}}const Vn=(e,t)=>e.hostPageSetting(t),Un={annotations:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.annotations},appType:{allowInBrowserExt:!0,defaultValue:null,getValue:Vn},branding:{defaultValue:null,allowInBrowserExt:!1,getValue:Vn},bucketContainerSelector:{defaultValue:null,allowInBrowserExt:!1,getValue:Vn},clientUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.clientUrl},contentInfoBanner:{allowInBrowserExt:!1,defaultValue:null,getValue:Vn},contentReady:{allowInBrowserExt:!0,defaultValue:null,getValue:Vn},enableExperimentalNewNoteButton:{allowInBrowserExt:!1,defaultValue:null,getValue:Vn},group:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.group},focus:{allowInBrowserExt:!1,
defaultValue:null,getValue:Vn},theme:{allowInBrowserExt:!1,defaultValue:null,getValue:Vn},usernameUrl:{allowInBrowserExt:!1,defaultValue:null,getValue:Vn},onLayoutChange:{allowInBrowserExt:!1,defaultValue:null,getValue:Vn},openSidebar:{allowInBrowserExt:!0,defaultValue:!1,coerce:bn,getValue:Vn},query:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.query},requestConfigFromFrame:{allowInBrowserExt:!1,defaultValue:null,getValue:Vn},services:{allowInBrowserExt:!1,defaultValue:null,getValue:Vn},showHighlights:{allowInBrowserExt:!1,defaultValue:"always",getValue:e=>e.showHighlights},notebookAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.notebookAppUrl},profileAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.profileAppUrl},sidebarAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.sidebarAppUrl},subFrameIdentifier:{allowInBrowserExt:!0,defaultValue:null,getValue:Vn},externalContainerSelector:{allowInBrowserExt:!1,defaultValue:null,getValue:Vn},sideBySide:{
allowInBrowserExt:!0,getValue:e=>e.sideBySide}};function qn(e,t=window){const n=Dn(t),o={};for(const r of function(e){const t={annotator:["clientUrl","contentInfoBanner","contentReady","subFrameIdentifier","sideBySide"],sidebar:["appType","annotations","branding","bucketContainerSelector","enableExperimentalNewNoteButton","externalContainerSelector","focus","group","onLayoutChange","openSidebar","query","requestConfigFromFrame","services","showHighlights","sidebarAppUrl","theme","usernameUrl"],notebook:["branding","group","notebookAppUrl","requestConfigFromFrame","services","theme","usernameUrl"],profile:["profileAppUrl"]};return"all"===e?Object.values(t).flat():t[e]}(e)){const e=Un[r],s=void 0!==e.defaultValue,a=!((i=Hn(t,"sidebar","html")).startsWith("http://")||i.startsWith("https://"));if(!e.allowInBrowserExt&&a){s&&(o[r]=e.defaultValue);continue}const l=e.getValue(n,r);void 0!==l?o[r]=e.coerce?e.coerce(l):l:s&&(o[r]=e.defaultValue)}var i;return o}const $n={alt:1,ctrl:2,meta:4,shift:8};function zn(e,t){
if(!(e instanceof KeyboardEvent))return!1;const n=t.split("+").map((e=>e.toLowerCase()));let o=0,i=null;for(const e of n){const t=$n[e];if(t)o|=t;else{if(null!==i)throw new Error("Multiple non-modifier keys specified");i=e}}if(!i)throw new Error(`Invalid shortcut: ${t}`);return((e.ctrlKey?$n.ctrl:0)|(e.metaKey?$n.meta:0)|(e.altKey?$n.alt:0)|(e.shiftKey?$n.shift:0))===o&&e.key.toLowerCase()===i}function Wn(e,t,{rootElement:n}={}){te((()=>{if(e)return function(e,t,{rootElement:n=document.documentElement??void 0}={}){const o=n=>{zn(n,e)&&t(n)};return n?(n.addEventListener("keydown",o),()=>n.removeEventListener("keydown",o)):()=>{}}(e,t,{rootElement:n})}),[e,t,n])}const jn=(e=window)=>e.matchMedia("(pointer: coarse)").matches;function Xn({badgeCount:e}){return Pe("span",{className:Re("rounded px-1 py-0.5","bg-current"),children:Pe("span",{className:"font-bold text-color-text-inverted",children:e})})}function Yn({arrowDirection:e}){return Pe("div",{
className:Re("absolute left-1/2 -translate-x-1/2 z-2","fill-white text-grey-3",{"top-0 -translate-y-full":"up"===e}),children:Pe("up"===e?mt:ut,{})})}function Kn({badgeCount:e,icon:t,label:n,onClick:o,shortcut:i}){Wn(i,o);const r=i?`${n} (${i})`:n;return Pe(Ct,{classes:Re("text-grey-7","group-hover:text-grey-5","hover:group-hover:text-grey-9"),onClick:o,title:r,size:"custom",variant:"custom",children:Pe("div",{className:Re("flex flex-col items-center gap-y-1 py-2.5 px-2","text-annotator-sm leading-none"),children:[t&&Pe(t,{className:"text-annotator-lg",title:r}),"number"==typeof e&&Pe(Xn,{badgeCount:e}),Pe("span",{"data-testid":"adder-button-label",children:n})]})})}function Gn({annotationCount:e,isVisible:t}){return Pe("div",{className:"sr-only",children:[Pe("span",{"aria-live":"polite","aria-atomic":"true",role:"status","data-testid":"annotation-count-announce",children:e>0&&Pe("span",{children:[e," ",1===e?"annotation":"annotations"," for this selection."]})}),Pe("ul",{"aria-live":"polite",
"data-testid":"annotate-shortcuts-announce",children:t&&Pe(w,{children:[e>0&&Pe("li",{children:["Press ","'S'"," to show annotations."]}),Pe("li",{children:["Press ","'A'"," to annotate."]}),Pe("li",{children:["Press ","'H'"," to highlight."]})]})})]})}function Qn({arrowDirection:e,isVisible:t,onCommand:n,annotationCount:o=0}){const i=t?"a":null,r=t?"h":null,s=t?"s":null;return Wn(t?"Escape":null,(()=>n("hide"))),Pe("div",{className:Re("all-initial","border border-solid border-grey-3","absolute select-none bg-white rounded shadow-intense","opacity-5",{"animate-adder-pop-up":"up"===e&&t,"animate-adder-pop-down":"down"===e&&t}),"data-component":"AdderToolbar",dir:"ltr",style:{visibility:t?"visible":"hidden"},children:[Pe("div",{className:Re("flex group"),children:[Pe(Kn,{icon:Be,onClick:()=>n("annotate"),label:"Annotate",shortcut:i}),Pe(Kn,{icon:nt,onClick:()=>n("highlight"),label:"Highlight",shortcut:r}),o>0&&Pe(w,{children:[Pe("div",{className:Re("m-1.5 border-r border-grey-4 border-solid")}),Pe(Kn,{
badgeCount:o,onClick:()=>n("show"),label:"Show",shortcut:s})]})]}),Pe(Yn,{arrowDirection:e}),Pe(Gn,{annotationCount:o,isVisible:t})]})}function Jn(e){const t=e.attachShadow({mode:"open"});return function(e){const t=document.querySelector('link[rel="preload"][href*="/build/styles/annotator.css"]')?.href;if(!t)return;const n=document.createElement("link");n.rel="stylesheet",n.href=t,e.appendChild(n)}(t),t}class Zn{constructor(e,t){const n=`hypothesis-${e}`;this._element=document.createElement(n),this._shadowRoot=Jn(this._element),this._render=t}destroy(){F(null,this._shadowRoot),this._element.remove()}get element(){return this._element}render(){F(this._render(),this._shadowRoot)}}let eo=function(e){return e[e.DOWN=1]="DOWN",e[e.UP=2]="UP",e}({});function to(e){return e.toString()+"px"}class no{constructor(e,t){this._view=e.ownerDocument.defaultView,this._isVisible=!1,this._arrowDirection="up",this._annotationsForSelection=[],this._onAnnotate=t.onAnnotate,this._onHighlight=t.onHighlight,
this._onShowAnnotations=t.onShowAnnotations,this._container=new Zn("adder",(()=>this._render())),e.appendChild(this._container.element),Object.assign(this._container.element.style,{position:"absolute",top:0,left:0}),this._container.render()}get annotationsForSelection(){return this._annotationsForSelection}set annotationsForSelection(e){this._annotationsForSelection=e,this._container.render()}hide(){this._isVisible=!1,this._container.render(),Object.assign(this._container.element.style,{top:0,left:0})}destroy(){this._container.destroy()}show(e,t){const{left:n,top:o,arrowDirection:i}=this._calculateTarget(e,t);this._showAt(n,o),this._isVisible=!0,this._arrowDirection=i===eo.UP?"up":"down",this._container.render()}_firstChild(){return this._container.element.shadowRoot.firstChild}_width(){return this._firstChild().getBoundingClientRect().width}_height(){return this._firstChild().getBoundingClientRect().height}_calculateTarget(e,t){let n,o,i;n=t&&!jn()?eo.DOWN:eo.UP
;const r=Math.min(20,e.width),s=this._width(),a=jn()?10:0,l=this._height();return i=t?e.left-s/2+r:e.left+e.width-s/2-r,e.top-l<0&&n===eo.DOWN?n=eo.UP:e.top+l>this._view.innerHeight&&(n=eo.DOWN),o=n===eo.UP?e.top+e.height+10+a:e.top-l-10,i=Math.max(i,0),i=Math.min(i,this._view.innerWidth-s),o=Math.max(o,0),o=Math.min(o,this._view.innerHeight-l),{top:o,left:i,arrowDirection:n}}_findZindex(e,t){if(void 0===document.elementsFromPoint)return 32768;const n=this._width(),o=this._height(),i=e=>+getComputedStyle(e).zIndex,r=[...new Set([...document.elementsFromPoint(e,t),...document.elementsFromPoint(e,t+o),...document.elementsFromPoint(e+n/2,t+o/2),...document.elementsFromPoint(e+n,t),...document.elementsFromPoint(e+n,t+o)])].map(i).filter(Number.isInteger);let s=0;for(const e of document.querySelectorAll("hypothesis-highlight"))s=Math.max(s,i(e));return r.push(s),Math.max(...r)+1}_showAt(e,t){const n=function(e){let t=e.parentElement;for(;t.parentElement&&"static"===getComputedStyle(t).position;)t=t.parentElement
;return t}(this._container.element).getBoundingClientRect(),o=this._findZindex(e,t);Object.assign(this._container.element.style,{left:to(e-n.left),top:to(t-n.top),zIndex:o})}_render(){return Pe(Qn,{isVisible:this._isVisible,arrowDirection:this._arrowDirection,onCommand:e=>{switch(e){case"annotate":this._onAnnotate(),this.hide();break;case"highlight":this._onHighlight(),this.hide();break;case"show":this._onShowAnnotations(this.annotationsForSelection);break;case"hide":this.hide()}},annotationCount:this.annotationsForSelection.length})}}var oo=function(e){return e[e.Forwards=1]="Forwards",e[e.Backwards=2]="Backwards",e}(oo||{});function io(e,t,n){const o=n===oo.Forwards?t:t-1;if(""!==e.charAt(o).trim())return t;let i,r;if(n===oo.Backwards?(i=e.substring(0,t),r=i.trimEnd()):(i=e.substring(t),r=i.trimStart()),!r.length)return-1;const s=i.length-r.length;return n===oo.Backwards?t-s:t+s}function ro(e,t){
const n=e.commonAncestorContainer.ownerDocument.createNodeIterator(e.commonAncestorContainer,NodeFilter.SHOW_TEXT),o=t===oo.Forwards?e.startContainer:e.endContainer,i=t===oo.Forwards?e.endContainer:e.startContainer;let r=n.nextNode();for(;r&&r!==o;)r=n.nextNode();t===oo.Backwards&&(r=n.previousNode());let s=-1;const a=()=>{if(r=t===oo.Forwards?n.nextNode():n.previousNode(),r){const e=r.textContent,n=t===oo.Forwards?0:e.length;s=io(e,n,t)}};for(;r&&-1===s&&r!==i;)a();if(r&&s>=0)return{node:r,offset:s};throw new RangeError("No text nodes with non-whitespace text found in range")}function so(e){switch(e.nodeType){case Node.ELEMENT_NODE:case Node.TEXT_NODE:return e.textContent?.length??0;default:return 0}}function ao(e){let t=e.previousSibling,n=0;for(;t;)n+=so(t),t=t.previousSibling;return n}function lo(e,...t){let n=t.shift();const o=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),i=[];let r,s=o.nextNode(),a=0;for(;void 0!==n&&s;)r=s,a+r.data.length>n?(i.push({node:r,offset:n-a}),
n=t.shift()):(s=o.nextNode(),a+=r.data.length);for(;void 0!==n&&r&&a===n;)i.push({node:r,offset:r.data.length}),n=t.shift();if(void 0!==n)throw new RangeError("Offset exceeds text length");return i}let co=function(e){return e[e.FORWARDS=1]="FORWARDS",e[e.BACKWARDS=2]="BACKWARDS",e}({});class ho{constructor(e,t){if(t<0)throw new Error("Offset is invalid");this.element=e,this.offset=t}relativeTo(e){if(!e.contains(this.element))throw new Error("Parent is not an ancestor of current element");let t=this.element,n=this.offset;for(;t!==e;)n+=ao(t),t=t.parentElement;return new ho(t,n)}resolve(e={}){try{return lo(this.element,this.offset)[0]}catch(t){if(0===this.offset&&void 0!==e.direction){const n=document.createTreeWalker(this.element.getRootNode(),NodeFilter.SHOW_TEXT);n.currentNode=this.element;const o=e.direction===co.FORWARDS,i=o?n.nextNode():n.previousNode();if(!i)throw t;return{node:i,offset:o?0:i.data.length}}throw t}}static fromCharOffset(e,t){switch(e.nodeType){case Node.TEXT_NODE:return ho.fromPoint(e,t)
;case Node.ELEMENT_NODE:return new ho(e,t);default:throw new Error("Node is not an element or text node")}}static fromPoint(e,t){switch(e.nodeType){case Node.TEXT_NODE:{if(t<0||t>e.data.length)throw new Error("Text node offset is out of range");if(!e.parentElement)throw new Error("Text node has no parent");const n=ao(e)+t;return new ho(e.parentElement,n)}case Node.ELEMENT_NODE:{if(t<0||t>e.childNodes.length)throw new Error("Child node offset is out of range");let n=0;for(let o=0;o<t;o++)n+=so(e.childNodes[o]);return new ho(e,n)}default:throw new Error("Point is not in an element or text node")}}}class uo{constructor(e,t){this.start=e,this.end=t}relativeTo(e){return new uo(this.start.relativeTo(e),this.end.relativeTo(e))}toRange(){let e,t;this.start.element===this.end.element&&this.start.offset<=this.end.offset?[e,t]=lo(this.start.element,this.start.offset,this.end.offset):(e=this.start.resolve({direction:co.FORWARDS}),t=this.end.resolve({direction:co.BACKWARDS}));const n=new Range
;return n.setStart(e.node,e.offset),n.setEnd(t.node,t.offset),n}static fromRange(e){const t=ho.fromPoint(e.startContainer,e.startOffset),n=ho.fromPoint(e.endContainer,e.endOffset);return new uo(t,n)}static fromOffsets(e,t,n){return new uo(new ho(e,t),new ho(e,n))}static trimmedRange(e){return function(e){if(!e.toString().trim().length)throw new RangeError("Range contains no non-whitespace text");if(e.startContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range startContainer is not a text node");if(e.endContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range endContainer is not a text node");const t=e.cloneRange();let n=!1,o=!1;const i={start:io(e.startContainer.textContent,e.startOffset,oo.Forwards),end:io(e.endContainer.textContent,e.endOffset,oo.Backwards)};if(i.start>=0&&(t.setStart(e.startContainer,i.start),n=!0),i.end>0&&(t.setEnd(e.endContainer,i.end),o=!0),n&&o)return t;if(!n){const{node:e,offset:n}=ro(t,oo.Forwards);e&&n>=0&&t.setStart(e,n)}if(!o){
const{node:e,offset:n}=ro(t,oo.Backwards);e&&n>0&&t.setEnd(e,n)}return t}(uo.fromRange(e).toRange())}}const fo=".annotator-placeholder";function mo(e){return!!e.parentElement&&null!==e.parentElement.closest(fo)}function po(e,t){const n=new Range;return e.compareBoundaryPoints(Range.START_TO_START,t)<=0?n.setStart(e.startContainer,e.startOffset):n.setStart(t.startContainer,t.startOffset),e.compareBoundaryPoints(Range.END_TO_END,t)>=0?n.setEnd(e.endContainer,e.endOffset):n.setEnd(t.endContainer,t.endOffset),n}function go(e=document.getSelection()){if(!e||0===e.rangeCount)return null;let t=e.getRangeAt(0);for(let n=1;n<e.rangeCount;n++)t=po(t,e.getRangeAt(n));return t.collapsed?null:t}function _o(e){if(e.focusNode===e.anchorNode)return e.focusOffset<e.anchorOffset;return go(e).startContainer===e.focusNode}function bo(e,t){try{const n=t.nodeValue?.length??t.childNodes.length;return e.comparePoint(t,0)<=0&&e.comparePoint(t,n)>=0}catch{return!1}}function wo(e,t){
const n=e.commonAncestorContainer,o=n.ownerDocument.createNodeIterator(n,NodeFilter.SHOW_ALL);let i;for(;i=o.nextNode();)bo(e,i)&&t(i)}function vo(e){const t=go(e);if(!t)return null;const n=function(e){const t=[];return wo(e,(e=>{En(e)&&!e.textContent.match(/^\s*$/)&&t.push(e)})),t.flatMap((t=>{const n=t.ownerDocument.createRange();if(n.selectNodeContents(t),t===e.startContainer&&n.setStart(t,e.startOffset),t===e.endContainer&&n.setEnd(t,e.endOffset),n.collapsed)return[];const o=Array.from(n.getClientRects());return n.detach(),o}))}(t);return 0===n.length?null:_o(e)?n[0]:n[n.length-1]}const yo="http://www.w3.org/2000/svg",xo=["user-annotations","user-highlights","other-content"];class No{constructor(e=document.body){this.root=e}highlightShape(e){const{shape:t,anchor:n}=e,o=document.createElement("hypothesis-highlight");if(o.className="hypothesis-shape-highlight","rect"===t.type){const e=t.right-t.left,n=t.bottom-t.top;o.style.left=100*t.left+"%",o.style.top=100*t.top+"%",o.style.width=`calc(${100*e}% - 6px)`,
o.style.height=`calc(${100*n}% - 6px)`}else if("point"===t.type){const e=7;o.style.left=`calc(${100*t.x}% - ${e+3}px)`,o.style.top=`calc(${100*t.y}% - ${e+3}px)`,o.style.width=2*e+"px",o.style.height=2*e+"px",o.style.borderRadius="50%"}return n.append(o),[o]}highlightRange(e,t){const n=function(e){if(e.collapsed)return[];let t=e.commonAncestorContainer;t&&t.nodeType!==Node.ELEMENT_NODE&&(t=t.parentElement);if(!t)return[];const n=[],o=t.ownerDocument.createNodeIterator(t,NodeFilter.SHOW_TEXT);let i;for(;i=o.nextNode();){if(!bo(e,i))continue;const t=i;t===e.startContainer&&e.startOffset>0?t.splitText(e.startOffset):(t===e.endContainer&&e.endOffset<t.data.length&&t.splitText(e.endOffset),n.push(t))}return n}(e),o=n.length>0&&mo(n[0]);let i=[],r=null,s=null;n.forEach((e=>{r&&r.nextSibling===e?s.push(e):(s=[e],i.push(s)),r=e}));const a=/^\s*$/;i=i.filter((e=>{const t=e[0].parentElement;return 1===t?.childNodes.length&&"SPAN"===t?.tagName||e.some((e=>!a.test(e.data)))}));const l=[];return i.forEach((e=>{
const n=document.createElement("hypothesis-highlight");n.className=Re("hypothesis-highlight",t);e[0].parentNode.replaceChild(n,e[0]),e.forEach((e=>n.appendChild(e))),l.push(n)})),o||function(e,t){if(0===e.length)return;const n=function(e){const t=e.closest(".page");if(!t)return null;const n=t.querySelector(".canvasWrapper > canvas");if(!n)return null;return n}(e[0]);if(!n||!n.parentElement)return;let o=n.parentElement.querySelector(".hypothesis-highlight-layer");if(!o){o=document.createElementNS(yo,"svg"),o.setAttribute("class","hypothesis-highlight-layer"),n.parentElement.appendChild(o),n.parentElement.style.position="relative";const e=o.style;e.position="absolute",e.left="0",e.top="0",e.width="100%",e.height="100%",e.mixBlendMode="multiply"}const i=n.getBoundingClientRect(),r=e.map((e=>{const n=e.getBoundingClientRect(),o=document.createElementNS(yo,"rect"),r=(n.left-i.left)/i.width,s=(n.top-i.top)/i.height,a=n.width/i.width,l=n.height/i.height;return o.setAttribute("x",100*r+"%"),
o.setAttribute("y",100*s+"%"),o.setAttribute("width",100*a+"%"),o.setAttribute("height",100*l+"%"),o.setAttribute("class",Re("hypothesis-svg-highlight",t)),e.classList.add("is-transparent"),e.svgHighlight=o,o}));o.append(...r)}(l,t),l}removeAllHighlights(){const e=Array.from(this.root.querySelectorAll("hypothesis-highlight"));this.removeHighlights(e)}removeHighlights(e){!function(e,t){e.forEach((e=>{e.svgHighlight?So(e.svgHighlight,t):e.classList.toggle("hypothesis-highlight-focused",t)}))}(e,!1);for(const t of e){if(t.parentNode){Co(t,Array.from(t.childNodes))}t.svgHighlight&&t.svgHighlight.remove()}}setHighlightsFocused(e,t){e.forEach((e=>{e.svgHighlight?So(e.svgHighlight,t):e.classList.toggle("hypothesis-highlight-focused",t)}))}setHighlightsVisible(e){this.root.classList.toggle(Ao,e)}getHighlightsFromPoint(e,t){return ko(e,t)}}function Co(e,t){const n=e.parentNode;t.forEach((t=>n.insertBefore(t,e))),e.remove()}function So(e,t){const n=e.parentNode,o=e.getAttribute("data-focused-id")
;if(Boolean(o)!==t)if(t){e.setAttribute("data-focused-id",nn(8));const t=e.cloneNode();t.setAttribute("data-is-focused","data-is-focused"),n.append(t)}else{const t=n.querySelector(`[data-focused-id="${o}"][data-is-focused]`);t?.remove(),e.removeAttribute("data-focused-id")}}const Ao="hypothesis-highlights-always-on";function ko(e,t){const n=`.${Ao}`,o=document.elementsFromPoint(e,t).filter((e=>"hypothesis-highlight"===e.localName&&e.closest(n))),i=[];for(const o of document.querySelectorAll("hypothesis-highlight.hypothesis-shape-highlight")){if(!o.closest(n))continue;const r=o.getBoundingClientRect();e>=r.left&&e<r.right&&t>=r.top&&t<r.bottom&&i.push(o)}return[...o,...i]}function Ro(e){To(Po(e)),function(e){for(const[t,n]of function(e){const t=new Map;for(const n of(e??document).getElementsByClassName("hypothesis-highlight-layer"))t.set(n,Array.from(n.querySelectorAll(".hypothesis-svg-highlight")));return t}(e)){n.every(((e,t,n)=>0===t||Mo(e)>=Mo(n[t-1])))||(n.sort(((e,t)=>Mo(e)-Mo(t))),
t.replaceChildren(...n))}}(e)}const Eo=e=>"hypothesis-highlight"===e.tagName.toLowerCase();function Po(e){let t;return t=Eo(e)?Array.from(e.children).filter(Eo):Array.from(e.getElementsByTagName("hypothesis-highlight")).filter((e=>!e.parentElement||!Eo(e.parentElement))),t}function To(e,t="",n=0,o=0){for(const i of e){const e=xo.find((e=>i.classList.contains(e)))??"other-content",r=t&&e===t?o+1:0;i.setAttribute("data-nesting-level",`${n}`),i.setAttribute("data-cluster-level",`${r}`),i.svgHighlight&&(i.svgHighlight.setAttribute("data-nesting-level",`${n}`),i.svgHighlight.setAttribute("data-cluster-level",`${r}`)),To(Po(i),e,n+1,r)}}function Mo(e){return e.getAttribute("data-is-focused")?Number.MAX_SAFE_INTEGER:parseInt(e.getAttribute("data-nesting-level")??"0",10)}function Oo(e){const t=[];return e.forEach((({annotation:e,highlights:n})=>{if(!n?.length)return;const{top:o,bottom:i}=function(e){const t=e.map((e=>e.getBoundingClientRect()));return t.reduce(((e,t)=>({top:Math.min(e.top,t.top),
left:Math.min(e.left,t.left),bottom:Math.max(e.bottom,t.bottom),right:Math.max(e.right,t.right)})))}(n);o>=i||t.push({tag:e.$tag,top:o,bottom:i})})),t.sort(((e,t)=>e.top-t.top)),t}class Io{constructor({contentContainer:e,hostRPC:t}){this._hostRPC=t,this._updatePending=!1,this._anchors=[],this._listeners=new ge,this._listeners.add(window,"resize",(()=>this.update())),this._listeners.add(window,"scroll",(()=>this.update())),this._listeners.add(e,"scroll",(()=>this.update()),{capture:!0})}destroy(){this._listeners.removeAll()}update(e){e&&(this._anchors=e),this._updatePending||(this._updatePending=!0,requestAnimationFrame((()=>{const e=Oo(this._anchors);this._hostRPC.call("anchorsChanged",e),this._updatePending=!1})))}}function Lo(e){const t=Math.min(e.left,e.right),n=Math.max(e.left,e.right);return{type:"rect",left:t,top:Math.min(e.top,e.bottom),right:n,bottom:Math.max(e.top,e.bottom)}}class Bo extends Error{constructor(e,t="Drawing failed"){super(t),this.kind=e}}class Ho{constructor(e){this._container=e,
this._tool="rect"}destroy(){this.cancel()}async draw(e){this._tool=e,this.cancel("restarted");const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("data-testid","surface"),t.style.cursor="crosshair",t.style.touchAction="none",t.style.position="absolute",t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.style.left="0px",t.style.top="0px",t.style.zIndex="10",this._container.append(t),this._surface=t;const{promise:n,resolve:o,reject:i}=function(){let e,t;return{promise:new Promise(((n,o)=>{e=n,t=o})),resolve:e,reject:t}}();return this._drawEnd=o,this._drawError=i,this._surface.addEventListener("pointerdown",(e=>{switch(this._tool){case"rect":this._shape={type:"rect",left:e.clientX,top:e.clientY,right:e.clientX,bottom:e.clientY};break;case"point":this._shape={type:"point",x:e.clientX,y:e.clientY}}this._renderSurface()})),this._surface.addEventListener("pointermove",(e=>{if(this._shape){switch(this._shape.type){case"rect":this._shape.right=e.clientX,
this._shape.bottom=e.clientY;break;case"point":this._shape.x=e.clientX,this._shape.y=e.clientY}this._renderSurface()}})),this._surface.addEventListener("pointerup",(e=>{if(this._shape){switch(this._shape.type){case"rect":this._shape.right=e.clientX,this._shape.bottom=e.clientY,o(Lo(this._shape));break;case"point":this._shape.x=e.clientX,this._shape.y=e.clientY,o(this._shape)}this._abortDraw?.abort(),e.stopPropagation()}})),this._surface.addEventListener("wheel",(e=>{let t=Math.abs(e.deltaY),n=Math.abs(e.deltaX);for(const o of document.elementsFromPoint(e.clientX,e.clientY)){const i=o.scrollLeft;o.scrollLeft+=n*Math.sign(e.deltaX),n-=Math.abs(o.scrollLeft-i);const r=o.scrollTop;o.scrollTop+=t*Math.sign(e.deltaY),t-=Math.abs(o.scrollTop-r)}})),this._abortDraw=new AbortController,document.body.addEventListener("keydown",(e=>{"Escape"===e.key&&(this._drawError&&this._drawError(new Bo("canceled","Drawing canceled")),this._abortDraw?.abort())}),{signal:this._abortDraw.signal}),this._abortDraw.signal.onabort=()=>{
this._surface?.remove(),this._shape=void 0,this._surface=void 0,this._drawError=void 0,this._drawEnd=void 0,this._abortDraw=void 0},this._renderSurface(),n}cancel(e="canceled"){this._drawError&&this._drawError(new Bo(e,"Drawing canceled")),this._abortDraw?.abort()}_renderSurface(){if(this._surface)if("rect"===this._shape?.type){const e=Lo(this._shape);F(Pe(w,{children:[Pe("rect",{stroke:"white","stroke-dasharray":"5","stroke-width":"1px",fill:"grey","fill-opacity":"0.5",x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top}),Pe("rect",{stroke:"grey","stroke-dasharray":"5","stroke-dashoffset":"5","stroke-width":"1px",fill:"none",x:e.left,y:e.top,width:e.right-e.left,height:e.bottom-e.top})]}),this._surface)}else if("point"===this._shape?.type){const e=this._shape;F(Pe("circle",{stroke:"black","stroke-width":"1px",fill:"yellow",cx:e.x,cy:e.y,r:5}),this._surface)}else F(null,this._surface)}}class Fo extends CustomEvent{constructor(e){super("hypothesis:layoutchange",{bubbles:!0,cancelable:!1,detail:e})}}
const Do=new Set;function Vo(...e){const t=e.join();Do.has(t)||(console.warn(...e),Do.add(t))}Vo.reset=()=>{Do.clear()};const Uo=["pdf_image_annotation","styled_highlight_clusters"];class qo extends an{constructor(e=Uo){super(),this._flags=new Map,this._knownFlags=e}update(e){this._flags.clear();for(const[t,n]of Object.entries(e))this._flags.set(t,n);this.emit("flagsChanged")}flagEnabled(e){return this._knownFlags.includes(e)?this._flags.get(e)??!1:(Vo("Looked up unknown feature",e),!1)}allFlags(){return Object.fromEntries(this._flags)}}function $o({cluster:e,label:t,onChange:n,currentStyles:o,highlightStyles:i}){const r=o[e],s="transparent"===r;return Pe("div",{className:"space-y-2",children:[Pe("div",{className:"flex items-center gap-x-2 text-annotator-base",children:Pe("div",{className:"grow text-color-text px-2 py-1 rounded",style:{backgroundColor:i[r].color},children:t})}),Pe("div",{className:"flex items-center gap-x-2",children:Object.keys(i).map((t=>Pe("div",{className:"relative",children:[Pe("input",{
className:Re("absolute w-6 h-6","opacity-[.00001]","cursor-pointer"),name:e,id:`hypothesis-${e}-${t}`,checked:r===t,onChange:n,type:"radio",value:t}),Pe("label",{className:"block",htmlFor:`${e}-${t}`,children:[Pe("div",{style:{backgroundColor:i[t].color},className:Re("block w-6 h-6 rounded-full flex items-center justify-center",{"border-2 border-slate-0":r!==t,"border-2 border-slate-3":r===t}),children:"transparent"===t&&Pe(et,{className:Re("w-3 h-3",{"text-slate-3":!s,"text-slate-7":s})})}),Pe("span",{className:"sr-only",children:t})]})]},`${e}-${t}`)))})]})}function zo({active:e,availableStyles:t,currentStyles:n,onStyleChange:o}){const i=re((e=>{const t=e.target,n=t.name,i=t.value;o(n,i)}),[o]),[r,s]=ee(!1);return e?Pe(Me,{classes:"overflow-hidden",children:Pe("div",{className:"flex flex-col text-annotator-base text-color-text",children:[Pe(Ct,{classes:"rounded-none","data-testid":"control-toggle-button",onClick:()=>s(!r),title:r?"Hide highlight settings":"Show highlight settings",children:Pe(w,r?{
children:[Pe(Ve,{}),Pe("span",{children:"Highlight Appearance"})]}:{children:[Pe(ze,{}),Pe(nt,{})]})}),r&&Pe(Ie,{"data-testid":"cluster-style-controls",size:"sm",children:[Pe($o,{highlightStyles:t,label:"My annotations",cluster:"user-annotations",onChange:i,currentStyles:n}),Pe($o,{highlightStyles:t,label:"My highlights",cluster:"user-highlights",onChange:i,currentStyles:n}),Pe($o,{highlightStyles:t,label:"Everybody's content",cluster:"other-content",onChange:i,currentStyles:n})]})]})}):null}const Wo={transparent:{color:"transparent",secondColor:"transparent",thirdColor:"transparent"},pink:{color:"var(--hypothesis-color-pink)",secondColor:"var(--hypothesis-color-pink-1)",thirdColor:"var(--hypothesis-color-pink-2)"},orange:{color:"var(--hypothesis-color-orange)",secondColor:"var(--hypothesis-color-orange-1)",thirdColor:"var(--hypothesis-color-orange-2)"},yellow:{color:"var(--hypothesis-color-yellow)",secondColor:"var(--hypothesis-color-yellow-1)",thirdColor:"var(--hypothesis-color-yellow-2)"},green:{
color:"var(--hypothesis-color-green)",secondColor:"var(--hypothesis-color-green-1)",thirdColor:"var(--hypothesis-color-green-2)"},purple:{color:"var(--hypothesis-color-purple)",secondColor:"var(--hypothesis-color-purple-1)",thirdColor:"var(--hypothesis-color-purple-2)"},grey:{color:"var(--hypothesis-color-grey)",secondColor:"var(--hypothesis-color-grey-1)",thirdColor:"var(--hypothesis-color-grey-2)"}},jo={"other-content":"yellow","user-annotations":"orange","user-highlights":"purple"};class Xo{constructor(e,t){this._element=e,this._features=t.features,this._container=new Zn("highlight-cluster-toolbar",(()=>this._render())),this._element.appendChild(this._container.element),Object.assign(this._container.element.style,{position:"fixed",top:`${this._element.offsetTop+4}px`,left:"4px"}),this.appliedStyles=jo,this._init(),this._features.on("flagsChanged",(()=>{this._activate(this._isActive())})),this._container.render()}destroy(){clearTimeout(this._updateTimeout),this._activate(!1),this._container.destroy()}
scheduleClusterUpdates(){clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout((()=>this._updateClusters()),100)}_init(){for(const e of Object.keys(this.appliedStyles))this._setClusterStyles(e,this.appliedStyles[e]);this._activate(this._isActive())}_updateClusters(){this._isActive()&&Ro(this._element)}_isActive(){return this._features.flagEnabled("styled_highlight_clusters")}_activate(e){this._element.classList.toggle("hypothesis-highlights-clustered",e),this._container.render()}_setClusterStyle(e,t){document.documentElement.style.setProperty(e,t)}_setClusterStyles(e,t){const n=Wo[t];for(const t of Object.keys(n))this._setClusterStyle(`--hypothesis-${e}-${t}`,n[t])}_onChangeClusterStyle(e,t){this.appliedStyles[e]=t,this._setClusterStyles(e,t),this._container.render()}_render(){return Pe(zo,{active:this._isActive(),availableStyles:Wo,currentStyles:this.appliedStyles,onStyleChange:(e,t)=>this._onChangeClusterStyle(e,t)})}}function Yo(e){return e.split("").reverse().join("")}function Ko(e){
return(e|-e)>>31&1}function Go(e,t,n,o){let i=e.P[n],r=e.M[n];const s=o>>>31,a=t[n]|s,l=a|r,c=(a&i)+i^i|a;let h=r|~(c|i),d=i&c;const u=Ko(h&e.lastRowMask[n])-Ko(d&e.lastRowMask[n]);return h<<=1,d<<=1,d|=s,h|=Ko(o)-s,i=d|~(l|h),r=h&l,e.P[n]=i,e.M[n]=r,u}function Qo(e,t,n){if(0===t.length)return[];n=Math.min(n,t.length);const o=[],i=32,r=Math.ceil(t.length/i)-1,s={P:new Uint32Array(r+1),M:new Uint32Array(r+1),lastRowMask:new Uint32Array(r+1)};s.lastRowMask.fill(1<<31),s.lastRowMask[r]=1<<(t.length-1)%i;const a=new Uint32Array(r+1),l=new Map,c=[];for(let e=0;e<256;e++)c.push(a);for(let e=0;e<t.length;e+=1){const n=t.charCodeAt(e);if(l.has(n))continue;const o=new Uint32Array(r+1);l.set(n,o),n<c.length&&(c[n]=o);for(let e=0;e<=r;e+=1){o[e]=0;for(let r=0;r<i;r+=1){const s=e*i+r;if(s>=t.length)continue;t.charCodeAt(s)===n&&(o[e]|=1<<r)}}}let h=Math.max(0,Math.ceil(n/i)-1);const d=new Uint32Array(r+1);for(let e=0;e<=h;e+=1)d[e]=(e+1)*i;d[r]=t.length;for(let e=0;e<=h;e+=1)s.P[e]=-1,s.M[e]=0
;for(let u=0;u<e.length;u+=1){const f=e.charCodeAt(u);let m;f<c.length?m=c[f]:(m=l.get(f),void 0===m&&(m=a));let p=0;for(let e=0;e<=h;e+=1)p=Go(s,m,e,p),d[e]+=p;if(d[h]-p<=n&&h<r&&(1&m[h+1]||p<0)){let e;if(h+=1,s.P[h]=-1,s.M[h]=0,h===r){const n=t.length%i;e=0===n?i:n}else e=i;d[h]=d[h-1]+e-p+Go(s,m,h,p)}else for(;h>0&&d[h]>=n+i;)h-=1;h===r&&d[h]<=n&&(d[h]<n&&o.splice(0,o.length),o.push({start:-1,end:u+1,errors:d[h]}),n=d[h])}return o}function Jo(e,t,n){return function(e,t,n){const o=Yo(t);return n.map((n=>{const i=Math.max(0,n.end-t.length-n.errors);return{start:Qo(Yo(e.slice(i,n.end)),o,n.errors).reduce(((e,t)=>n.end-t.end<e?n.end-t.end:e),n.end),end:n.end,errors:n.errors}}))}(e,t,Qo(e,t,n))}function Zo(e,t,n){let o=0;const i=[];for(;-1!==o;)o=e.indexOf(t,o),-1!==o&&(i.push({start:o,end:o+t.length,errors:0}),o+=1);return i.length>0?i:Jo(e,t,n)}function ei(e,t){if(0===t.length||0===e.length)return 0;return 1-Zo(e,t,t.length)[0].errors/t.length}function ti(e,t,n={}){if(0===t.length)return null
;const o=Math.min(256,t.length/2),i=Zo(e,t,o);if(0===i.length)return null;const r=o=>{const i=1-o.errors/t.length,r=n.prefix?ei(e.slice(Math.max(0,o.start-n.prefix.length),o.start),n.prefix):1,s=n.suffix?ei(e.slice(o.end,o.end+n.suffix.length),n.suffix):1;let a=1;if("number"==typeof n.hint){a=1-Math.abs(o.start-n.hint)/e.length}return(50*i+20*r+20*s+2*a)/92},s=i.map((e=>({start:e.start,end:e.end,score:r(e)})));return s.sort(((e,t)=>t.score-e.score)),s[0]}function ni(e){const t=function(e){const t=e.nodeName.toLowerCase();return"#text"===t?"text()":t}(e),n=function(e){let t=0,n=e;for(;n;)n.nodeName===e.nodeName&&(t+=1),n=n.previousSibling;return t}(e);return`${t}[${n}]`}function oi(e,t){let n="",o=e;for(;o!==t;){if(!o)throw new Error("Node is not a descendant of root");n=ni(o)+"/"+n,o=o.parentNode}return n="/"+n,n=n.replace(/\/$/,""),n}function ii(e,t,n){t=t.toUpperCase();let o=-1;for(let i=0;i<e.children.length;i++){const r=e.children[i];if(r.nodeName.toUpperCase()===t&&(++o,o===n))return r}return null}
function ri(e,t=document.body){try{return function(e,t){if(null===e.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+\])?)+$/))throw new Error("Expression is not a simple XPath");const n=e.split("/");let o=t;n.shift();for(const e of n){let t,n;const i=e.indexOf("[");if(-1!==i){t=e.slice(0,i);const o=e.slice(i+1,e.indexOf("]"));if(n=parseInt(o)-1,n<0)return null}else t=e,n=0;const r=ii(o,t,n);if(!r)return null;o=r}return o}(e,t)}catch{return document.evaluate("."+e,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}class si{constructor(e,t){this.root=e,this.range=t}static fromRange(e,t){return new si(e,t)}static fromSelector(e,t){const n=ri(t.startContainer,e);if(!n)throw new Error("Failed to resolve startContainer XPath");const o=ri(t.endContainer,e);if(!o)throw new Error("Failed to resolve endContainer XPath");const i=ho.fromCharOffset(n,t.startOffset),r=ho.fromCharOffset(o,t.endOffset),s=new uo(i,r).toRange();return new si(e,s)}toRange(){return this.range}toSelector(){
const e=uo.fromRange(this.range).toRange(),t=uo.fromRange(e),n=oi(t.start.element,this.root),o=oi(t.end.element,this.root);return{type:"RangeSelector",startContainer:n,startOffset:t.start.offset,endContainer:o,endOffset:t.end.offset}}}class ai{constructor(e,t,n){this.root=e,this.start=t,this.end=n}static fromRange(e,t){const n=uo.fromRange(t).relativeTo(e);return new ai(e,n.start.offset,n.end.offset)}static fromSelector(e,t){return new ai(e,t.start,t.end)}toSelector(){return{type:"TextPositionSelector",start:this.start,end:this.end}}toRange(){return uo.fromOffsets(this.root,this.start,this.end).toRange()}}class li{constructor(e,t,n={}){this.root=e,this.exact=t,this.context=n}static fromRange(e,t){const n=e.textContent,o=uo.fromRange(t).relativeTo(e),i=o.start.offset,r=o.end.offset;return new li(e,n.slice(i,r),{prefix:n.slice(Math.max(0,i-32),i),suffix:n.slice(r,Math.min(n.length,r+32))})}static fromSelector(e,t){const{prefix:n,suffix:o}=t;return new li(e,t.exact,{prefix:n,suffix:o})}toSelector(){return{
type:"TextQuoteSelector",exact:this.exact,prefix:this.context.prefix,suffix:this.context.suffix}}toRange(e={}){return this.toPositionAnchor(e).toRange()}toPositionAnchor(e={}){const t=ti(this.root.textContent,this.exact,{...this.context,hint:e.hint});if(!t)throw new Error("Quote not found");return new ai(this.root,t.start,t.end)}}function ci(e){const t=parseFloat(e);return!Number.isFinite(t)||t<0?null:t}function hi(e){return e instanceof Element?e:e.parentElement}function di(e,t=e){const n=ci(e?.getAttribute("data-time-start")??""),o=ci(t?.getAttribute("data-time-end")??"");return"number"!=typeof n||"number"!=typeof o||o<n?null:[n,o]}class ui{constructor(e,t,n){this.root=e,this.start=t,this.end=n}static fromRange(e,t){const n=hi(t.startContainer)?.closest("[data-time-start]"),o=hi(t.endContainer)?.closest("[data-time-end]"),i=di(n,o);if(!i)return null;const[r,s]=i;return new ui(e,r,s)}toRange(){const e=[...this.root.querySelectorAll("[data-time-start]")].map((e=>{const t=di(e);if(!t)return null;const[n,o]=t
;return{element:e,start:n,end:o}})).filter((e=>null!==e));e.sort(((e,t)=>e.start-t.start));const t=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(e,(e=>e.start<=this.start&&e.end>=this.start));if(-1===t)throw new Error("Start segment not found");const n=t+e.slice(t).findIndex((e=>e.start<=this.end&&e.end>=this.end));if(-1===n)throw new Error("End segment not found");const o=new Range;o.setStart(e[t].element,0);const i=e[n].element;return o.setEnd(i,i.childNodes.length),o}static fromSelector(e,t){const{start:n,end:o}=t;return new ui(e,n,o)}toSelector(){return{type:"MediaTimeSelector",start:this.start,end:this.end}}}async function fi(e,t){return e.toRange(t)}function mi(e,t,n){const o=e[t];if("function"!=typeof o)throw new Error("Can only intercept functions");return e[t]=(...t)=>{const i=o.call(e,...t);return n(...t),i},()=>{e[t]=o}}function pi(e){return e.replace(/#.*/,"")}class gi{constructor(e,t=(()=>location.href)){this._listeners=new ge;let n=t();const o=(o=t())=>{
pi(n)!==pi(o)&&(n=o,e(o))},i=function(){const e=window.navigation;return"function"==typeof Navigation&&e instanceof Navigation?e:null}();if(i)this._listeners.add(i,"navigatesuccess",(()=>o()));else{const e=[mi(window.history,"pushState",(()=>o())),mi(window.history,"replaceState",(()=>o()))];this._unpatchHistory=()=>e.forEach((e=>e())),this._listeners.add(window,"popstate",(()=>o()))}}disconnect(){this._unpatchHistory?.(),this._listeners.removeAll()}}var _i,bi;var wi=function(){if(bi)return _i;bi=1;var e="complete",t="canceled";function n(e,t,n){e.self===e?e.scrollTo(t,n):(e.scrollLeft=t,e.scrollTop=n)}function o(t){var i=t._scrollSettings;if(i){var r=i.maxSynchronousAlignments,s=function(e,t){var n,o,i,r,s,a,l,c=e.align,h=e.target.getBoundingClientRect(),d=c&&null!=c.left?c.left:.5,u=c&&null!=c.top?c.top:.5,f=c&&null!=c.leftOffset?c.leftOffset:0,m=c&&null!=c.topOffset?c.topOffset:0,p=d,g=u;if(e.isWindow(t))a=Math.min(h.width,t.innerWidth),l=Math.min(h.height,t.innerHeight),
o=h.left+t.pageXOffset-t.innerWidth*p+a*p,i=h.top+t.pageYOffset-t.innerHeight*g+l*g,o-=f,i-=m,o=e.align.lockX?t.pageXOffset:o,i=e.align.lockY?t.pageYOffset:i,r=o-t.pageXOffset,s=i-t.pageYOffset;else{a=h.width,l=h.height,n=t.getBoundingClientRect();var _=h.left-(n.left-t.scrollLeft),b=h.top-(n.top-t.scrollTop);o=_+a*p-t.clientWidth*p,i=b+l*g-t.clientHeight*g,o-=f,i-=m,o=Math.max(Math.min(o,t.scrollWidth-t.clientWidth),0),i=Math.max(Math.min(i,t.scrollHeight-t.clientHeight),0),o=e.align.lockX?t.scrollLeft:o,i=e.align.lockY?t.scrollTop:i,r=o-t.scrollLeft,s=i-t.scrollTop}return{x:o,y:i,differenceX:r,differenceY:s}}(i,t),a=Date.now()-i.startTime,l=Math.min(1/i.time*a,1);if(i.endIterations>=r)return n(t,s.x,s.y),t._scrollSettings=null,i.end(e);var c=1-i.ease(l);if(n(t,s.x-s.differenceX*c,s.y-s.differenceY*c),a>=i.time)return i.endIterations++,i.scrollAncestor&&o(i.scrollAncestor),void o(t);!function(e){if("requestAnimationFrame"in window)return window.requestAnimationFrame(e);setTimeout(e,16)}(o.bind(null,t))}}
function i(e){return e.self===e}function r(e){return"pageXOffset"in e||(e.scrollHeight!==e.clientHeight||e.scrollWidth!==e.clientWidth)&&"hidden"!==getComputedStyle(e).overflow}function s(){return!0}function a(e){if(e.assignedSlot)return a(e.assignedSlot);if(e.parentElement)return"body"===e.parentElement.tagName.toLowerCase()?e.parentElement.ownerDocument.defaultView||e.parentElement.ownerDocument.ownerWindow:e.parentElement;if(e.getRootNode){var t=e.getRootNode();if(11===t.nodeType)return t.host}}return _i=function(n,l,c){if(n){"function"==typeof l&&(c=l,l=null),l||(l={}),l.time=isNaN(l.time)?1e3:l.time,l.ease=l.ease||function(e){return 1-Math.pow(1-e,e/2)},l.align=l.align||{};var h=a(n),d=1,u=l.validTarget||s,f=l.isScrollable;l.debug&&(console.log("About to scroll to",n),h||console.error("Target did not have a parent, is it mounted in the DOM?"));for(var m=[];h;)if(l.debug&&console.log("Scrolling parent node",h),u(h,d)&&(f?f(h,r):r(h))&&(d++,m.push(h)),!(h=a(h))){p(e);break}
return m.reduce(((e,r,s)=>function(e,n,r,s,a){var l,c=!n._scrollSettings,h=n._scrollSettings,d=Date.now(),u={passive:!0};function f(e){n._scrollSettings=null,n.parentElement&&n.parentElement._scrollSettings&&n.parentElement._scrollSettings.end(e),r.debug&&console.log("Scrolling ended with type",e,"for",n),a(e),l&&(n.removeEventListener("touchstart",l,u),n.removeEventListener("wheel",l,u))}h&&h.end(t);var m=r.maxSynchronousAlignments;return null==m&&(m=3),n._scrollSettings={startTime:d,endIterations:0,target:e,time:r.time,ease:r.ease,align:r.align,isWindow:r.isWindow||i,maxSynchronousAlignments:m,end:f,scrollAncestor:s},"cancellable"in r&&!r.cancellable||(l=f.bind(null,t),n.addEventListener("touchstart",l,u),n.addEventListener("wheel",l,u)),c&&o(n),l}(n,r,l,m[s+1],p)),null)}function p(e){--d||c&&c(e)}},_i}(),vi=Ne(wi);function yi(e,t,n){return e+n*(t-e)}async function xi(e,t,{maxDuration:n=500}={}){const o=e.scrollTop,i=t,r=Date.now(),s=Math.min(Math.abs(i-o)/3,n);let a=0;for(;a<1;)await new Promise((e=>{
requestAnimationFrame(e)})),a=Math.min(1,(Date.now()-r)/s),e.scrollTop=yi(o,i,a)}function Ni(e,t=document.baseURI){return new URL(e,t).href.toString().replace(/#.*/,"")}class Ci{constructor(e={}){this.document=e.document||document}uri(){let e=this._getDocumentHref();try{e=decodeURIComponent(e)}catch(e){console.error("Error decoding URI:",e)}const t=this._getLinks();for(const n of t)"canonical"===n.rel&&(e=n.href);return e}getDocumentMetadata(){const e={title:document.title,link:[],dc:this._getMetaTags("name","dc."),eprints:this._getMetaTags("name","eprints."),facebook:this._getMetaTags("property","og:"),highwire:this._getMetaTags("name","citation_"),prism:this._getMetaTags("name","prism."),twitter:this._getMetaTags("name","twitter:")},t=this._getFavicon();t&&(e.favicon=t),e.title=this._getTitle(e),e.link=this._getLinks(e);const n=e.link.find((e=>e.href.startsWith("urn:x-dc")));return n&&(e.documentFingerprint=n.href),e}_getMetaTags(e,t){const n={}
;for(const o of Array.from(this.document.querySelectorAll("meta"))){const i=o.getAttribute(e),{content:r}=o;if(i&&r){const e=i.match(RegExp(`^${t}(.+)$`,"i"));if(e){const t=e[1].toLowerCase();n[t]?n[t].push(r):n[t]=[r]}}}return n}_getTitle(e){return e.highwire.title?e.highwire.title[0]:e.eprints.title?e.eprints.title[0]:e.prism.title?e.prism.title[0]:e.facebook.title?e.facebook.title[0]:e.twitter.title?e.twitter.title[0]:e.dc.title?e.dc.title[0]:this.document.title}_getLinks(e={dc:{},highwire:{}}){const t=[{href:this._getDocumentHref()}],n=Array.from(this.document.querySelectorAll("link"));for(const e of n)if(["alternate","canonical","bookmark","shortlink"].includes(e.rel)){if("alternate"===e.rel){if(e.type&&e.type.match(/^application\/(rss|atom)\+xml/))continue;if(e.hreflang)continue}try{const n=this._absoluteUrl(e.href);t.push({href:n,rel:e.rel,type:e.type})}catch{}}for(const n of Object.keys(e.highwire)){const o=e.highwire[n];if("pdf_url"===n)for(const e of o)try{t.push({href:this._absoluteUrl(e),
type:"application/pdf"})}catch{}if("doi"===n)for(let e of o)"doi:"!==e.slice(0,4)&&(e=`doi:${e}`),t.push({href:e})}for(const n of Object.keys(e.dc)){const o=e.dc[n];if("identifier"===n)for(const e of o)"doi:"===e.slice(0,4)&&t.push({href:e})}const o=e.dc["relation.ispartof"],i=e.dc.identifier;if(o&&i){const e=o[o.length-1],n=i[i.length-1],r="urn:x-dc:"+encodeURIComponent(e)+"/"+encodeURIComponent(n);t.push({href:r})}return t}_getFavicon(){let e=null;for(const t of Array.from(this.document.querySelectorAll("link")))if(["shortcut icon","icon"].includes(t.rel))try{e=this._absoluteUrl(t.href)}catch{}return e}_absoluteUrl(e){return Ni(e,this.document.baseURI)}_getDocumentHref(){const{href:e}=this.document.location,t=["http:","https:","file:"],n=new URL(e).protocol;return t.includes(n)?e:this.document.baseURI&&t.includes(new URL(this.document.baseURI).protocol)?this.document.baseURI:e}}class Si extends an{constructor({features:e,container:t=document.body,sideBySideOptions:n}){super(),this.featureFlags=e,
this.container=t,this._htmlMeta=new Ci,this._prevURI=this._htmlMeta.uri(),this._sideBySideEnabled=!0,this._sideBySideOptions=n??{mode:"auto"},this._sideBySideActive=!1,this._lastLayout=null,this._navObserver=new gi((()=>this._checkForURIChange())),this._metaObserver=new MutationObserver((()=>this._checkForURIChange())),this._metaObserver.observe(document.head,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["rel","href","name","content"]}),this._flagsChanged=()=>{},this.featureFlags.on("flagsChanged",this._flagsChanged)}anchor(e,t){return function(e,t,n={}){let o=null,i=null,r=null,s=null;for(const e of t)switch(e.type){case"TextPositionSelector":i=e,n.hint=i.start;break;case"TextQuoteSelector":r=e;break;case"RangeSelector":s=e;break;case"MediaTimeSelector":o=e}const a=e=>{if(r?.exact&&e.toString()!==r.exact)throw new Error("quote mismatch");return e};let l=Promise.reject("unable to anchor");if(s){const t=s;l=l.catch((()=>fi(si.fromSelector(e,t),n).then(a)))}if(i){const t=i
;l=l.catch((()=>fi(ai.fromSelector(e,t),n).then(a)))}if(r){const t=r;l=l.catch((()=>fi(li.fromSelector(e,t),n)))}if(o){const t=o;l=l.catch((()=>ui.fromSelector(e,t).toRange()))}return l}(e,t)}describe(e,t){if(t instanceof Range)return function(e,t){const n=[ui,si,ai,li],o=[];for(const i of n)try{const n=i.fromRange(e,t);n&&o.push(n.toSelector())}catch{}return o}(e,t);throw new Error("Unsupported region type")}_checkForURIChange(){const e=this._htmlMeta.uri();e!==this._prevURI&&(this._prevURI=e,this.emit("uriChanged",e))}getAnnotatableRange(e){try{return uo.trimmedRange(e)}catch(e){if(e instanceof RangeError)return null;throw e}}canStyleClusteredHighlights(){return!0}destroy(){this._deactivateSideBySide(),this._navObserver.disconnect(),this._metaObserver.disconnect(),this.featureFlags.off("flagsChanged",this._flagsChanged),super.destroy()}contentContainer(){return this.container}fitSideBySide(e){this._lastLayout=e
;const t=window.innerWidth-e.width,n=this._sideBySideEnabled&&"auto"===this._sideBySideOptions.mode&&e.expanded&&t>=480;return n?this._activateSideBySide(e.width):this._sideBySideActive&&this._deactivateSideBySide(),this._sideBySideActive=n,this.container.classList.toggle("hypothesis-sidebyside-active",this._sideBySideActive),n}sideBySideActive(){return this._sideBySideActive}supportedTools(){return["selection"]}_activateSideBySide(e){const t=e+12,n=e=>parseInt(window.getComputedStyle(e).marginLeft,10);Bn((()=>{document.body.style.marginLeft="",document.body.style.marginRight="";const e=n(document.body);document.body.style.marginRight=`${t}px`;const o=function(e){const t=new Map,n=new Map,o=Pn.join(","),i=Array.from(e.querySelectorAll(o)).map((e=>({rect:e.getBoundingClientRect(),textLength:e.textContent.length}))).filter((({rect:e})=>e.width>0&&e.height>0)).sort(((e,t)=>t.textLength-e.textLength)).slice(0,15);if(i.forEach((({rect:e})=>{let o=t.get(e.left)??0;o+=1,t.set(e.left,o);let i=n.get(e.right)??0;i+=1,
n.set(e.right,i)})),0===t.size||0===n.size)return null;const r=[...t.entries()].sort(((e,t)=>t[1]-e[1])),s=[...n.entries()].sort(((e,t)=>t[1]-e[1])),[a]=r[0],[l]=s[0];return{left:a,right:l}}(document.body);if(o){const i=Math.max(0,window.innerWidth-t-o.right);if(i>0){const e=Math.max(0,t-i);document.body.style.marginRight=`${e}px`}n(document.body)>e&&(document.body.style.marginLeft=`${e}px`),o.left<12&&(document.body.style.marginLeft="12px")}else document.body.style.marginLeft="",document.body.style.marginRight=""}))}_deactivateSideBySide(){Bn((()=>{document.body.style.marginLeft="",document.body.style.marginRight=""}))}async getMetadata(){return this._htmlMeta.getDocumentMetadata()}async uri(){return this._htmlMeta.uri()}async scrollToAnchor(e){const t=e.highlights?.[0];t&&await async function(e,{maxDuration:t=500}={}){const n=e.closest("body");n&&"BODY"!==n.tagName&&Object.defineProperty(n,"tagName",{value:"BODY",configurable:!0});const o=e.closest("details");o&&!o.hasAttribute("open")&&(o.open=!0),
await new Promise((n=>vi(e,{time:t},n)))}(t)}}var Ai,ki;var Ri=function(){if(ki)return Ai;ki=1;var e=NaN,t="[object Symbol]",n=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,r=/^0o[0-7]+$/i,s=parseInt,a="object"==typeof xe&&xe&&xe.Object===Object&&xe,l="object"==typeof self&&self&&self.Object===Object&&self,c=a||l||Function("return this")(),h=Object.prototype.toString,d=Math.max,u=Math.min,f=function(){return c.Date.now()};function m(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(a){if("number"==typeof a)return a;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&h.call(e)==t}(a))return e;if(m(a)){var l="function"==typeof a.valueOf?a.valueOf():a;a=m(l)?l+"":l}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(n,"");var c=i.test(a);return c||r.test(a)?s(a.slice(2),c?2:8):o.test(a)?e:+a}return Ai=function(e,t,n){var o,i,r,s,a,l,c=0,h=!1,g=!1,_=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var n=o,r=i
;return o=i=void 0,c=t,s=e.apply(r,n)}function w(e){var n=e-l;return void 0===l||n>=t||n<0||g&&e-c>=r}function v(){var e=f();if(w(e))return y(e);a=setTimeout(v,function(e){var n=t-(e-l);return g?u(n,r-(e-c)):n}(e))}function y(e){return a=void 0,_&&o?b(e):(o=i=void 0,s)}function x(){var e=f(),n=w(e);if(o=arguments,i=this,l=e,n){if(void 0===a)return function(e){return c=e,a=setTimeout(v,t),h?b(e):s}(l);if(g)return a=setTimeout(v,t),b(l)}return void 0===a&&(a=setTimeout(v,t)),s}return t=p(t)||0,m(n)&&(h=!!n.leading,r=(g="maxWait"in n)?d(p(n.maxWait)||0,t):r,_="trailing"in n?!!n.trailing:_),x.cancel=function(){void 0!==a&&clearTimeout(a),c=0,o=l=i=a=void 0},x.flush=function(){return void 0===a?s:y(f())},x},Ai}(),Ei=Ne(Ri);function Pi(e,t,n,o=0){let i=o;for(;i<e.length&&t>0;)n(e[i])&&--t,++i;return i}function Ti(e,t,n,o){let i=0;for(let r=n;r<o;r++)t(e[r])&&++i;return i}function Mi(e,t,n,o,i){const r=Ti(e,i,0,n),s=Ti(e,i,n,o);let a=Pi(t,r,i);for(;a<t.length&&!i(t[a]);)++a;return[a,Pi(t,s,i,a)]}const Oi={INITIAL:0,
FINISHED:3},Ii=new Map,Li=new Map;function Bi(e,t){return`${e}:${t}`}function Hi(e){const t="closest"in e?e:e.parentElement;return t?.closest(".textLayer")??null}function Fi(){return PDFViewerApplication.pdfViewer}async function Di(e){const t=Fi();let n=t.getPageView(e);return n&&n.pdfPage||(n=await new Promise((n=>{const o=()=>{t.eventBus?t.eventBus.off("pagesloaded",o):document.removeEventListener("pagesloaded",o),n(t.getPageView(e))};t.eventBus?t.eventBus.on("pagesloaded",o):document.addEventListener("pagesloaded",o)}))),n}function Vi(e,t){return document.elementsFromPoint(e,t).find((e=>e.classList.contains("textLayer")))}function Ui(e){const t=Ii.get(e);if(t)return t;const n=(async()=>{const t=await Di(e);return(await t.pdfPage.getTextContent({normalizeWhitespace:!0})).items.map((e=>e.str)).join("")})();return Ii.set(e,n),n}async function qi(e){const t=Fi();let n=0,o=0,i="";for(let r=0;r<t.pagesCount;r++)if(i=await Ui(r),n=o,o+=i.length,o>=e)return{index:r,offset:n,text:i};return{index:t.pagesCount-1,
offset:n,text:i}}function $i(e){switch(e){case" ":case"\f":case"\n":case"\r":case"\t":case"\v":case" ":return!0;default:return!1}}const zi=e=>!$i(e);function Wi(e){return void 0!==e.renderingDone?e.renderingDone:!!e.div&&null!==e.div.querySelector(".endOfContent")}async function ji(e,t,n){const[o,i]=await Promise.all([Di(e),Ui(e)]);if(o.renderingState===Oi.FINISHED&&o.textLayer&&Wi(o.textLayer)){const e=o.textLayer.textLayerDiv??o.textLayer.div;if(!e)throw new Error("Unable to find PDF.js text layer root");const r=e.textContent,[s,a]=Mi(i,r,t,n,zi);Xi(r.slice(s,a))!==Xi(i.slice(t,n))&&Vo("Text layer text does not match page text. Highlights will be mis-aligned.");const l=new ho(e,s),c=new ho(e,a);return new uo(l,c).toRange()}const r=function(e){let t=e.querySelector(fo);return t||(t=document.createElement("span"),t.classList.add("annotator-placeholder"),t.textContent="Loading annotations...",e.appendChild(t),t)}(o.div),s=document.createRange();return s.setStartBefore(r),s.setEndAfter(r),s}function Xi(e){
let t="";for(let n=0;n<e.length;n++){const o=e[n];$i(o)||(t+=o)}return t}async function Yi(e){const t=e.find((e=>"TextQuoteSelector"===e.type));if(!t)throw new Error("No quote selector found");const n=e.find((e=>"TextPositionSelector"===e.type));if(n){try{const{index:e,offset:o,text:i}=await qi(n.start),r=n.start-o,s=n.end-o,a=i.substring(r,s);if(t.exact!==a)throw new Error("quote mismatch");return await ji(e,r,s)}catch{}try{const e=Bi(t.exact,n.start),o=Li.get(e);if(o){const{pageIndex:e,anchor:t}=o;return await ji(e,t.start,t.end)}}catch{}}return async function(e,t){const n=Fi().pagesCount,o=Array(n).fill(0).map(((e,t)=>t));let i,r;if(t){const{index:e,offset:n}=await qi(t);i=e,r=t-n,o.sort(((t,n)=>Math.abs(t-e)-Math.abs(n-e)))}const s=void 0!==e.prefix?Xi(e.prefix):void 0,a=void 0!==e.suffix?Xi(e.suffix):void 0,l=Xi(e.exact);let c;for(const e of o){const t=await Ui(e),n=Xi(t);let o;void 0!==i&&void 0!==r&&(e<i?o=n.length:e===i?[o]=Mi(t,n,r,r,zi):o=0);const h=ti(n,l,{prefix:s,suffix:a,hint:o})
;if(h&&(!c||h.score>c.match.score)){const[o,i]=Mi(n,t,h.start,h.end,zi);c={page:e,match:{start:o,end:i,score:h.score}};const r=n.slice(h.start,h.end)===l,d=void 0!==s&&n.slice(Math.max(0,h.start-s.length),h.start)===s,u=void 0!==a&&n.slice(h.end,a.length)===a;if(r&&(d||u||void 0===s&&void 0===a))break}}if(c){const{page:n,match:o}=c;if(t){const i=Bi(e.exact,t);Li.set(i,{pageIndex:n,anchor:o})}return ji(n,o.start,o.end)}throw new Error("Quote not found")}(t,n?.start)}async function Ki(e){const t=e.find((e=>"PageSelector"===e.type)),n=e.find((e=>"ShapeSelector"===e.type));if(n){if(!t)throw new Error("Cannot anchor a shape selector without a page");return async function(e,t){const n=Fi();if("number"!=typeof e.index||e.index<0||e.index>=n.pagesCount)throw new Error("PDF page index is invalid");const o=await Di(e.index),i=o.div,r=o.viewport,s=e=>function(e,t,n){return Math.max(Math.min(e,n),t)}(e,0,1);let a;switch(t.shape.type){case"rect":{const e=t.shape
;let[n,o]=r.convertToViewportPoint(e.left,e.top),[i,l]=r.convertToViewportPoint(e.right,e.bottom);i<n&&([n,i]=[i,n]),l<o&&([o,l]=[l,o]),a={type:"rect",left:s(n/r.width),top:s(o/r.height),right:s(i/r.width),bottom:s(l/r.height)}}break;case"point":{const e=t.shape,[n,i]=o.viewport.convertToViewportPoint(e.x,e.y);a={type:"point",x:s(n/r.width),y:s(i/r.height)}}break;default:throw new Error("Unsupported shape in shape selector")}return{anchor:i,shape:a,coordinates:"anchor"}}(t,n)}return Yi(e)}function Gi(e){try{e=uo.fromRange(e).toRange()}catch{throw new Error("Selection does not contain text")}const t=Hi(e.startContainer),n=Hi(e.endContainer);if(!t||!n)throw new Error("Selection is outside page text");if(t!==n)throw new Error("Selecting across page breaks is not supported");return[e,t]}function Qi(e){const t=e.closest(".page"),n=parseInt(t?.getAttribute("data-page-number")??"");if(!Number.isInteger(n))throw new Error("Unable to get page number from element");return n-1}async function Ji(e){
const[t,n]=Gi(e),o=ho.fromPoint(t.startContainer,t.startOffset).relativeTo(n),i=ho.fromPoint(t.endContainer,t.endOffset).relativeTo(n),r=Qi(n),s=await async function(e){if(e>=Fi().pagesCount)throw new Error("Invalid page index");let t=0;for(let n=0;n<e;n++)t+=(await Ui(n)).length;return t}(r),a=await Di(r);return[{type:"TextPositionSelector",start:s+o.offset,end:s+i.offset},li.fromRange(a.div,t).toSelector(),er(a,r)]}async function Zi(e,t){const n=document.elementsFromPoint(e,t);for(const o of n){if(!o.classList.contains("page"))continue;const n=Qi(o),i=getComputedStyle(o),r=parseFloat(i.borderLeftWidth),s=parseFloat(i.borderTopWidth),a=o.getBoundingClientRect(),l=e-a.left-r,c=t-a.top-s,h=await Di(n),[d,u]=h.getPagePoint(l,c);return{pageIndex:n,x:d,y:u}}return null}function er(e,t){return{type:"PageSelector",index:t,label:e.pageLabel??`${t+1}`}}async function tr(e){const t=e=>{const[t,n,o,i]=e.view;return{left:t,top:i,right:o,bottom:n}},n=(e,t)=>function(e,t){
const n=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),o=[];let i,r;for(;r=n.nextNode();){const e=r,n=e.data.split(/\b/);let s=0;for(const r of n){const n=new Range;n.setStart(e,s);const a=s+r.length;n.setEnd(e,a);const l=n.getBoundingClientRect();Nn(l,t)&&(i&&!Cn(i,l)&&o.push(" "),o.push(r),i=l),s=a}}return o.join("")}(e,t).slice(0,256);switch(e.type){case"rect":{const[o,i]=await Promise.all([Zi(e.left,e.top),Zi(e.right,e.bottom)]);if(!o)throw new Error("Top-left point is not in a page");if(!i)throw new Error("Bottom-right point is not in a page");if(o.pageIndex!==i.pageIndex)throw new Error("Shape must start and end on same page");const r=await Di(o.pageIndex),s={type:"rect",left:o.x,top:o.y,right:i.x,bottom:i.y},a=Vi(e.left,e.top);let l;if(a){l=n(a,new DOMRect(e.left,e.top,e.right-e.left,e.bottom-e.top))}return[er(r,o.pageIndex),{type:"ShapeSelector",anchor:"page",shape:s,view:t(r.pdfPage),text:l}]}case"point":{const o=await Zi(e.x,e.y);if(!o)throw new Error("Point is not in a page")
;const i=Vi(e.x,e.y);let r;if(i){r=n(i,new DOMRect(e.x,e.y,1,1))}const s=await Di(o.pageIndex);return[er(s,o.pageIndex),{type:"ShapeSelector",anchor:"page",shape:{type:"point",x:o.x,y:o.y},text:r,view:t(s.pdfPage)}]}default:throw new Error("Unsupported shape")}}function nr({children:e}){return Pe("div",{className:"flex flex-col",children:e})}function or({info:e}){let t=e.item.title;return e.item.subtitle&&(t+=`: ${e.item.subtitle}`),Pe("div",{className:Re("h-10 bg-white px-4 text-slate-7 text-annotator-base border-b","grid items-center","grid-cols-[100px_minmax(0,auto)]","2xl:grid-cols-[100px_minmax(0,auto)_minmax(0,auto)] 2xl:gap-x-3"),children:[Pe("div",{"data-testid":"content-logo",children:e.logo&&Pe(Jt,{href:e.logo.link,target:"_blank","data-testid":"logo-link",underline:"none",children:Pe("img",{alt:e.logo.title,src:e.logo.logo,"data-testid":"logo-image"})})}),Pe("div",{className:Re("hidden","2xl:block 2xl:whitespace-nowrap 2xl:overflow-hidden 2xl:text-ellipsis","font-semibold"),
"data-testid":"content-container-info",title:e.container.title,children:e.container.title}),Pe("div",{className:Re("flex justify-center items-center gap-x-2"),"data-testid":"content-item-info",children:[Pe("div",{className:Re("hidden","2xl:block 2xl:grow")}),e.links.previousItem&&Pe(w,{children:[Pe(Jt,{title:"Open previous item",href:e.links.previousItem,underline:"always",target:"_blank","data-testid":"content-previous-link",children:Pe("div",{className:"flex gap-x-1 items-center text-annotator-sm whitespace-nowrap",children:[Pe(qe,{className:"w-em h-em"}),Pe("span",{children:"Previous"})]})}),Pe("div",{className:"text-annotator-sm",children:"|"})]}),Pe("div",{className:Re("min-w-0 whitespace-nowrap overflow-hidden text-ellipsis shrink font-medium"),children:Pe(Jt,{title:t,href:e.links.currentItem,"data-testid":"content-item-link",target:"_blank",unstyled:!0,children:t})}),e.links.nextItem&&Pe(w,{children:[Pe("div",{className:"text-annotator-sm",children:"|"}),Pe(Jt,{title:"Open next item",
href:e.links.nextItem,underline:"always",target:"_blank","data-testid":"content-next-link",children:Pe("div",{className:"flex gap gap-x-1 items-center text-annotator-sm whitespace-nowrap",children:[Pe("span",{children:"Next"}),Pe(ze,{className:"w-em h-em"})]})})]})]})]})}function ir(){return Pe("div",{className:"bg-white",role:"alert",children:Pe("div",{className:Re("flex items-center gap-x-2","border border-yellow-notice bg-yellow-notice/10 text-annotator-base"),children:[Pe("div",{className:"bg-yellow-notice text-white p-2",children:Pe(je,{className:"text-annotator-xl"})}),Pe("div",{children:[Pe("strong",{children:"This PDF does not contain selectable text:"})," ",Pe(Jt,{target:"_blank",href:"https://web.hypothes.is/help/how-to-ocr-optimize-pdfs/",underline:"always",children:"Learn how to fix this"})," ","in order to annotate with Hypothesis."]})]})})}class rr{constructor(e){this._loaded=function(e){return e.initializedPromise?e.initializedPromise:e.initialized?Promise.resolve():new Promise((t=>{
const n=setInterval((()=>{e.initialized&&(clearTimeout(n),t())}),5)}))}(e).then((async()=>{const t=await async function(e){return void 0!==e.downloadComplete?e.downloadComplete:(await e.pdfDocument.getDownloadInfo(),!0)}(e);return t?e:new Promise((t=>{const n=()=>{e.eventBus?(e.eventBus.off("documentload",n),e.eventBus.off("documentloaded",n)):window.removeEventListener("documentload",n),t(e)};e.eventBus?(e.eventBus.on("documentloaded",n),e.eventBus.on("documentload",n)):window.addEventListener("documentload",n)}))}))}getUri(){return this._loaded.then((e=>{let t=lr(e);return t||(t=ar(sr(e))),t}))}async getMetadata(){const e=await this._loaded,{info:t,contentDispositionFilename:n,metadata:o}=await e.pdfDocument.getMetadata(),i=sr(e),r=lr(e);let s;s=o?.has("dc:title")&&"Untitled"!==o.get("dc:title")?o.get("dc:title"):t?.Title?t.Title:n||(r?function(e){const t=new URL(e),n=t.pathname.split("/");return n[n.length-1]}(r):"");const a=[{href:ar(i)}];return r&&a.push({href:r}),{title:s,link:a,documentFingerprint:i}}}
function sr(e){return Array.isArray(e.pdfDocument.fingerprints)?e.pdfDocument.fingerprints[0]:e.pdfDocument.fingerprint}function ar(e){return`urn:x-pdf:${e}`}function lr(e){if(!e.url)return null;const t=Ni(e.url);return 0!==t.indexOf("file://")?t:null}function cr(e){const t=e.highlights?.[0];return t&&mo(t)}function hr(e){return new Promise((t=>setTimeout(t,e)))}class dr{constructor(){this._pdfjsContainer=document.querySelector("#outerContainer"),this._contentInfo=null,this._noTextWarning=!1,this._container=null}setContentInfo(e){this._contentInfo=e,this._update()}showNoTextWarning(e){this._noTextWarning=e,this._update()}destroy(){this._container?.destroy()}_update(){if(!(this._noTextWarning||this._contentInfo))return this._container?.destroy(),this._container=null,void(this._pdfjsContainer.style.height="");this._container||(this._container=new Zn("banner",(()=>this._render())),document.body.prepend(this._container.element)),this._container.render()
;const e=this._container.element.getBoundingClientRect().height;this._pdfjsContainer.style.height=`calc(100% - ${e}px)`}_render(){return Pe(nr,{children:[this._contentInfo&&Pe(or,{info:this._contentInfo}),this._noTextWarning&&Pe(ir,{})]})}}class ur extends an{constructor({annotator:e,features:t,reanchoringMaxWait:n}){super(),this._annotator=e;const o=window,i=o.PDFViewerApplication;this._pdfViewer=i.pdfViewer,this._pdfViewer.viewer.classList.add("has-transparent-text-layer"),this._pdfContainer=i.appConfig?.appContainer??document.body,this._pdfMetadata=new rr(i),this._observer=new MutationObserver(Ei((()=>this._update()),100)),this._observer.observe(this._pdfViewer.viewer,{attributes:!0,attributeFilter:["data-loaded"],childList:!0,subtree:!0}),this._reanchoringMaxWait=n??3e3,this._banner=new dr,this._checkForSelectableText(),this._sideBySideActive=!1,this._updateAnnotationLayerVisibility=()=>{const e=o.getSelection();this._pdfViewer.viewer.classList.toggle("is-selecting",!e.isCollapsed)},
this._listeners=new ge,this._listeners.add(document,"selectionchange",this._updateAnnotationLayerVisibility),this._destroyed=!1,this._features=t,this._features.on("flagsChanged",(()=>{this.emit("supportedToolsChanged",this.supportedTools())})),this._pdfViewer.viewer.addEventListener("click",(e=>{const t=e.target;t instanceof HTMLAnchorElement&&(t.target="blank");ko(e.clientX,e.clientY).length>0&&e.preventDefault()}))}destroy(){this.fitSideBySide({expanded:!1,width:0,toolbarWidth:0,height:window.innerHeight}),this._listeners.removeAll(),this._pdfViewer.viewer.classList.remove("has-transparent-text-layer"),this._observer.disconnect(),this._banner.destroy(),this._destroyed=!0,super.destroy()}uri(){return this._pdfMetadata.getUri()}getMetadata(){return this._pdfMetadata.getMetadata()}showContentInfo(e){this._banner.setContentInfo(e)}anchor(e,t){return Ki(t)}getAnnotatableRange(e){try{const t=uo.trimmedRange(e);if(function(e){try{return Gi(e),!0}catch{return!1}}(t))return t}catch(e){
if(!(e instanceof RangeError))throw e}return null}canStyleClusteredHighlights(){return!0}describe(e,t){return t instanceof Range?Ji(t):tr(t)}async _checkForSelectableText(){try{await this.uri()}catch{return}if(!this._destroyed)try{const e=await async function(){const e=Fi();let t=!1;for(let n=0;n<e.pagesCount;n++)if((await Ui(n)).trim().length>0){t=!0;break}return t}();this._banner.showNoTextWarning(!e)}catch(e){console.warn("Unable to check for text in PDF:",e)}}_update(){const e=[],t=this._pdfViewer.pagesCount;for(let e=0;e<t;e++){const t=this._pdfViewer.getPageView(e);if(t?.textLayer&&Wi(t.textLayer))switch(t.renderingState){case Oi.INITIAL:t.textLayer=null;break;case Oi.FINISHED:n=t.div,n.querySelector(fo)?.remove()}}var n;for(const t of this._annotator.anchors)if(t.highlights){if(e.includes(t.annotation))continue;for(let n=0;n<t.highlights.length;n++){const o=t.highlights[n];if(!document.body.contains(o)){t.highlights.splice(n,1),delete t.region,e.push(t.annotation);break}}}
e.map((e=>this._annotator.anchor(e)))}contentContainer(){return document.querySelector("#viewerContainer")}fitSideBySide(e){const t=window.innerWidth-e.width,n=e.expanded&&t>=680,o=n?e.width:e.toolbarWidth;this._pdfContainer.style.width=`calc(100% - ${o}px)`;const i=this._pdfViewer.currentScaleValue;return"auto"!==i&&"page-fit"!==i&&"page-width"!==i||(this._pdfViewer.currentScaleValue=i),this._pdfViewer.update(),this._sideBySideActive=n,n}sideBySideActive(){return this._sideBySideActive}supportedTools(){const e=this._features?.flagEnabled("pdf_image_annotation");return e?["selection","rect","point"]:["selection"]}async scrollToAnchor(e){const t=e.annotation,n=cr(e),o=this._anchorOffset(e);if(null!==o&&(await xi(this.contentContainer(),o),n)){const e=await this._waitForAnnotationToBeAnchored(t,this._reanchoringMaxWait);if(!e)return;const n=this._anchorOffset(e);if(null===n)return;await xi(this.contentContainer(),n)}}async _waitForAnnotationToBeAnchored(e,t){const n=Date.now();let o;do{
o=this._annotator.anchors.find((t=>t.annotation===e)),o&&!cr(o)||(o=null,await hr(20))}while(!o&&Date.now()-n<t);return o??null}_anchorOffset(e){if(!e.highlights)return null;const t=e.highlights[0];return function(e,t,n={}){let o=0,i=t;for(;i!==e&&e.contains(i);)o+=i.offsetTop,i=i.offsetParent;if("center"===n.position){const n=e.getBoundingClientRect(),i=t.getBoundingClientRect();o-=n.height/2-i.height/2}return o}(this.contentContainer(),t,{position:"center"})}async renderToBitmap(e,t){const n=e.target.selector?.find((e=>"ShapeSelector"===e.type)),o=e.target.selector?.find((e=>"PageSelector"===e.type));if(!o||!n)throw new Error("Can only render bitmaps for anchors with shapes");const i=this._pdfViewer.getPageView(o.index);if(!i)throw new Error("Failed to get page view");let r,s,a,l;switch(n.shape.type){case"rect":({left:r,right:s,top:a,bottom:l}=n.shape);break;case"point":{const{x:e,y:t}=n.shape,[o,,c]=i.pdfPage.view,h=.1*Math.abs(c-o);r=e-h,a=t+h,s=e+h,l=t-h}break;default:
throw new Error("Unsupported shape type")}s<r&&([r,s]=[s,r]),s=Math.max(s,r+1),a<l&&([a,l]=[l,a]),a=Math.max(a,l+1);const c=i.pdfPage.rotate%360;if(c%90!=0)throw new Error("Page rotation is not a multiple of 90 degrees");let h,d;0===c||180===c?(h=Math.abs(s-r),d=Math.abs(l-a)):(h=Math.abs(l-a),d=Math.abs(s-r));const u=96/72,f=t.devicePixelRatio??1,m=h*u*f,p=h/d,g="number"==typeof t.maxWidth?Math.min(t.maxWidth,m):m,_=g/p,b=i.pdfPage.getViewport({scale:1}),w=g/m*u*f,v=new(0,b.constructor)({rotation:c,scale:w,userUnit:b.userUnit,viewBox:[r,l,s,a]}),y=Math.max(g,1),x=Math.max(_,1),N=new OffscreenCanvas(y,x),C=N.getContext("2d"),S=i.pdfPage.render({canvasContext:C,viewport:v});if(await S.promise,"point"===n.shape.type){C.save(),C.scale(w,w);const e=n.shape.x-r,t=n.shape.y-l,o=5;C.strokeStyle="black",C.fillStyle="yellow",C.beginPath(),C.arc(e,t,o,0,2*Math.PI),C.fill(),C.stroke(),C.restore()}return N.transferToImageBitmap()}}function fr(e){if(!e.includes("["))return e;let t="",n=!1,o=!1
;for(const i of e)n||"^"!==i?(n||"["!==i?!n&&o&&"]"===i?o=!1:o||(t+=i):o=!0,n=!1):n=!0;return t}function mr(e){const t=fr(e),n=t.indexOf("!");return-1===n?t:t.slice(0,n)}class pr{constructor(e,t,n){this._element=e,this._onFrameAdded=t,this._onFrameRemoved=n,this._annotatableFrames=new Set,this._isDisconnected=!1,this._mutationObserver=new MutationObserver(Ei((()=>{this._discoverFrames()}),40)),this._discoverFrames(),this._mutationObserver.observe(this._element,{childList:!0,subtree:!0,attributeFilter:["enable-annotation"]})}disconnect(){this._isDisconnected=!0,this._mutationObserver.disconnect()}async _addFrame(e){this._annotatableFrames.add(e);try{if(await gr(e),this._isDisconnected)return;e.contentWindow.addEventListener("unload",(()=>{this._removeFrame(e)})),this._onFrameAdded(e)}catch{console.warn(`Unable to inject the Hypothesis client (from '${document.location.href}' into a cross-origin frame '${e.src}')`)}}_removeFrame(e){this._annotatableFrames.delete(e),this._onFrameRemoved(e)}_discoverFrames(){
const e=new Set(this._element.querySelectorAll("iframe[enable-annotation]"));for(const t of e)this._annotatableFrames.has(t)||this._addFrame(t);for(const t of this._annotatableFrames)e.has(t)||this._removeFrame(t)}}function gr(e){return new Promise(((t,n)=>{const o=_r(e,((e,i)=>{o(),i?t(i):n(e)}))}))}function _r(e,t,{pollInterval:n=10}={}){let o,i;const r=new WeakSet,s=()=>{clearTimeout(o),o=void 0},a=()=>{const n=e.contentDocument;if(n){if(!r.has(n)){if(r.add(n),s(),!function(e){return"about:blank"===e.contentDocument?.location.href&&e.hasAttribute("src")&&"about:blank"!==e.src}(e)){"interactive"===n.readyState||"complete"===n.readyState?t(null,n):n.addEventListener("DOMContentLoaded",(()=>t(null,n)))}e.contentDocument&&e.contentWindow?.addEventListener("unload",i)}}else{s();const n=e.isConnected?"Frame is cross-origin":"Frame is disconnected";t(new Error(n))}};let l=!1;i=()=>{s(),l||(o=setInterval(a,n))},e.addEventListener("load",a);const c=setTimeout(a,0);return()=>{l=!0,clearTimeout(c),s(),
e.removeEventListener("load",a)}}class br{constructor(e,t){this._config=t,this._frameObserver=new pr(e,(e=>wr(e,t)),(()=>{}))}destroy(){this._frameObserver.disconnect()}}async function wr(e,t,n){if(null!==e.contentDocument.querySelector("script.js-hypothesis-config"))return;await gr(e);const{assetRoot:o,notebookAppUrl:i,profileAppUrl:r,sidebarAppUrl:s}=wn(document),a={...t,assetRoot:o,notebookAppUrl:i,profileAppUrl:r,sidebarAppUrl:s,subFrameIdentifier:n??nn(10)},l=document.createElement("script");l.className="js-hypothesis-config",l.setAttribute("data-remove-on-unload",""),l.type="application/json",l.innerText=JSON.stringify(a);const c=document.createElement("script");c.async=!0,c.src=t.clientUrl;const h=e.contentDocument;h.body.appendChild(l),h.body.appendChild(c)}class vr{constructor(e,t,n){if(t.length!==n.length)throw new Error("Char boxes length does not match text length");const o=e.parentNode,i=document.createElement("hypothesis-text-layer");o.insertBefore(i,e.nextSibling),o.style.position="relative",
i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.color="transparent",i.style.textAlign="left",i.style.mixBlendMode="multiply";const r="sans-serif";i.style.fontSize="16px",i.style.fontFamily=r;const s=document.createElement("canvas").getContext("2d");s.font=`16px ${r}`;const a=(e,t,n="px")=>`calc(var(--${e}-scale) * ${t}${n})`,l=function(e,t){const n=[];let o={text:"",rect:new DOMRect};const i=()=>{o.text.length>0&&(n.push(o),o={text:"",rect:new DOMRect})};for(const[n,r]of e.entries()){const e=t[n],s=/\s/.test(e);o.text.length>0&&!Cn(o.rect,r)&&i(),o.rect=An(o.rect,r),o.text+=s?" ":e,s&&i()}i();const r=[];let s={words:[],rect:new DOMRect};const a=()=>{s.words.length>0&&(r.push(s),s={words:[],rect:new DOMRect})};for(const e of n){const t=s.words[s.words.length-1];if(t){const n=kn(t.rect),o=kn(e.rect).x-n.x;(!Cn(t.rect,e.rect)||o<0)&&a()}s.words.push(e),s.rect=An(s.rect,e.rect)}a();const l=[];let c={lines:[],rect:new DOMRect};const h=()=>{c.lines.length>0&&(l.push(c),c={lines:[],
rect:new DOMRect})};for(const e of r){const t=c.lines[c.lines.length-1];if(t){const n=kn(t.rect),o=kn(e.rect).y-n.y;(!Sn(t.rect,e.rect)||Cn(t.rect,e.rect)||o<0||o>4*e.rect.height)&&h()}c.lines.push(e),c.rect=An(c.rect,e.rect)}return h(),l}(t,n);for(const e of l){const t=document.createElement("hypothesis-text-column");t.style.display="block",t.style.position="absolute",t.style.left=a("x",e.rect.left),t.style.top=a("y",e.rect.top);let n=null;for(const o of e.lines){const i=document.createElement("hypothesis-text-line");i.style.display="block",i.style.marginLeft=a("x",o.rect.left-e.rect.left),i.style.height=a("y",o.rect.height),n&&(i.style.marginTop=a("y",o.rect.top-n.rect.bottom)),n=o,i.style.whiteSpace="nowrap";let r=null;for(const e of o.words){const t=document.createElement("hypothesis-text-word");t.style.display="inline-block",t.style.transformOrigin="top left",t.textContent=e.text,r&&(t.style.marginLeft=a("x",e.rect.left-r.rect.right)),r=e,t.style.width=a("x",e.rect.width),
t.style.height=a("y",e.rect.height),t.style.whiteSpace="pre";const n=s.measureText(e.text),o=a("x",e.rect.width/n.width,""),l=a("y",e.rect.height/16,"");t.style.transform=`scale(${o}, ${l})`,i.append(t)}t.append(i)}i.append(t)}const c=()=>{const{width:t,height:n}=e.getBoundingClientRect();i.style.width=t+"px",i.style.height=n+"px",i.style.setProperty("--x-scale",`${t}`),i.style.setProperty("--y-scale",`${n}`)};c(),this.container=i,this._updateTextLayerSize=Ei(c,{maxWait:50}),this._listeners=new ge,"undefined"!=typeof ResizeObserver&&(this._imageSizeObserver=new ResizeObserver((()=>{this._updateTextLayerSize()})),this._imageSizeObserver.observe(e)),this._listeners.add(window,"resize",this._updateTextLayerSize)}updateSync(){this._updateTextLayerSize(),this._updateTextLayerSize.flush()}destroy(){this.container.remove(),this._listeners.removeAll(),this._updateTextLayerSize.cancel(),this._imageSizeObserver?.disconnect()}}function yr(e=document){return e.querySelector("mosaic-book")}function xr(e=window){
if(yr(e.document))return"container";const t=e.frameElement?.ownerDocument;return t&&yr(t)?"content":null}class Nr{constructor(e){const t=yr();if(!t)throw new Error("Book container element not found");const n=new WeakSet,o=t.shadowRoot,i=()=>{const t=o.querySelector("iframe");t&&!n.has(t)&&(n.add(t),_r(t,((n,o)=>{if(n)return;const i=o.body;i&&!i.querySelector("#page-content")&&wr(t,e,"vitalsource-content")})))};i(),this._frameObserver=new MutationObserver(i),this._frameObserver.observe(o,{childList:!0,subtree:!0})}destroy(){this._frameObserver.disconnect()}}function Cr(){return document.querySelector("img#pbk-page")}class Sr extends an{constructor(e=document.body,t={}){super();const n=t.bookElement??yr(window.parent.document);if(!n)throw new Error("Failed to find <mosaic-book> element in container frame");this._bookElement=n;const o=new qo;this._htmlIntegration=new Si({container:e,features:o}),this._listeners=new ge;const i=["mouseup","mousedown","mouseout"]
;for(const e of i)this._listeners.add(document.documentElement,e,(e=>{e.stopPropagation()}));const r=window.frameElement;r&&function(e){if("no"!==e.getAttribute("scrolling"))return;const t=document.createElement("style");t.textContent="iframe { height: 100% !important; }",e.insertAdjacentElement("beforebegin",t);const n=()=>e.removeAttribute("scrolling");n(),new MutationObserver(n).observe(e,{attributes:!0})}(r);const s=Cr(),a=window.innerPageData;if(s&&a){const e=a.glyphs.glyphs.map((e=>{const t=e.l/100,n=e.r/100,o=e.t/100,i=e.b/100;return new DOMRect(t,o,n-t,i-o)}));this._textLayer=new vr(s,e,a.words),this._textLayer.container.style.zIndex="100",this._sideBySideActive=!1}}getAnnotatableRange(e){return this._htmlIntegration.getAnnotatableRange(e)}destroy(){this._textLayer&&(this._textLayer.destroy(),this.fitSideBySide({expanded:!1,height:window.innerHeight,width:0,toolbarWidth:0})),this._listeners.removeAll(),this._htmlIntegration.destroy(),super.destroy()}anchor(e,t){return this._htmlIntegration.anchor(e,t)
}async describe(e,t){const n=this._htmlIntegration.describe(e,t),{cfi:o,index:i,page:r,title:s,url:a}=await this._getPageInfo({includeTitle:!0,includePageIndex:!0}),l=[{type:"EPUBContentSelector",cfi:o,url:a,title:s}];if("number"==typeof i){const e={type:"PageSelector",index:i,label:r};l.push(e)}return n.push(...l),n}contentContainer(){return this._htmlIntegration.contentContainer()}fitSideBySide(e){const t=Cr();if(t&&this._textLayer){const n=t.parentElement,o=this._textLayer,i=window.innerWidth-e.width;return this._sideBySideActive=!1,Bn((()=>{e.expanded&&i>480?(n.style.textAlign="left",t.style.width=`${i}px`,this._sideBySideActive=!0):(n.style.textAlign="",t.style.width=""),o.updateSync()})),this._sideBySideActive}return this._htmlIntegration.fitSideBySide(e)}sideBySideActive(){return"boolean"==typeof this._sideBySideActive?this._sideBySideActive:this._htmlIntegration.sideBySideActive()}supportedTools(){return["selection"]}async getMetadata(){return{title:this._bookElement.getBookInfo().title,link:[]}}
navigateToSegment(e){const t=e.target[0].selector?.find((e=>"EPUBContentSelector"===e.type));if(t?.cfi)this._bookElement.goToCfi(t.cfi);else{if(!t?.url)throw new Error("No segment information available");this._bookElement.goToURL(function(e){const t=new URL(e,document.baseURI);return t.pathname+t.search}(t.url))}}persistFrame(){return!0}async _getPageInfo({includeTitle:e=!1,includePageIndex:t=!1}={}){const[n,o,i]=await Promise.all([this._bookElement.getCurrentPage(),e?this._bookElement.getTOC():void 0,t?this._bookElement.getPages():void 0]),r=["absoluteURL","cfi"];for(const e of r)if(!(e in n))throw new Error(`Page metadata field "${e}" is missing`);let s;if(o){s=n.chapterTitle;const e=mr(n.cfi),t=o.data?.find((t=>mr(t.cfi)===e));t&&(s=t.title)}let a=n.index;if(void 0===a&&i){const e=i.data?.findIndex((e=>e.cfi===n.cfi));-1!==e&&(a=e)}return{cfi:n.cfi,index:a,page:n.page,title:s,url:new URL(n.absoluteURL,document.baseURI).toString()}}async _getPageRange(e){let t=[];try{
const e=await this._bookElement.getPageBreaks();e.ok&&e.data&&(t=e.data)}catch(e){console.error("Failed to get page breaks",e)}const n=fr(e),o=t.filter((e=>e.cfiWithoutAssertions.split("!")[0]===n));let i;if(o.length>0){i={start:o[0].label,end:o[o.length-1].label}}return i}async segmentInfo(){const{cfi:e,url:t}=await this._getPageInfo();return{cfi:e,pages:await this._getPageRange(e),url:t}}async uri(){const e=this._bookElement.getBookInfo().isbn;if(!e)throw new Error("Unable to get book ID from VitalSource");return`https://bookshelf.vitalsource.com/reader/books/${e}`}async scrollToAnchor(e){return this._htmlIntegration.scrollToAnchor(e)}}function Ar(e){if(void 0!==window.PDFViewerApplication)return new ur({annotator:e,features:e.features});return"content"===xr()?new Sr(document.body):new Si({features:e.features,sideBySideOptions:e.sideBySide})}function kr(){return Pe(jt,{classes:"fixed left-[10px] top-[10px]","data-testid":"outside-assignment-notice",status:"notice",variant:"raised",
children:"You are outside the page range for this assignment. Annotations made here may not be counted."})}class Rr{constructor(e){this._visible=!1,this._container=new Zn("notice",(()=>this._render())),e.appendChild(this._container.element)}destroy(){this._container.destroy()}setVisible(e){this._visible=e,this._container.render()}_render(){return this._visible?Pe(kr,{}):null}}class Er{constructor(e,t=document){let n=!1;this._pendingCallback=null;const o=(n=10)=>{this._pendingCallback=setTimeout((()=>{e(go(t.getSelection()))}),n)},i=e=>{if("mousedown"===e.type&&(n=!0),"mouseup"===e.type&&(n=!1),n)return;this._cancelPendingCallback();const t="mouseup"===e.type?10:100;o(t)};this._document=t,this._listeners=new ge,this._listeners.add(t,"selectionchange",i),this._listeners.add(t.body,"mousedown",i),this._listeners.add(t.body,"mouseup",i),o(1)}disconnect(){this._listeners.removeAll(),this._cancelPendingCallback()}_cancelPendingCallback(){this._pendingCallback&&(clearTimeout(this._pendingCallback),
this._pendingCallback=null)}}function Pr(e,t){if(e===t)return!0;if(e.parent!==t)return!1;if(!e.frameElement)return!1;return e.frameElement.getBoundingClientRect().width/e.parent.innerWidth>=.8}function Tr(){return function(e,t){const n=new Set,o=new Set;return wo(e,(e=>{for(;e&&!n.has(e);){n.add(e);const i=t(e);null!=i&&o.add(i),e=e.parentNode}})),[...o]}(go()??new Range,(e=>e._annotation?.$tag))}function Mr(e,t,n){return e.getHighlightsFromPoint(t,n).map((e=>e._annotation?.$tag)).filter((e=>void 0!==e))}function Or(e){if(!e.region)return null;if(!function(e){return void 0!==e&&"toRange"in e&&"function"==typeof e.toRange}(e.region))return e.region;try{return e.region.toRange()}catch{return null}}function Ir(){document.getSelection()?.removeAllRanges()}class Lr extends CustomEvent{constructor(e){super("scrolltorange",{bubbles:!0,cancelable:!0,detail:e}),this._ready=null}get ready(){return this._ready}waitUntil(e){this._ready=e}}class Br extends an{constructor(e,t={},n=window){super(),this.element=e,
this._contentReady=t.contentReady,this._hostFrame=n,this._highlightsVisible=!1,this._isAdderVisible=!1,this._informHostOnNextSelectionClear=!0,this.selectedRanges=[],this._outsideAssignmentNotice=null,this._highlighter=new No(this.element),this._adder=new no(this.element,{onAnnotate:()=>this.createAnnotationFromSelection(),onHighlight:()=>this.createAnnotationFromSelection({highlight:!0}),onShowAnnotations:e=>this.selectAnnotations(e,{focusInSidebar:!0})}),this._drawTool=new Ho(this.element),this._selectionObserver=new Er((e=>{e?this._onSelection(e):this._onClearSelection()})),this.anchors=[],this._annotations=new Set,this._frameIdentifier=t.subFrameIdentifier||null,this._portFinder=new sn({hostFrame:this._hostFrame,source:"guest",sourceId:this._frameIdentifier??void 0}),this.features=new qo,this._featureFlagsReceived=new Promise((e=>{this.features.on("flagsChanged",e)})),this.sideBySide=t.sideBySide,this._integration=Ar(this),this._integration.on("uriChanged",(()=>this._sendDocumentInfo())),
t.contentInfoBanner&&this._integration.showContentInfo?.(t.contentInfoBanner),this._integration.canStyleClusteredHighlights?.()&&(this._clusterToolbar=new Xo(this._integration.contentContainer(),{features:this.features})),this._integration.on("supportedToolsChanged",(()=>this._notifySupportedToolsChanged())),this._hostRPC=new _n,this._connectHost(n),this._sidebarRPC=new _n,this._sidebarLayout=null,this._connectSidebar(),this._bucketBarClient=new Io({contentContainer:this._integration.contentContainer(),hostRPC:this._hostRPC}),this._listeners=new ge,this._setupElementEvents(),this._hoveredAnnotations=new Set}_sideBySideActive(){return"manual"===this.sideBySide?.mode&&this.sideBySide.isActive?this.sideBySide.isActive():this._integration.sideBySideActive()}_setupElementEvents(){this._listeners.add(this.element,"mouseup",(e=>{if(!document.getSelection()?.isCollapsed)return;const{clientX:t,clientY:n,metaKey:o,ctrlKey:i}=e,r=Mr(this._highlighter,t,n);if(r.length){const e=o||i;this.selectAnnotations(r,{toggle:e})}
})),this._listeners.add(this.element,"pointerdown",(e=>{this._sideBySideActive()||e.composedPath().some((e=>e instanceof Element&&e.localName.startsWith("hypothesis-")))||Mr(this._highlighter,e.clientX,e.clientY).length||Pr(window,this._hostFrame)&&this._sidebarLayout?.expanded&&window.innerWidth-e.clientX<this._sidebarLayout.width||this._sidebarRPC.call("closeSidebar")})),this._listeners.add(this.element,"mouseover",(({clientX:e,clientY:t})=>{const n=Mr(this._highlighter,e,t);n.length&&this._sidebarRPC.call("hoverAnnotations",n)})),this._listeners.add(this.element,"mouseout",(()=>{this._highlightsVisible&&this._sidebarRPC.call("hoverAnnotations",[])})),this._listeners.add(this.element,"keydown",(e=>{this._handleShortcut(e)})),this._listeners.add(window,"resize",(()=>this._repositionAdder()))}async getDocumentInfo(){const[e,t,n]=await Promise.all([this._integration.uri(),this._integration.getMetadata(),this._integration.segmentInfo?.()]);return{uri:Ni(e),metadata:t,segmentInfo:n,
persistent:this._integration.persistFrame?.()??!1}}async _sendDocumentInfo(){this._integration.waitForFeatureFlags?.()&&await this._featureFlagsReceived;const e=await this.getDocumentInfo();this._sidebarRPC.call("documentInfoChanged",e)}_repositionAdder(){if(!this._isAdderVisible)return;const e=go();e&&this._onSelection(e)}async _connectHost(e){this._hostRPC.on("clearSelection",(()=>{go()&&(this._informHostOnNextSelectionClear=!1,Ir())})),this._hostRPC.on("createAnnotation",(({tool:e})=>e?this.createAnnotation(e):(this._drawTool.cancel(),null))),this._hostRPC.on("hoverAnnotations",(e=>this._hoverAnnotations(e))),this._hostRPC.on("scrollToAnnotation",(e=>{this._scrollToAnnotation(e)})),this._hostRPC.on("selectAnnotations",((e,t)=>this.selectAnnotations(e,{toggle:t}))),this._hostRPC.on("sidebarLayoutChanged",(t=>{Pr(window,e)&&this.fitSideBySide(t),this.element.dispatchEvent(new Fo({sidebarLayout:t,sideBySideActive:this._sideBySideActive()}))})),this._hostRPC.on("close",(()=>this.emit("hostDisconnected"))),
this._notifySupportedToolsChanged();const t=await this._portFinder.discover("host");this._hostRPC.connect(t)}_notifySupportedToolsChanged(){this._hostRPC.call("supportedToolsChanged",this._integration.supportedTools())}async _scrollToAnchor(e){const t=Or(e);if(!t)return;let n;t instanceof Range?n=t:(n=new Range,n.selectNodeContents(t.anchor));const o=new Lr(n);this.element.dispatchEvent(o)&&(await o.ready,await this._integration.scrollToAnchor(e))}async _scrollToAnnotation(e){const t=this.anchors.find((t=>t.annotation.$tag===e));t?.highlights&&await this._scrollToAnchor(t)}async _connectSidebar(){this._sidebarRPC.on("featureFlagsUpdated",(e=>this.features.update(e))),this._sidebarRPC.on("hoverAnnotations",(e=>this._hoverAnnotations(e))),this._sidebarRPC.on("scrollToAnnotation",(e=>{this._scrollToAnnotation(e)})),this._sidebarRPC.on("setHighlightsVisible",(e=>{this.setHighlightsVisible(e,!1)})),this._sidebarRPC.on("deleteAnnotation",(e=>this.detach(e))),this._sidebarRPC.on("loadAnnotations",(async e=>{try{
await Promise.all(e.map((e=>this.anchor(e))))}catch(e){console.warn("Failed to anchor annotations:",e)}})),this._sidebarRPC.on("showContentInfo",(e=>this._integration.showContentInfo?.(e))),this._sidebarRPC.on("setOutsideAssignmentNoticeVisible",(e=>{this._setOutsideAssignmentNoticeVisible(e)})),this._sidebarRPC.on("navigateToSegment",(e=>this._integration.navigateToSegment?.(e))),this._sidebarRPC.on("renderThumbnail",((e,t,n)=>{(async()=>{if(!this._integration.renderToBitmap)throw new Error("Thumbnail rendering not supported for document type");const n=this.anchors.find((t=>t.annotation.$tag===e));if(!n)throw new Error("Annotation not anchored in guest");return this._integration.renderToBitmap(n,t)})().then((e=>n({ok:!0,value:e}))).catch((e=>n({ok:!1,error:e.message})))})),this._portFinder.discover("sidebar").then((e=>{this._sidebarRPC.connect(e)})),this._sendDocumentInfo()}destroy(){this._drawTool.destroy(),this._portFinder.destroy(),this._hostRPC.destroy(),this._sidebarRPC.destroy(),
this._listeners.removeAll(),this._selectionObserver.disconnect(),this._adder.destroy(),this._bucketBarClient.destroy(),this._clusterToolbar?.destroy(),this._outsideAssignmentNotice?.destroy(),this._highlighter.removeAllHighlights(),this._integration.destroy(),super.destroy()}async anchor(e){this._contentReady&&(await this._contentReady,this._contentReady=void 0);const t=e=>{const t=Or(e);if(!t)return;let n;n=t instanceof Range?this._highlighter.highlightRange(t,e.annotation?.$cluster):this._highlighter.highlightShape(t),n.forEach((t=>{t._annotation=e.annotation})),e.highlights=n,this._hoveredAnnotations.has(e.annotation.$tag)&&this._highlighter.setHighlightsFocused(n,!0)};this.detach(e.$tag,!1),this._annotations.add(e.$tag),e.target||(e.target=[]);const n=await Promise.all(e.target.map((async t=>{if(!t.selector||!t.selector.some((e=>"TextQuoteSelector"===e.type||"ShapeSelector"===e.type)))return{annotation:e,target:t};let n;try{const o=await this._integration.anchor(this.element,t.selector)
;if(o instanceof Range){const i=uo.fromRange(o);n={annotation:e,target:t,region:i}}else n={annotation:e,target:t,region:o}}catch{n={annotation:e,target:t}}return n})));if(!this._annotations.has(e.$tag))return[];for(const e of n)t(e);return e.$orphan=n.length>0&&n.every((e=>e.target.selector&&!e.region)),this._updateAnchors(this.anchors.concat(n),!0),this._sidebarRPC.call("syncAnchoringStatus",e),n}detach(e,t=!0){this._annotations.delete(e);const n=[];for(const t of this.anchors)t.annotation.$tag!==e?n.push(t):t.highlights&&this._highlighter.removeHighlights(t.highlights);this._updateAnchors(n,t)}_updateAnchors(e,t){this.anchors=e,this._clusterToolbar?.scheduleClusterUpdates(),t&&this._bucketBarClient.update(this.anchors)}async createAnnotation(e){if("selection"===e)return this.createAnnotationFromSelection();if(!["rect","point"].includes(e))throw new Error("Unsupported annotation tool");{let t=!1;try{this._hostRPC.call("activeToolChanged",e)
;const t=await this._drawTool.draw(e),n=await this.getDocumentInfo(),o=[{source:n.uri,selector:await this._integration.describe(this.element,t)}],i={uri:n.uri,document:n.metadata,target:o,$tag:"a:"+nn(8)};return this._sidebarRPC.call("createAnnotation",i),this.anchor(i),i}catch(e){if(e instanceof Bo&&["canceled","restarted"].includes(e.kind))return t="restarted"===e.kind,null;throw e}finally{t||this._hostRPC.call("activeToolChanged",null)}}}async createAnnotationFromSelection({highlight:e=!1}={}){const t=this.selectedRanges;this.selectedRanges=[];const n=await this.getDocumentInfo(),o=this.element,i=(await Promise.all(t.map((e=>this._integration.describe(o,e))))).map((e=>({source:n.uri,selector:e}))),r={uri:n.uri,document:n.metadata,target:i,$highlight:e,$cluster:e?"user-highlights":"user-annotations",$tag:"a:"+nn(8)};return this._sidebarRPC.call("createAnnotation",r),this.anchor(r),Ir(),r}_hoverAnnotations(e){this._hoveredAnnotations.clear(),e.forEach((e=>this._hoveredAnnotations.add(e)))
;for(const t of this.anchors)if(t.highlights){const n=e.includes(t.annotation.$tag);this._highlighter.setHighlightsFocused(t.highlights,n)}this._sidebarRPC.call("hoverAnnotations",e)}_onSelection(e){const t=this._integration.getAnnotatableRange(e);if(!t)return void this._onClearSelection();const n=document.getSelection(),o=_o(n),i=vo(n);i?(this.selectedRanges=[t],this._hostRPC.call("textSelected"),this._adder.annotationsForSelection=Tr(),this._isAdderVisible=!0,this._adder.show(i,o)):this._onClearSelection()}_onClearSelection(){this._isAdderVisible=!1,this._adder.hide(),this.selectedRanges=[],this._informHostOnNextSelectionClear&&this._hostRPC.call("textUnselected"),this._informHostOnNextSelectionClear=!0}selectAnnotations(e,{toggle:t=!1,focusInSidebar:n=!1}={}){t?this._sidebarRPC.call("toggleAnnotationSelection",e):this._sidebarRPC.call("showAnnotations",e,n),this._sidebarRPC.call("openSidebar")}setHighlightsVisible(e,t=!0){this._highlighter.setHighlightsVisible(e),this._highlightsVisible=e,
t&&this._hostRPC.call("highlightsVisibleChanged",e)}get highlightsVisible(){return this._highlightsVisible}fitSideBySide(e){this._sidebarLayout=e,this._integration.fitSideBySide(e)}get hoveredAnnotationTags(){return this._hoveredAnnotations}_handleShortcut(e){zn(e,"Ctrl+Shift+H")&&this.setHighlightsVisible(!this._highlightsVisible)}_setOutsideAssignmentNoticeVisible(e){this._outsideAssignmentNotice||(this._outsideAssignmentNotice=new Rr(this.element)),this._outsideAssignmentNotice.setVisible(e)}}function Hr(e,t){const n=new URL(e),o=new URLSearchParams;return o.append("config",JSON.stringify(t)),n.hash=o.toString(),n.toString()}function Fr(e,t){const n={};for(const[e,o]of Object.entries(t))"notebookAppUrl"!==e&&"sidebarAppUrl"!==e&&null!=o&&(n[e]=o);n.origin=new URL(e).origin,n.version="1.1650.0";const o=new URL(window.location.href);if(o.hash="",n.hostURL=o.toString(),Array.isArray(n.services)&&n.services?.length>0){const e=n.services[0];e.onLoginRequest&&(e.onLoginRequestProvided=!0),
e.onLogoutRequest&&(e.onLogoutRequestProvided=!0),e.onSignupRequest&&(e.onSignupRequestProvided=!0),e.onProfileRequest&&(e.onProfileRequestProvided=!0),e.onHelpRequest&&(e.onHelpRequestProvided=!0)}return n}function Dr({closed:e,onClose:t,children:n,"data-testid":o,"aria-label":i}){const r=oe(null);return te((()=>{e?r.current?.close():r.current?.showModal()}),[e]),te((()=>{const e=r.current;return e?.addEventListener("cancel",t),()=>{e?.removeEventListener("cancel",t)}}),[t]),Pe("dialog",{ref:r,className:"relative w-full h-full backdrop:bg-black/50","data-testid":o,"aria-label":i,children:n})}function Vr({closed:e,children:t,...n}){return Pe("div",{...n,className:Re("fixed z-max top-0 left-0 right-0 bottom-0 p-3 bg-black/50",{hidden:e}),children:Pe("div",{className:"relative w-full h-full",children:t})})}function Ur({document_:e=document,...t}){return Pe(ie((()=>function(e){return"function"==typeof e.createElement("dialog").showModal}(e)?Dr:Vr),[e]),{...t})}function qr({config:e,groupId:t}){
return Pe("iframe",{title:"Hypothesis annotation notebook",className:"h-full w-full border-0",allow:"fullscreen; clipboard-write",src:Hr(e.notebookAppUrl,{...Fr(e.notebookAppUrl,e),group:t})})}function $r({eventBus:e,config:t}){const[n,o]=ee(0),[i,r]=ee(!0),[s,a]=ee(null),l=oe(""),c=oe(null);te((()=>(l.current=document.body.style.overflow,()=>{document.body.style.overflow=l.current})),[]),te((()=>{document.body.style.overflow=i?l.current:"hidden"}),[i]),te((()=>{const t=e.createEmitter();return t.subscribe("openNotebook",(e=>{r(!1),o((e=>e+1)),a(e)})),c.current=t,()=>{t.destroy()}}),[e]);const h=re((()=>{r(!0),c.current?.publish("closeNotebook")}),[]);return null===s?null:Pe(Ur,{closed:i,onClose:h,"data-testid":"notebook-outer","aria-label":"Hypothesis notebook",children:[Pe("div",{className:"absolute right-0 m-3",children:Pe(kt,{title:"Close notebook",onClick:h,variant:"dark",classes:Re("!bg-transparent enabled:hover:!bg-grey-3"),"data-testid":"close-button",children:Pe(Fe,{className:"w-4 h-4"})})}),Pe(qr,{
config:t,groupId:s},n)]})}class zr{constructor(e,t,n){this._container=new Zn("notebook",(()=>Pe($r,{eventBus:t,config:n}))),e.append(this._container.element),this._container.render()}destroy(){this._container.destroy()}}function Wr({eventBus:e,config:t}){const[n,o]=ee(!0),i=oe(null);te((()=>{const t=e.createEmitter();return t.subscribe("openProfile",(()=>{o(!1)})),i.current=t,()=>{t.destroy()}}),[e]);const r=()=>{o(!0),i.current?.publish("closeProfile")};return n?null:Pe(Ur,{closed:n,onClose:r,"data-testid":"profile-outer","aria-label":"Hypothesis profile",children:[Pe("div",{className:"absolute right-0 m-3",children:Pe(kt,{title:"Close profile dialog",onClick:r,variant:"dark",classes:Re("!bg-transparent enabled:hover:!bg-grey-3"),children:Pe(Fe,{className:"w-4 h-4"})})}),Pe("iframe",{title:"Hypothesis profile",className:"h-full w-full border-0",src:t.profileAppUrl})]})}class jr{constructor(e,t,n){this._container=new Zn("profile",(()=>Pe(Wr,{eventBus:t,config:n}))),e.append(this._container.element),
this._container.render()}destroy(){this._container.destroy()}}function Xr({above:e,below:t,buckets:n,onFocusAnnotations:o,onScrollToAnnotation:i,onSelectAnnotations:r}){const s=e.anchors.length>0,a=t.anchors.length>0,l=e=>e.anchors.map((e=>e.tag));return Pe("ul",{className:"relative",children:[s&&Pe("li",{className:"absolute right-0 pointer-events-auto mt-[-11px]",style:{top:e.position},children:Pe(en,{"data-testid":"up-navigation-button",direction:"up",onClick:()=>{const t=[...e.anchors].sort(((e,t)=>e.bottom-t.bottom)),n=t[t.length-1];i(n.tag)},onBlur:()=>o([]),onFocus:()=>o(l(e)),onMouseEnter:()=>o(l(e)),onMouseOut:()=>o([]),title:`Go up to next annotations (${e.anchors.length})`,children:e.anchors.length})}),n.map(((e,t)=>Pe("li",{className:"absolute right-0 pointer-events-auto mt-[-8px]",style:{top:e.position},children:Pe(en,{direction:"left",onClick:t=>r(l(e),t.metaKey||t.ctrlKey),onBlur:()=>o([]),onFocus:()=>o(l(e)),onMouseEnter:()=>o(l(e)),onMouseOut:()=>o([]),
title:`Select nearby annotations (${e.anchors.length})`,children:e.anchors.length})},t))),a&&Pe("li",{className:"absolute right-0 pointer-events-auto",style:{top:t.position},children:Pe(en,{"data-testid":"down-navigation-button",direction:"down",onClick:()=>{const e=[...t.anchors].sort(((e,t)=>e.top-t.top)),n=e[0];i(n.tag)},onBlur:()=>o([]),onFocus:()=>o(l(t)),onMouseEnter:()=>o(l(t)),onMouseOut:()=>o([]),title:`Go up to next annotations (${t.anchors.length})`,children:t.anchors.length})})]})}class Yr{constructor(e,{onFocusAnnotations:t,onScrollToAnnotation:n,onSelectAnnotations:o}){this._positions=[],this._container=new Zn("bucket-bar",(()=>this._render())),Object.assign(this._container.element.style,{display:"block",flexGrow:"1",width:"100%"}),e.appendChild(this._container.element),this._onFocusAnnotations=t,this._onScrollToAnnotation=n,this._onSelectAnnotations=o,this._container.render()}destroy(){this._container.destroy()}update(e){this._positions=e,this._container.render()}_render(){
const e=function(e,t){const n=[],o=[],i=[];let r=null;function s(e){const{bottom:t,top:n}=e;return{bottom:t,position:n+(t-n)/2,anchors:[e],top:n}}const a=t.getBoundingClientRect(),l=e.map((e=>({tag:e.tag,top:e.top-a.top,bottom:e.bottom-a.top})));for(const e of l){const t=(e.top+e.bottom)/2;if(t<30){n.push(e);continue}if(t>a.height-30){o.push(e);continue}if(!r){r=s(e);continue}const l=e.top>r.top&&e.bottom<r.bottom;if(e.top-r.bottom>60&&!l)i.push(r),r=s(e);else{const t=e.bottom>r.bottom?e.bottom:r.bottom,n=t-r.top;r.anchors.push(e),r.bottom=t,r.position=r.top+n/2}}return r&&i.push(r),{above:{anchors:n,position:25},below:{anchors:o,position:a.height-30},buckets:i}}(this._positions,this._container.element);return Pe(Xr,{above:e.above,below:e.below,buckets:e.buckets,onFocusAnnotations:e=>this._onFocusAnnotations(e),onScrollToAnnotation:e=>this._onScrollToAnnotation(e),onSelectAnnotations:(e,t)=>this._onSelectAnnotations(e,t)})}}function Kr({emitter:e}){
const[t,n]=ee([]),o=re((e=>n((t=>[...t,e]))),[]),i=re((e=>n((t=>t.filter((t=>t.id!==e))))),[]);return te((()=>(e.subscribe("toastMessageAdded",o),e.subscribe("toastMessageDismissed",i),()=>{e.unsubscribe("toastMessageAdded",o),e.unsubscribe("toastMessageDismissed",i)})),[e,i,o]),Pe(Gt,{messages:t,onMessageDismiss:i})}function Gr({icon:e,pressedBackground:t=!0,...n}){return Pe(Ct,{classes:Re("justify-center rounded","w-[30px] h-[30px] touch:h-[40px]","shadow border bg-white text-grey-6 hover:text-grey-9",t&&"aria-pressed:bg-grey-3"),...n,size:"custom",variant:"custom",children:Pe(e,{})})}function Qr({highlightsVisible:e}){return Pe("div",{className:"sr-only",role:"status","data-testid":"toolbar-status",children:e?"Highlights visible":"Highlights hidden"})}function Jr({activeTool:e=null,closeSidebar:t,createAnnotation:n,isSidebarOpen:o,sidebarContainerId:i,newAnnotationType:r,showHighlights:s,supportedTools:a=["selection"],toggleHighlights:l,toggleSidebar:c,toggleSidebarRef:h,useMinimalControls:d=!1}){
return Pe("div",{className:Re({"absolute right-full":d,"relative right-[11px]":!d},"w-[33px] z-2","text-px-base leading-none"),children:[d&&o&&Pe(Ct,{classes:Re("transition-colors focus-visible-ring ring-inset","w-[27px] h-[27px] mt-[140px] ml-px-1.5","flex items-center justify-center bg-white border","text-grey-6 hover:text-grey-9 transition-colors","border-r-0","shadow-sidebar"),title:"Close annotation sidebar",onClick:t,unstyled:!0,children:Pe(Fe,{})}),!d&&Pe(w,{children:[Pe(Ct,{classes:Re("transition-colors focus-visible-ring ring-inset","h-[40px] w-[33px] pl-[6px] rounded-bl","bg-white text-grey-5 hover:text-grey-9","border-l border-b"),elementRef:h,title:"Annotation sidebar",expanded:o,"aria-controls":i,onClick:c,unstyled:!0,children:Pe(o?ze:qe,{})}),Pe("div",{className:"space-y-px-1.5 mt-px-2",children:[Pe(Gr,{title:"Show highlights",icon:s?xt:et,pressed:s,pressedBackground:!1,onClick:l}),a.includes("selection")&&Pe(Gr,{"data-testid":"text-annotation",title:"note"===r?"New page note":"New annotation",
icon:"note"===r?lt:Be,onClick:()=>n("selection")}),a.includes("rect")&&Pe(Gr,{"data-testid":"rect-annotation",pressed:"rect"===e,title:"Rectangle annotation",icon:vt,onClick:()=>n("rect"===e?null:"rect")}),a.includes("point")&&Pe(Gr,{"data-testid":"point-annotation",pressed:"point"===e,title:"Pin annotation",icon:ht,onClick:()=>n("point"===e?null:"point")})]}),Pe(Qr,{highlightsVisible:s})]})]})}class Zr{constructor(e,t){const{createAnnotation:n,setSidebarOpen:o,setHighlightsVisible:i}=t;this.container=e,this._activeTool=null,this._useMinimalControls=!1,this._newAnnotationType="note",this._highlightsVisible=!1,this._sidebarOpen=!1,this._sidebarContainerId=t.sidebarContainerId,this._supportedAnnotationTools=["selection"],this._closeSidebar=()=>o(!1),this._toggleSidebar=()=>o(!this._sidebarOpen),this._toggleHighlights=()=>i(!this._highlightsVisible),this._createAnnotation=e=>{n(e),"selection"===e&&o(!0)},this._sidebarToggleButton={current:null},this.render()}getWidth(){
return this.container.firstChild.getBoundingClientRect().width}set activeTool(e){this._activeTool=e,this.render()}get activeTool(){return this._activeTool}set useMinimalControls(e){this._useMinimalControls=e,this.render()}get useMinimalControls(){return this._useMinimalControls}set sidebarOpen(e){this._sidebarOpen=e,this.render()}get sidebarOpen(){return this._sidebarOpen}set newAnnotationType(e){this._newAnnotationType=e,this.render()}get newAnnotationType(){return this._newAnnotationType}set highlightsVisible(e){this._highlightsVisible=e,this.render()}get highlightsVisible(){return this._highlightsVisible}get sidebarToggleButton(){return this._sidebarToggleButton.current}set supportedAnnotationTools(e){this._supportedAnnotationTools=e,this.render()}get supportedAnnotationTools(){return this._supportedAnnotationTools}render(){F(Pe(Jr,{activeTool:this._activeTool,closeSidebar:this._closeSidebar,createAnnotation:this._createAnnotation,newAnnotationType:this._newAnnotationType,isSidebarOpen:this._sidebarOpen,
sidebarContainerId:this._sidebarContainerId,showHighlights:this._highlightsVisible,supportedTools:this._supportedAnnotationTools,toggleHighlights:this._toggleHighlights,toggleSidebar:this._toggleSidebar,toggleSidebarRef:this._sidebarToggleButton,useMinimalControls:this.useMinimalControls}),this.container)}}class es{constructor({target:e,threshold:t=10,onDrag:n}){e.style.touchAction="none",this._listeners=new ge,this._startX=null,this._dragActive=!1,this._threshold=t,this._listeners.add(e,"pointerdown",(e=>{this._startX=e.clientX}));const o=e=>{if(null!==this._startX&&this._dragActive){const t=e.clientX-this._startX;n({type:"dragend",deltaX:t})}this._startX=null,this._dragActive=!1};this._listeners.add(window,"pointercancel",o),this._listeners.add(window,"pointerup",o),this._listeners.add(window,"pointermove",(e=>{if(null===this._startX)return;const t=e.clientX-this._startX;!this._dragActive&&Math.abs(t)>=this._threshold&&(this._dragActive=!0,n({type:"dragstart",deltaX:t})),this._dragActive&&n({
type:"dragmove",deltaX:t})}))}destroy(){this._listeners.removeAll()}}class ts{constructor(e,t,n){this._emitter=t.createEmitter(),this._guestWithSelection=null,this._guestRPC=[],this._sidebarRPC=new _n,this.iframe=function(e){const t=e.sidebarAppUrl,n=Hr(t,Fr(t,e)),o=document.createElement("iframe");return o.src=n,o.title="Hypothesis annotation viewer",o.className="sidebar-frame",o.allow="fullscreen; clipboard-write",o}(n),this._config=n,this.bucketBar=null,this.features=new qo;const o="sidebar-container",i=document.createElement("div");if(i.setAttribute("data-testid","toolbar-container"),this.toolbar=new Zr(i,{sidebarContainerId:o,createAnnotation:e=>{if(0===this._guestRPC.length)return;(this._guestWithSelection??this._guestRPC[0]).call("createAnnotation",{tool:e})},setSidebarOpen:e=>e?this.open():this.close(),setHighlightsVisible:e=>this.setHighlightsVisible(e)}),n.externalContainerSelector)this.externalFrame=document.querySelector(n.externalContainerSelector)??e,
this.externalFrame.appendChild(this.iframe);else{if(this.iframeContainer=document.createElement("div"),this.iframeContainer.style.display="none",this.iframeContainer.className="sidebar-container",this.iframeContainer.id=o,"clean"===n.theme)this.iframeContainer.classList.add("theme-clean"),this.iframeContainer.append(i),this.toolbar.useMinimalControls=!0;else{let e;n.bucketContainerSelector&&(e=document.querySelector(n.bucketContainerSelector),e||console.warn(`Custom bucket container "${n.bucketContainerSelector}" not found`));const t=document.createElement("div");t.setAttribute("data-testid","sidebar-edge"),t.className=Re("absolute top-0 bottom-0 w-[23px] left-[-22px]","flex flex-col pr-[5px]","bg-grey-2 sidebar-collapsed:bg-black/[.08]","pointer-events-none"),i.className="pointer-events-auto",t.append(i),this.iframeContainer.append(t),e||(e=t),this.bucketBar=new Yr(e,{onFocusAnnotations:e=>this._guestRPC.forEach((t=>t.call("hoverAnnotations",e))),
onScrollToAnnotation:e=>this._guestRPC.forEach((t=>t.call("scrollToAnnotation",e))),onSelectAnnotations:(e,t)=>this._guestRPC.forEach((n=>n.call("selectAnnotations",e,t)))})}this.iframeContainer.appendChild(this.iframe),this._hypothesisSidebar=document.createElement("hypothesis-sidebar");const t=Jn(this._hypothesisSidebar);t.appendChild(this.iframeContainer),e.appendChild(this._hypothesisSidebar),this._messagesElement=document.createElement("div"),t.appendChild(this._messagesElement),F(Pe(Kr,{emitter:this._emitter}),this._messagesElement)}this.iframe.contentWindow&&dn(this.iframe.contentWindow),this._listeners=new ge,this.iframeContainer?this._toolbarWidth=this.toolbar.getWidth():this._toolbarWidth=0,this._listeners.add(window,"resize",(()=>this._onResize())),this._dragResizeState={initial:null,final:null};const r=this.toolbar.sidebarToggleButton;r&&(this._dragResizeHandler=new es({target:r,onDrag:e=>this._onDragSidebarToggleButton(e)})),this.close();const[s]=n.services||[]
;s&&(this.onLoginRequest=s.onLoginRequest,this.onLogoutRequest=s.onLogoutRequest,this.onSignupRequest=s.onSignupRequest,this.onProfileRequest=s.onProfileRequest,this.onHelpRequest=s.onHelpRequest),this.onLayoutChange=n.onLayoutChange,this._layoutState={expanded:!1,width:0,height:0,toolbarWidth:0},this._updateLayoutState(!1),this._setupSidebarEvents()}destroy(){this._guestRPC.forEach((e=>e.destroy())),this._sidebarRPC.destroy(),this.bucketBar?.destroy(),this._listeners.removeAll(),this._dragResizeHandler?.destroy(),this._hypothesisSidebar?(F(null,this._messagesElement),this._hypothesisSidebar.remove()):this.iframe.remove(),this._emitter.destroy(),dn(null)}onFrameConnected(e,t){switch(e){case"guest":this._connectGuest(t);break;case"sidebar":this._sidebarRPC.connect(t)}}_connectGuest(e){const t=new _n;t.on("textSelected",(()=>{this._guestWithSelection=t,this.toolbar.newAnnotationType="annotation",this._guestRPC.filter((e=>e!==t)).forEach((e=>e.call("clearSelection")))})),t.on("textUnselected",(()=>{
this._guestWithSelection=null,this.toolbar.newAnnotationType="note",this._guestRPC.filter((e=>e!==t)).forEach((e=>e.call("clearSelection")))})),t.on("activeToolChanged",(e=>{this.toolbar.activeTool=e})),t.on("highlightsVisibleChanged",(e=>{this.setHighlightsVisible(e)}));const n=this.bucketBar;n&&t.on("anchorsChanged",(e=>{0===this._guestRPC.indexOf(t)&&n.update(e)})),t.on("close",(()=>{t.destroy(),t===this._guestWithSelection&&(this._guestWithSelection=null),this._guestRPC=this._guestRPC.filter((e=>e!==t))})),t.on("supportedToolsChanged",(e=>{this.toolbar.supportedAnnotationTools=e})),t.connect(e),this._guestRPC.push(t),t.call("sidebarLayoutChanged",this._layoutState)}_setupSidebarEvents(){var e;e=document.body,this._sidebarRPC.on("publicAnnotationCountChanged",(function(t){const n=e.querySelectorAll("[data-hypothesis-annotation-count]");Array.from(n).forEach((e=>{e.textContent=t.toString()}))})),function(e,t){const n=e.querySelectorAll("[data-hypothesis-trigger]");Array.from(n).forEach((e=>{
e.addEventListener("click",(e=>{t(),e.stopPropagation()}))}))}(document.body,(()=>this.open())),this._sidebarRPC.on("featureFlagsUpdated",(e=>this.features.update(e))),this._sidebarRPC.on("connect",(()=>{this.iframeContainer&&(this.iframeContainer.style.display="");const e="always"===this._config.showHighlights;this.setHighlightsVisible(e),(this._config.openSidebar||this._config.annotations||this._config.query||this._config.group)&&this.open()})),this._sidebarRPC.on("showHighlights",(()=>this.setHighlightsVisible(!0))),this._sidebarRPC.on("openSidebar",(()=>this.open())),this._sidebarRPC.on("closeSidebar",(()=>this.close())),this._sidebarRPC.on("openNotebook",(e=>{this.hide(),this._emitter.publish("openNotebook",e)})),this._sidebarRPC.on("openProfile",(()=>{this.hide(),this._emitter.publish("openProfile")})),this._emitter.subscribe("closeProfile",(()=>{this.show()})),this._emitter.subscribe("closeNotebook",(()=>{this.show()})),this._sidebarRPC.on("toastMessageAdded",(e=>{
this._emitter.publish("toastMessageAdded",e)})),this._sidebarRPC.on("toastMessageDismissed",(e=>{this._emitter.publish("toastMessageDismissed",e)}));[["loginRequested",this.onLoginRequest],["logoutRequested",this.onLogoutRequest],["signupRequested",this.onSignupRequest],["profileRequested",this.onProfileRequest],["helpRequested",this.onHelpRequest]].forEach((([e,t])=>{t&&this._sidebarRPC.on(e,(()=>t()))}))}_resetDragResizeState(){this._dragResizeState={initial:null,final:null}}_updateLayout(){this._renderFrame||(this._renderFrame=requestAnimationFrame((()=>{if(this._renderFrame=void 0,"number"==typeof this._dragResizeState.final&&this._dragResizeState.final!==this._dragResizeState.initial&&this.iframeContainer){const e=this._dragResizeState.final,t=-e;this.iframeContainer.style.marginLeft=`${e}px`,t>=280&&(this.iframeContainer.style.width=`${t}px`),this._updateLayoutState()}})))}_updateLayoutState(e){
const t=this.iframeContainer&&this.toolbar.getWidth()||0,n=this.iframeContainer??this.externalFrame,{height:o}=n.getBoundingClientRect(),i=window.getComputedStyle(n),r=parseInt(i.width),s=parseInt(i.marginLeft);let a=t;"boolean"==typeof e?e&&(a+=r):(s<280?a-=s:a+=r,e=a>t);const l={expanded:e,width:e?a:t,height:o,toolbarWidth:t};this._layoutState=l,this.onLayoutChange?.(l),this._guestRPC.forEach((e=>e.call("sidebarLayoutChanged",l)))}_onResize(){!0===this.toolbar.sidebarOpen&&(window.innerWidth<280?this.close():this.open())}isResizing(){return null!==this._dragResizeState.initial}_onDragSidebarToggleButton(e){const t=this.iframeContainer;if(t)switch(e.type){case"dragstart":this._resetDragResizeState(),t.classList.add("sidebar-no-transition"),this.toolbar.container.style.pointerEvents="none",this._dragResizeState.initial=parseInt(getComputedStyle(t).marginLeft);break;case"dragend":t.classList.remove("sidebar-no-transition"),this.toolbar.container.style.pointerEvents="",
null===this._dragResizeState.final||this._dragResizeState.final<=-280?this.open():this.close(),this._resetDragResizeState();break;case"dragmove":{if("number"!=typeof this._dragResizeState.initial)return;const t=this._dragResizeState.initial,n=e.deltaX;this._dragResizeState.final=Math.min(Math.round(t+n),0),this._updateLayout();break}}}open(){if(this._sidebarRPC.call("sidebarOpened"),this.iframeContainer){const e=this.iframeContainer.getBoundingClientRect().width;this.iframeContainer.style.marginLeft=-1*e+"px",this.iframeContainer.classList.remove("sidebar-collapsed")}this.toolbar.sidebarOpen=!0,"whenSidebarOpen"===this._config.showHighlights&&this.setHighlightsVisible(!0),this._updateLayoutState(!0)}close(){this._sidebarRPC.call("sidebarClosed"),this.iframeContainer&&(this.iframeContainer.style.marginLeft="",this.iframeContainer.classList.add("sidebar-collapsed")),this.toolbar.sidebarOpen=!1,"whenSidebarOpen"===this._config.showHighlights&&this.setHighlightsVisible(!1),this._updateLayoutState(!1)}
setHighlightsVisible(e){this.toolbar.highlightsVisible=e,this._sidebarRPC.call("setHighlightsVisible",e)}show(){this.iframeContainer?.classList.remove("is-hidden")}hide(){this.iframeContainer?.classList.add("is-hidden")}}class ns{constructor(e){this._emitter=e,this._subscriptions=[]}publish(e,...t){this._emitter.emit(e,...t)}subscribe(e,t){this._emitter.on(e,t),this._subscriptions.push([e,t])}unsubscribe(e,t){this._emitter.off(e,t),this._subscriptions=this._subscriptions.filter((([n,o])=>n!==e||o!==t))}destroy(){for(const[e,t]of this._subscriptions)this._emitter.off(e,t);this._subscriptions=[]}}class os{constructor(){this._emitter=new an}createEmitter(){return new ns(this._emitter)}}const is=document.querySelector('link[type="application/annotator+html"][rel="sidebar"]');new Promise((e=>{"loading"!==document.readyState&&e(),document.addEventListener("readystatechange",(()=>e()))})).then((function(){const e=qn("annotator");let t=()=>{};const n=new Promise((e=>{t=e}));is.addEventListener("destroy",t)
;const o=e.subFrameIdentifier?window.parent:window,i=[];if(o===window){if(function(){const e=document.querySelectorAll(["hypothesis-sidebar","hypothesis-notebook","hypothesis-profile"].join(","));return e.forEach((e=>e.remove())),e.length>0}())return void console.warn("Hypothesis did not load because it found an existing instance on the page.");const e=qn("sidebar"),t=new URL(e.sidebarAppUrl).origin,n=new un(t),o=new os,r=new ts(document.body,o,e),s=new zr(document.body,o,qn("notebook")),a=new jr(document.body,o,qn("profile"));n.on("frameConnected",((e,t)=>r.onFrameConnected(e,t))),i.push(n,r,s,a)}if("container"===xr()){const t=new Nr(e);i.push(t)}else{const n=new br(document.body,e),r=new Br(document.body,e,o);r.on("hostDisconnected",t),i.push(n,r)}n.then((()=>{i.forEach((e=>e.destroy()));document.querySelectorAll("[data-hypothesis-asset]").forEach((e=>e.remove())),function(e=document){Array.from(e.querySelectorAll("script.js-hypothesis-config[data-remove-on-unload]")).forEach((e=>e.remove()))}()}))}))}();
//# sourceMappingURL=annotator.bundle.js.map
